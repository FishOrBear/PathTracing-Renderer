{"version":3,"sources":["webpack:///webpack/bootstrap 5107f8d5316639c34fd7","webpack:///delegated ./node_modules/three/build/three.module.js from dll-reference dll","webpack:///./src/index.ts","webpack:///./src/PathTracingRenderer.ts","webpack:///external \"dll\"","webpack:///./src/FirstPersonCameraControls.ts","webpack:///./src/glsl/pathTracingCommon.ts","webpack:///./src/glsl/pathtracing_main.glsl","webpack:///./src/glsl/pathTracingVertexShader.glsl","webpack:///./node_modules/dat.gui/build/dat.gui.js","webpack:///./src/glsl/pathTracingFragmentShader.glsl","webpack:///./src/glsl/mis.glsl"],"names":[],"mappings":"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CA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA,GAAG;AACH,aAAa,oCAAoC;AACjD,GAAG;AACH,aAAa,gDAAgD;AAC7D,GAAG;AACH,aAAa,oCAAoC;AACjD,GAAG;AACH,aAAa,gDAAgD;AAC7D;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,qCAAqC,QAAQ;AAC7C;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,mCAAmC,SAAS;AAC5C;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA,+CAA+C,EAAE;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA,CAAC;AACD;AACA;;;;;;;;;;;;AAYA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;AAQD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;;;;;;;;;;;AAYA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mKAAmK,iCAAiC;AACpM;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,GAAG;AACH;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,8GAA8G;AAC9G,GAAG;AACH;AACA;AACA;AACA,2JAA2J;AAC3J,wJAAwJ;AACxJ,mJAAmJ;AACnJ,oJAAoJ;AACpJ,gJAAgJ;AAChJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,2DAA2D;AACnH;AACA,sDAAsD,uCAAuC;AAC7F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,CAAC;;AAED,yCAAyC,gBAAgB,SAAS,UAAU,WAAW,WAAW,OAAO,eAAe,MAAM,OAAO,QAAQ,SAAS,UAAU,mBAAmB,gBAAgB,SAAS,sCAAsC,iCAAiC,mCAAmC,8BAA8B,4BAA4B,gBAAgB,0CAA0C,UAAU,gBAAgB,6BAA6B,iCAAiC,qBAAqB,yDAAyD,UAAU,uBAAuB,sCAAsC,iCAAiC,mCAAmC,8BAA8B,SAAS,iBAAiB,YAAY,eAAe,kBAAkB,sBAAsB,iCAAiC,kBAAkB,oCAAoC,kBAAkB,6BAA6B,sBAAsB,MAAM,YAAY,kBAAkB,mBAAmB,4BAA4B,aAAa,+BAA+B,gBAAgB,yBAAyB,aAAa,gBAAgB,MAAM,aAAa,0BAA0B,kBAAkB,6BAA6B,eAAe,OAAO,uCAAuC,kCAAkC,oCAAoC,+BAA+B,uCAAuC,kCAAkC,oCAAoC,+BAA+B,oBAAoB,YAAY,YAAY,iBAAiB,oBAAoB,cAAc,UAAU,kCAAkC,aAAa,eAAe,iBAAiB,iEAAiE,SAAS,gBAAgB,SAAS,QAAQ,WAAW,iBAAiB,YAAY,gBAAgB,mBAAmB,eAAe,WAAW,WAAW,UAAU,gBAAgB,uBAAuB,OAAO,WAAW,UAAU,kBAAkB,wBAAwB,SAAS,eAAe,YAAY,WAAW,YAAY,iCAAiC,UAAU,cAAc,YAAY,WAAW,UAAU,iBAAiB,eAAe,YAAY,eAAe,eAAe,YAAY,4BAA4B,eAAe,cAAc,eAAe,sGAAsG,eAAe,cAAc,iBAAiB,cAAc,aAAa,kBAAkB,iBAAiB,gBAAgB,WAAW,0CAA0C,cAAc,gBAAgB,UAAU,wBAAwB,qBAAqB,gBAAgB,aAAa,sBAAsB,YAAY,aAAa,eAAe,iBAAiB,oBAAoB,aAAa,WAAW,8BAA8B,eAAe,SAAS,YAAY,kCAAkC,qBAAqB,cAAc,cAAc,YAAY,kBAAkB,aAAa,kBAAkB,kBAAkB,aAAa,eAAe,iBAAiB,kBAAkB,sBAAsB,YAAY,gBAAgB,uBAAuB,eAAe,sBAAsB,aAAa,IAAI,WAAW,sCAAsC,0BAA0B,4BAA4B,UAAU,mBAAmB,mCAAmC,SAAS,aAAa,kCAAkC,kBAAkB,mBAAmB,oBAAoB,mBAAmB,gCAAgC,gBAAgB,iBAAiB,mBAAmB,SAAS,uBAAuB,gBAAgB,YAAY,wBAAwB,gBAAgB,eAAe,kBAAkB,cAAc,gBAAgB,wBAAwB,mBAAmB,WAAW,4BAA4B,4BAA4B,eAAe,8BAA8B,sCAAsC,mfAAmf,WAAW,UAAU,8BAA8B,yBAAyB,4BAA4B,cAAc,gBAAgB,aAAa,kBAAkB,mCAAmC,wGAAwG,eAAe,8CAA8C,qBAAqB,oCAAoC,qFAAqF,gBAAgB,8BAA8B,cAAc,sBAAsB,iBAAiB,8BAA8B,eAAe,8BAA8B,gCAAgC,cAAc,eAAe,8BAA8B,gCAAgC,cAAc,6CAA6C,gBAAgB,wBAAwB,mBAAmB,aAAa,8BAA8B,mBAAmB,8BAA8B,mBAAmB,WAAW,eAAe,mBAAmB,iBAAiB,kBAAkB,mBAAmB,eAAe,qBAAqB,mBAAmB,gCAAgC,mBAAmB;;AAEhtL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,+EAA+E,wEAAwE;AACvJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA,uBAAuB,oCAAoC;AAC3D;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;AACA,qBAAqB,oCAAoC;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;;AAEA;;AAEA,CAAC;AACD;;;;;;;ACz9EA,wCAAwC,wBAAwB,8BAA8B,oCAAoC,uCAAuC,mCAAmC,sCAAsC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","file":"PathTracingRender.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5107f8d5316639c34fd7","module.exports = (__webpack_require__(3))(1);\n\n\n//////////////////\n// WEBPACK FOOTER\n// delegated ./node_modules/three/build/three.module.js from dll-reference dll\n// module id = 0\n// module chunks = 0","import { PathTracingRenderer } from './PathTracingRenderer';\r\n\r\nimport * as Dat from \"dat.gui\";\r\n\r\nlet render = new PathTracingRenderer();\r\n\r\nlet path = render.LoadDefaultMaterial(require(\"./glsl/pathTracingFragmentShader.glsl\"));\r\n\r\nlet mis = render.LoadDefaultMaterial(require(\"./glsl/mis.glsl\"));\r\n\r\nrender.RenderCycle();\r\n\r\nlet gui = new Dat.GUI(\r\n    {\r\n        autoPlace: true,\r\n        width: 300,\r\n    }\r\n);\r\n\r\nlet data = {\r\n    Path: () =>\r\n    {\r\n        render.pathTracingMesh.material = path;\r\n        render.sampleCounter = 1;\r\n    },\r\n    Mis: () =>\r\n    {\r\n        render.pathTracingMesh.material = mis;\r\n        render.sampleCounter = 1;\r\n    },\r\n    Stop: () =>\r\n    {\r\n        render.Disabled = false;\r\n    },\r\n    Start: () =>\r\n    {\r\n        render.Disabled = true;\r\n    },\r\n}\r\n\r\nfor (let key in data)\r\n{\r\n    gui.add(data, key);\r\n}\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","import { Vector3 } from 'three';\r\nimport * as THREE from 'three';\r\n\r\nimport { FirstPersonCameraControls } from './FirstPersonCameraControls';\r\nimport { screenOutputShader, screenTextureShader } from './glsl/pathTracingCommon';\r\n\r\nexport class PathTracingRenderer\r\n{\r\n    pathTracingMesh: THREE.Mesh;\r\n    controls: FirstPersonCameraControls;\r\n    sampleCounter: number = 1;\r\n    screenTextureMesh: THREE.Mesh;\r\n    screenTextureScene: THREE.Scene;\r\n    screenOutputScene: THREE.Scene;\r\n    pathTracingScene: THREE.Scene;\r\n    screenOutputMaterial: THREE.ShaderMaterial;\r\n    cameraControlsObject: THREE.Object3D;\r\n    quadCamera: THREE.OrthographicCamera;\r\n    worldCamera: THREE.PerspectiveCamera;\r\n    screenTextureRenderTarget: THREE.WebGLRenderTarget;\r\n    pathTracingRenderTarget: THREE.WebGLRenderTarget;\r\n    pathTracingUniforms: { tPreviousTexture: { type: string; value: THREE.Texture; }; uCameraIsMoving: { type: string; value: boolean; }; uCameraJustStartedMoving: { type: string; value: boolean; }; uTime: { type: string; value: number; }; uSampleCounter: { type: string; value: number; }; uMouse: { type: string; value: any; }; uULen: { type: string; value: number; }; uVLen: { type: string; value: number; }; uApertureSize: { type: string; value: number; }; uFocusDistance: { type: string; value: number; }; uResolution: { type: string; value: THREE.Vector2; }; uRandomVector: { type: string; value: THREE.Vector3; }; uCameraMatrix: { type: string; value: THREE.Matrix4; }; uShortBoxInvMatrix: { type: string; value: THREE.Matrix4; }; uShortBoxNormalMatrix: { type: string; value: THREE.Matrix3; }; uTallBoxInvMatrix: { type: string; value: THREE.Matrix4; }; uTallBoxNormalMatrix: { type: string; value: THREE.Matrix3; }; };\r\n    renderer: THREE.WebGLRenderer;\r\n    SCREEN_HEIGHT: number;\r\n    SCREEN_WIDTH: number;\r\n\r\n    Disabled: boolean = false;\r\n    constructor()\r\n    {\r\n        this.InitRender();\r\n        this.InitScene();\r\n        this.OnWindowResize();\r\n    }\r\n    InitRender()\r\n    {\r\n        this.renderer = new THREE.WebGLRenderer(\r\n        );\r\n\r\n        this.renderer.setClearColor(0x000000, 1);\r\n\r\n        this.renderer.autoClear = false;\r\n        this.\r\n            // 1 is full resolution, 0.5 is half, 0.25 is quarter, etc. (must be > than 0.0)\r\n            renderer.setPixelRatio(window.devicePixelRatio);\r\n        this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n        this.renderer.context.getExtension('OES_texture_float');\r\n\r\n        let container = document.getElementById('container');\r\n        container.appendChild(this.renderer.domElement);\r\n    }\r\n    InitScene()\r\n    {\r\n        this.pathTracingScene = new THREE.Scene();\r\n        this.screenTextureScene = new THREE.Scene();\r\n        this.screenOutputScene = new THREE.Scene();\r\n\r\n        this.InitCamera();\r\n\r\n        this.InitRenderTarget();\r\n\r\n        this.InitUniforms();\r\n\r\n        let pathTracingGeometry = new THREE.PlaneBufferGeometry(2, 2);\r\n\r\n        this.pathTracingMesh = new THREE.Mesh(pathTracingGeometry);\r\n        this.pathTracingScene.add(this.pathTracingMesh);\r\n\r\n        // the following keeps the large scene ShaderMaterial quad right in front \r\n        //   of the camera at all times. This is necessary because without it, the scene \r\n        //   quad will fall out of view and get clipped when the camera rotates past 180 degrees.\r\n        this.worldCamera.add(this.pathTracingMesh);\r\n\r\n        let screenTextureGeometry = new THREE.PlaneBufferGeometry(2, 2);\r\n\r\n        let screenTextureMaterial = new THREE.ShaderMaterial({\r\n            uniforms: screenTextureShader.uniforms,\r\n            vertexShader: screenTextureShader.vertexShader,\r\n            fragmentShader: screenTextureShader.fragmentShader,\r\n            depthWrite: false,\r\n            depthTest: false\r\n        });\r\n\r\n        screenTextureMaterial.uniforms.tTexture0.value = this.pathTracingRenderTarget.texture;\r\n\r\n        this.screenTextureMesh = new THREE.Mesh(screenTextureGeometry, screenTextureMaterial);\r\n\r\n        this.screenTextureScene.add(this.screenTextureMesh);\r\n\r\n\r\n        let screenOutputGeometry = new THREE.PlaneBufferGeometry(2, 2);\r\n\r\n        this.screenOutputMaterial = new THREE.ShaderMaterial({\r\n            uniforms: screenOutputShader.uniforms,\r\n            vertexShader: screenOutputShader.vertexShader,\r\n            fragmentShader: screenOutputShader.fragmentShader,\r\n            depthWrite: false,\r\n            depthTest: false\r\n        });\r\n\r\n        this.screenOutputMaterial.uniforms.tTexture0.value = this.pathTracingRenderTarget.texture;\r\n\r\n        let screenOutputMesh = new THREE.Mesh(screenOutputGeometry, this.screenOutputMaterial);\r\n        this.screenOutputScene.add(screenOutputMesh);\r\n\r\n        // Boxes\r\n        let tallBoxMesh = new THREE.Object3D();\r\n        this.pathTracingScene.add(tallBoxMesh);\r\n        tallBoxMesh.rotation.set(0, Math.PI * 0.1, 0);\r\n        tallBoxMesh.position.set(180, 170, -350);\r\n        tallBoxMesh.updateMatrixWorld(true); // 'true' forces immediate matrix update\r\n\r\n        this.pathTracingUniforms.uTallBoxInvMatrix.value.getInverse(tallBoxMesh.matrixWorld);\r\n        this.pathTracingUniforms.uTallBoxNormalMatrix.value.getNormalMatrix(tallBoxMesh.matrixWorld);\r\n\r\n\r\n        let shortBoxMesh = new THREE.Object3D();\r\n        this.pathTracingScene.add(shortBoxMesh);\r\n        shortBoxMesh.rotation.set(0, -Math.PI * 0.09, 0);\r\n        shortBoxMesh.position.set(370, 85, -170);\r\n        shortBoxMesh.updateMatrixWorld(true); // 'true' forces immediate matrix update\r\n\r\n        this.pathTracingUniforms.uShortBoxInvMatrix.value.getInverse(shortBoxMesh.matrixWorld);\r\n        this.pathTracingUniforms.uShortBoxNormalMatrix.value.getNormalMatrix(shortBoxMesh.matrixWorld);\r\n    }\r\n\r\n    LoadDefaultMaterial(fragmentShader: string): THREE.ShaderMaterial\r\n    {\r\n        return new THREE.ShaderMaterial({\r\n            uniforms: this.pathTracingUniforms,\r\n            //defines: pathTracingDefines,\r\n            vertexShader: require('./glsl/pathTracingVertexShader.glsl'),\r\n            fragmentShader: fragmentShader,\r\n            depthTest: false,\r\n            depthWrite: false\r\n        });\r\n    }\r\n\r\n    private InitUniforms()\r\n    {\r\n        this.pathTracingUniforms = {\r\n            tPreviousTexture: { type: \"t\", value: this.screenTextureRenderTarget.texture },\r\n            //tTriangleTexture: { type: \"t\", value: triangleDataTexture },\r\n            uCameraIsMoving: { type: \"b1\", value: false },\r\n            uCameraJustStartedMoving: { type: \"b1\", value: false },\r\n            uTime: { type: \"f\", value: 0.0 },\r\n            uSampleCounter: { type: \"f\", value: 0.0 },\r\n            uMouse: { type: \"v3\", value: new Vector3() },\r\n            uULen: { type: \"f\", value: 1.0 },\r\n            uVLen: { type: \"f\", value: 1.0 },\r\n            uApertureSize: { type: \"f\", value: 0.0 },\r\n            uFocusDistance: { type: \"f\", value: 1180.0 },\r\n            uResolution: { type: \"v2\", value: new THREE.Vector2(this.renderer.context.drawingBufferWidth, this.renderer.context.drawingBufferHeight) },\r\n            //uMeshBBox_min: { type: \"v3\", value: objMeshes.my_mesh.bounding_box_min },\r\n            //uMeshBBox_max: { type: \"v3\", value: objMeshes.my_mesh.bounding_box_max },\r\n            uRandomVector: { type: \"v3\", value: new THREE.Vector3() },\r\n            uCameraMatrix: { type: \"m4\", value: new THREE.Matrix4() },\r\n            uShortBoxInvMatrix: { type: \"m4\", value: new THREE.Matrix4() },\r\n            uShortBoxNormalMatrix: { type: \"m3\", value: new THREE.Matrix3() },\r\n            uTallBoxInvMatrix: { type: \"m4\", value: new THREE.Matrix4() },\r\n            uTallBoxNormalMatrix: { type: \"m3\", value: new THREE.Matrix3() }\r\n        };\r\n    }\r\n\r\n    private InitRenderTarget()\r\n    {\r\n        this.pathTracingRenderTarget = new THREE.WebGLRenderTarget((window.innerWidth * window.devicePixelRatio), (window.innerHeight * window.devicePixelRatio), {\r\n            minFilter: THREE.NearestFilter,\r\n            magFilter: THREE.NearestFilter,\r\n            format: THREE.RGBAFormat,\r\n            type: THREE.FloatType,\r\n            depthBuffer: false,\r\n            stencilBuffer: false\r\n        });\r\n        this.pathTracingRenderTarget.texture.generateMipmaps = false;\r\n        this.screenTextureRenderTarget = new THREE.WebGLRenderTarget((window.innerWidth * window.devicePixelRatio), (window.innerHeight * window.devicePixelRatio), {\r\n            minFilter: THREE.NearestFilter,\r\n            magFilter: THREE.NearestFilter,\r\n            format: THREE.RGBAFormat,\r\n            type: THREE.FloatType,\r\n            depthBuffer: false,\r\n            stencilBuffer: false\r\n        });\r\n        this.screenTextureRenderTarget.texture.generateMipmaps = false;\r\n    }\r\n\r\n    private InitCamera()\r\n    {\r\n        // quadCamera is simply the camera to help render the full screen quad (2 triangles),\r\n        // hence the name.  It is an Orthographic camera that sits facing the view plane, which serves as\r\n        // the window into our 3d world. This camera will not move or rotate for the duration of the app.\r\n        this.quadCamera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);\r\n        this.screenTextureScene.add(this.quadCamera);\r\n        this.screenOutputScene.add(this.quadCamera);\r\n        // worldCamera is the dynamic camera 3d object that will be positioned, oriented and \r\n        // constantly updated inside the 3d scene.  Its view will ultimately get passed back to the \r\n        // stationary quadCamera, which renders the scene to a fullscreen quad (made up of 2 large triangles).\r\n        this.worldCamera = new THREE.PerspectiveCamera(31, window.innerWidth / window.innerHeight, 1, 1000);\r\n        this.pathTracingScene.add(this.worldCamera);\r\n        this.controls = new FirstPersonCameraControls(this.worldCamera);\r\n        this.cameraControlsObject = this.controls.getObject();\r\n        let cameraControlsYawObject = this.controls.getYawObject();\r\n        let cameraControlsPitchObject = this.controls.getPitchObject();\r\n        this.pathTracingScene.add(this.cameraControlsObject);\r\n        this.cameraControlsObject.position.set(278, 270, 1050); // for flyCam\r\n        ///cameraControlsYawObject.rotation.y = 0.0;\r\n        // look slightly upward\r\n        cameraControlsPitchObject.rotation.x = 0.005;\r\n        let oldYawRotation = cameraControlsYawObject.rotation.y;\r\n        let oldPitchRotation = cameraControlsPitchObject.rotation.x;\r\n        // now that we moved and rotated the camera, the following line force-updates the camera's matrix,\r\n        //  and prevents rendering the very first frame in the old default camera position/orientation\r\n        this.cameraControlsObject.updateMatrixWorld(true);\r\n    }\r\n\r\n    OnWindowResize()\r\n    {\r\n        this.SCREEN_WIDTH = window.innerWidth;\r\n        this.SCREEN_HEIGHT = window.innerHeight;\r\n\r\n        this.renderer.setPixelRatio(window.devicePixelRatio);\r\n        this.renderer.setSize(this.SCREEN_WIDTH, this.SCREEN_HEIGHT);\r\n\r\n        let fontAspect = (this.SCREEN_WIDTH / 175) * (this.SCREEN_HEIGHT / 200);\r\n        if (fontAspect > 25) fontAspect = 25;\r\n        if (fontAspect < 4) fontAspect = 4;\r\n        fontAspect *= 2;\r\n\r\n        this.pathTracingUniforms.uResolution.value.x = this.renderer.context.drawingBufferWidth;\r\n        this.pathTracingUniforms.uResolution.value.y = this.renderer.context.drawingBufferHeight;\r\n\r\n        this.pathTracingRenderTarget.setSize(this.renderer.context.drawingBufferWidth, this.renderer.context.drawingBufferHeight);\r\n        this.screenTextureRenderTarget.setSize(this.renderer.context.drawingBufferWidth, this.renderer.context.drawingBufferHeight);\r\n\r\n        this.worldCamera.aspect = this.renderer.domElement.clientWidth / this.renderer.domElement.clientHeight;\r\n        this.worldCamera.updateProjectionMatrix();\r\n\r\n        // the following scales all scene objects by the worldCamera's field of view,\r\n        // taking into account the screen aspect ratio and multiplying the uniform uULen,\r\n        // the x-coordinate, by this ratio\r\n        let fovScale = this.worldCamera.fov * 0.5 * (Math.PI / 180.0);\r\n        this.pathTracingUniforms.uVLen.value = Math.tan(fovScale);\r\n        this.pathTracingUniforms.uULen.value = this.pathTracingUniforms.uVLen.value * this.worldCamera.aspect;\r\n    }\r\n\r\n    RenderCycle = () =>\r\n    {\r\n        requestAnimationFrame(this.RenderCycle);\r\n        this.Render();\r\n        // this.Render();\r\n        // this.Render();\r\n        // this.Render();\r\n    }\r\n\r\n    Render()\r\n    {\r\n        if (this.Disabled) return;\r\n        if (this.controls.mouseDown)\r\n            this.sampleCounter = 1;\r\n\r\n        this.pathTracingUniforms.uCameraIsMoving.value = this.controls.mouseDown;\r\n        this.pathTracingUniforms.uCameraJustStartedMoving.value = this.controls.mouseDown && !this.controls.mouseMove;\r\n        this.pathTracingUniforms.uSampleCounter.value = this.sampleCounter;\r\n        this.pathTracingUniforms.uRandomVector.value.set(Math.random(), Math.random(), Math.random());\r\n        // CAMERA\r\n        this.cameraControlsObject.updateMatrixWorld(true);\r\n        this.pathTracingUniforms.uCameraMatrix.value.copy(this.worldCamera.matrixWorld);\r\n        this.screenOutputMaterial.uniforms.uOneOverSampleCounter.value = 1.0 / this.sampleCounter;\r\n\r\n        let cameraInfoElement = document.getElementById('cameraInfo');\r\n        // cameraInfoElement.innerHTML = \"FOV: \" + this.worldCamera.fov + \" / Aperture: \" + apertureSize.toFixed(2) + \" / FocusDistance: \" + focusDistance + \"<br>\" + \"Samples: \" + sampleCounter;\r\n\r\n        this.sampleCounter++;\r\n        cameraInfoElement.innerHTML = this.sampleCounter.toString();\r\n\r\n        // RENDERING in 3 steps\r\n\r\n        // STEP 1\r\n        // Perform PathTracing and Render(save) into pathTracingRenderTarget\r\n        // Read previous screenTextureRenderTarget to use as a new starting point to blend with\r\n        //执行PathTracing并渲染（保存）到pathTracingRenderTarget中\r\n        //读取前一个screenTextureRenderTarget作为一个新的起点与之交融\r\n        this.renderer.render(this.pathTracingScene, this.worldCamera, this.pathTracingRenderTarget);\r\n\r\n        // STEP 2\r\n        // Render(copy) the final pathTracingScene output(above) into screenTextureRenderTarget\r\n        // This will be used as a new starting point for Step 1 above\r\n        //将最终的pathTracingScene输出（上面）渲染（复制）到screenTextureRenderTarget中\r\n        //这将作为上面第1步的新起点\r\n        this.renderer.render(this.screenTextureScene, this.quadCamera, this.screenTextureRenderTarget);\r\n\r\n        // STEP 3\r\n        // Render full screen quad with generated pathTracingRenderTarget in STEP 1 above.\r\n        // After the image is gamma corrected, it will be shown on the screen as the final accumulated output\r\n        //在上面的步骤1中使用生成的pathTracingRenderTarget渲染全屏四元组。\r\n        //图像经过伽马校正后，它将在屏幕上显示为最终累计输出\r\n        this.renderer.render(this.screenOutputScene, this.quadCamera);\r\n    }\r\n}\r\n\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/PathTracingRenderer.ts","module.exports = dll;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dll\"\n// module id = 3\n// module chunks = 0","import * as THREE from \"three\";\r\n\r\n/**\r\n * originally from https://github.com/mrdoob/three.js/blob/dev/examples/js/controls/PointerLockControls.js\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * edited by Erich Loftis (erichlof on GitHub)\r\n * https://github.com/erichlof\r\n * Btw, this is the most consice and elegant way to implement first person camera rotation/movement that I've ever seen -\r\n * look at how short it is, without spaces/braces it would be around 30 lines!  Way to go, mrdoob!\r\n */\r\n\r\nlet PI_2 = Math.PI / 2;\r\n\r\nexport class FirstPersonCameraControls\r\n{\r\n    mouseMove: boolean = false;\r\n    mouseDown: boolean = false;\r\n    camera: THREE.Camera;\r\n    yawObject: THREE.Object3D;\r\n    pitchObject: THREE.Object3D;\r\n    constructor(camera: THREE.Camera)\r\n    {\r\n        this.camera = camera;\r\n\r\n        camera.rotation.set(0, 0, 0);\r\n\r\n        this.pitchObject = new THREE.Object3D();\r\n        this.pitchObject.add(camera);\r\n\r\n        this.yawObject = new THREE.Object3D();\r\n        this.yawObject.add(this.pitchObject);\r\n\r\n        const scope = this;\r\n\r\n        let movementX = 0;\r\n        let movementY = 0;\r\n\r\n        const onMouseDown = (event: MouseEvent) =>\r\n        {\r\n            if (event.button == 0)\r\n                this.mouseDown = true;\r\n        }\r\n        const onMouseUp = (event: MouseEvent) =>\r\n        {\r\n            if (event.button == 0)\r\n            {\r\n                this.mouseDown = false;\r\n                this.mouseMove = false;\r\n            }\r\n        }\r\n\r\n        const onMouseMove = event =>\r\n        {\r\n            if (!this.mouseDown) return;\r\n\r\n            this.mouseMove = true;\r\n\r\n            movementX = event.movementX || event.mozMovementX || 0;\r\n            movementY = event.movementY || event.mozMovementY || 0;\r\n\r\n            scope.yawObject.rotation.y -= movementX * 0.002;\r\n            scope.pitchObject.rotation.x -= movementY * 0.002;\r\n\r\n            scope.pitchObject.rotation.x = Math.max(- PI_2, Math.min(PI_2, scope.pitchObject.rotation.x));\r\n        };\r\n\r\n\r\n        let container = document.getElementById(\"container\");\r\n        container.addEventListener(\"mousedown\", onMouseDown);\r\n        container.addEventListener(\"mouseup\", onMouseUp);\r\n        container.addEventListener('mousemove', onMouseMove, false);\r\n    }\r\n\r\n    getObject() { return this.yawObject };\r\n\r\n    getYawObject() { return this.yawObject; }\r\n\r\n    getPitchObject() { return this.pitchObject; }\r\n\r\n    getDirection(v)\r\n    {\r\n        const te = this.camera.matrixWorld.elements;\r\n        v.set(te[8], te[9], te[10]).negate();\r\n        return v;\r\n    };\r\n\r\n    getUpVector(v)\r\n    {\r\n        const te = this.camera.matrixWorld.elements;\r\n\r\n        v.set(te[4], te[5], te[6]);\r\n\r\n        return v;\r\n\r\n    };\r\n\r\n    getRightVector(v)\r\n    {\r\n        const te = this.camera.matrixWorld.elements;\r\n        v.set(te[0], te[1], te[2]);\r\n        return v;\r\n    };\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/FirstPersonCameraControls.ts","import * as THREE from \"three\";\r\nexport const screenTextureShader = {\r\n\r\n\tuniforms: THREE.UniformsUtils.merge([\r\n\r\n\t\t{\r\n\t\t\ttTexture0: { type: \"t\", value: null }\r\n\t\t}\r\n\r\n\t]),\r\n\r\n\tvertexShader: [\r\n\r\n\t\t'precision highp float;',\r\n\t\t'precision highp int;',\r\n\r\n\t\t'varying vec2 vUv;',\r\n\r\n\r\n\t\t'void main()',\r\n\t\t'{',\r\n\t\t'vUv = uv;',\r\n\t\t'gl_Position = vec4( position, 1.0 );',\r\n\t\t'}'\r\n\r\n\t].join('\\n'),\r\n\r\n\tfragmentShader: [\r\n\r\n\t\t'precision highp float;',\r\n\t\t'precision highp int;',\r\n\t\t'precision highp sampler2D;',\r\n\r\n\t\t'varying vec2 vUv;',\r\n\t\t'uniform sampler2D tTexture0;',\r\n\r\n\r\n\t\t'void main()',\r\n\t\t'{',\r\n\t\t'gl_FragColor = texture2D(tTexture0, vUv);',\r\n\t\t'}'\r\n\r\n\t].join('\\n')\r\n\r\n};\r\n\r\nexport const screenOutputShader = {\r\n\r\n\tuniforms: THREE.UniformsUtils.merge([\r\n\r\n\t\t{\r\n\t\t\tuOneOverSampleCounter: { type: \"f\", value: 0.0 },\r\n\t\t\ttTexture0: { type: \"t\", value: null }\r\n\t\t}\r\n\r\n\t]),\r\n\r\n\tvertexShader: [\r\n\r\n\t\t'precision highp float;',\r\n\t\t'precision highp int;',\r\n\r\n\t\t'varying vec2 vUv;',\r\n\r\n\r\n\t\t'void main()',\r\n\t\t'{',\r\n\t\t'vUv = uv;',\r\n\t\t'gl_Position = vec4( position, 1.0 );',\r\n\t\t'}'\r\n\r\n\r\n\t].join('\\n'),\r\n\r\n\tfragmentShader: [\r\n\r\n\t\t'precision highp float;',\r\n\t\t'precision highp int;',\r\n\t\t'precision highp sampler2D;',\r\n\r\n\t\t'varying vec2 vUv;',\r\n\t\t'uniform float uOneOverSampleCounter;',\r\n\t\t'uniform sampler2D tTexture0;',\r\n\r\n\t\t'void main()',\r\n\t\t'{',\r\n\t\t'vec4 col = texture2D(tTexture0, vUv) * uOneOverSampleCounter;',// \r\n\t\t'gl_FragColor = sqrt(col);',\r\n\t\t'}'\r\n\r\n\t].join('\\n')\r\n\r\n};\r\n\r\n//#region pathtracing_uniforms_and_defines\r\nTHREE.ShaderChunk['pathtracing_uniforms_and_defines'] = `\r\nuniform bool uCameraIsMoving;\r\nuniform bool uCameraJustStartedMoving;\r\nuniform float uTime;\r\nuniform float uSampleCounter;\r\nuniform float uULen;\r\nuniform float uVLen;\r\nuniform float uApertureSize;\r\nuniform float uFocusDistance;\r\nuniform vec2 uResolution;\r\nuniform vec3 uMouse;\r\nuniform vec3 uRandomVector;\r\nuniform mat4 uCameraMatrix;\r\nuniform sampler2D tPreviousTexture;\r\nvarying vec2 vUv;\r\n#define PI               3.14159265358979323\r\n#define TWO_PI           6.28318530717958648\r\n#define FOUR_PI          12.5663706143591729\r\n#define ONE_OVER_PI      0.31830988618379067\r\n#define ONE_OVER_TWO_PI  0.15915494309\r\n#define ONE_OVER_FOUR_PI 0.07957747154594767\r\n#define PI_OVER_TWO      1.57079632679489662\r\n#define ONE_OVER_THREE   0.33333333333333333\r\n#define E                2.71828182845904524\r\n#define INFINITY         1000000.0\r\n#define LIGHT 0\r\n#define DIFF 1\r\n#define REFR 2\r\n#define SPEC 3\r\n#define CHECK 4\r\n#define COAT 5\r\n#define VOLUME 6\r\n#define TRANSLUCENT 7\r\n#define SPECSUB 8\r\n#define WATER 9\r\n#define WOOD 10\r\n#define SEAFLOOR 11\r\n#define TERRAIN 12\r\n#define CLOTH 13\r\n#define LIGHTWOOD 14\r\n#define DARKWOOD 15\r\n#define PAINTING 16\r\n`;\r\n//#endregion\r\n//#endregion\r\n\r\n\r\n//#region pathtracing_uniforms_and_defines\r\nTHREE.ShaderChunk['pathtracing_skymodel_defines'] = `\r\n#define TURBIDITY 0.3\r\n#define RAYLEIGH_COEFFICIENT 2.0\r\n#define MIE_COEFFICIENT 0.05\r\n#define MIE_DIRECTIONAL_G 0.76\r\n// constants for atmospheric scattering\r\n#define THREE_OVER_SIXTEENPI 0.05968310365946075\r\n#define ONE_OVER_FOURPI 0.07957747154594767\r\n// wavelength of used primaries, according to preetham\r\n#define LAMBDA vec3( 680E-9, 550E-9, 450E-9 )\r\n#define TOTAL_RAYLEIGH vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 )\r\n// mie stuff\r\n// K coefficient for the primaries\r\n#define K vec3(0.686, 0.678, 0.666)\r\n#define MIE_V 4.0\r\n#define MIE_CONST vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 )\r\n// optical length at zenith for molecules\r\n#define RAYLEIGH_ZENITH_LENGTH 8400.0\r\n#define MIE_ZENITH_LENGTH 1250.0\r\n#define UP_VECTOR vec3(0.0, 1.0, 0.0)\r\n#define SUN_INTENSITY 20.0 //800.0 if Uncharted2ToneMap is used\r\n#define SUN_ANGULAR_DIAMETER_COS 0.99983194915 // 66 arc seconds -> degrees, and the cosine of that\r\n#define CUTOFF_ANGLE 1.66 // original value (PI / 1.9) \r\n`;\r\n//#endregion\r\n\r\n\r\n//#region pathtracing_plane_intersect\r\nTHREE.ShaderChunk['pathtracing_plane_intersect'] = `\r\n//-----------------------------------------------------------------------\r\nfloat PlaneIntersect( vec4 pla, Ray r )\r\n//-----------------------------------------------------------------------\r\n{\r\n\tvec3 n = normalize(pla.xyz);\r\n\tfloat denom = dot(n, r.direction);\r\n\t// uncomment the following if single-sided plane is desired\r\n\t//if (denom >= 0.0) \r\n\t//\treturn INFINITY;\r\n\t\r\n        vec3 pOrO = (pla.w * n) - r.origin; \r\n        float result = dot(pOrO, n) / denom;\r\n\treturn (result > 0.0) ? result : INFINITY;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_disk_intersect\r\nTHREE.ShaderChunk['pathtracing_disk_intersect'] = `\r\n//-----------------------------------------------------------------------\r\nfloat DiskIntersect( vec3 diskPos, vec3 normal, float radius, Ray r )\r\n//-----------------------------------------------------------------------\r\n{\r\n\tvec3 n = normalize(-normal);\r\n\tvec3 pOrO = diskPos - r.origin;\r\n\tfloat denom = dot(n, r.direction);\r\n\t// use the following for one-sided disk\r\n\t//if (denom <= 0.0)\r\n\t//\treturn INFINITY;\r\n\t\r\n        float result = dot(pOrO, n) / denom;\r\n\tif (result < 0.0)\r\n\t\treturn INFINITY;\r\n        vec3 intersectPos = r.origin + r.direction * result;\r\n\tvec3 v = intersectPos - diskPos;\r\n\tfloat d2 = dot(v,v);\r\n\tfloat radiusSq = radius * radius;\r\n\tif (d2 > radiusSq)\r\n\t\treturn INFINITY;\r\n\t\t\r\n\treturn result;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_sphere_intersect\r\nTHREE.ShaderChunk['pathtracing_sphere_intersect'] = `\r\n/*\r\nbool solveQuadratic(float A, float B, float C, out float t0, out float t1)\r\n{\r\n\tfloat discrim = B*B-4.0*A*C;\r\n    \t\r\n\tif ( discrim < 0.0 )\r\n        \treturn false;\r\n\t\r\n    \tfloat A2 = 2.0 * A;\r\n\tfloat rootDiscrim = sqrt( discrim );\r\n    \r\n\tfloat t_0 = (-B-rootDiscrim)/A2;\r\n\tfloat t_1 = (-B+rootDiscrim)/A2;\r\n\tt0 = min( t_0, t_1 );\r\n\tt1 = max( t_0, t_1 );\r\n    \r\n\treturn true;\r\n}\r\n*/\r\nbool solveQuadratic(float A, float B, float C, out float t0, out float t1)\r\n{\r\n\tfloat discrim = B*B-4.0*A*C;\r\n    \r\n\tif ( discrim < 0.0 )\r\n        \treturn false;\r\n    \r\n\tfloat rootDiscrim = sqrt( discrim );\r\n\tfloat Q = (B > 0.0) ? -0.5 * (B + rootDiscrim) : -0.5 * (B - rootDiscrim); \r\n\tfloat t_0 = Q / A; \r\n\tfloat t_1 = C / Q;\r\n\t\r\n\tt0 = min( t_0, t_1 );\r\n\tt1 = max( t_0, t_1 );\r\n    \r\n\treturn true;\r\n}\r\n//-----------------------------------------------------------------------\r\nfloat SphereIntersect( float rad, vec3 pos, Ray ray )\r\n//-----------------------------------------------------------------------\r\n{\r\n\tfloat t = INFINITY;\r\n\tfloat t0, t1;\r\n\tvec3 L = ray.origin - pos;\r\n\tfloat a = dot( ray.direction, ray.direction );\r\n\tfloat b = 2.0 * dot( ray.direction, L );\r\n\tfloat c = dot( L, L ) - (rad * rad);\r\n\tif (!solveQuadratic( a, b, c, t0, t1))\r\n\t\treturn INFINITY;\r\n\t\r\n\tif ( t1 > 0.0 )\r\n\t\tt = t1;\r\n\t\t\r\n\tif ( t0 > 0.0 )\r\n\t\tt = t0;\r\n\t\r\n\treturn t;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_ellipsoid_intersect\r\nTHREE.ShaderChunk['pathtracing_ellipsoid_intersect'] = `\r\n//-----------------------------------------------------------------------\r\nfloat EllipsoidIntersect( vec3 radii, vec3 pos, Ray r )\r\n//-----------------------------------------------------------------------\r\n{\r\n\tfloat t = INFINITY;\r\n\tfloat t0, t1;\r\n\tvec3 oc = r.origin - pos;\r\n\tvec3 oc2 = oc*oc;\r\n\tvec3 ocrd = oc*r.direction;\r\n\tvec3 rd2 = r.direction*r.direction;\r\n\tvec3 invRad = 1.0/radii;\r\n\tvec3 invRad2 = invRad*invRad;\r\n\t\r\n\t// quadratic equation coefficients\r\n\tfloat a = dot(rd2, invRad2);\r\n\tfloat b = 2.0*dot(ocrd, invRad2);\r\n\tfloat c = dot(oc2, invRad2) - 1.0;\r\n\tif (!solveQuadratic( a, b, c, t0, t1))\r\n\t\treturn INFINITY;\r\n\t\r\n\tif ( t1 > 0.0 )\r\n\t\tt = t1;\r\n\t\t\r\n\tif ( t0 > 0.0 )\r\n\t\tt = t0;\r\n\t\r\n\treturn t;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_opencylinder_intersect\r\nTHREE.ShaderChunk['pathtracing_opencylinder_intersect'] = `\r\n//---------------------------------------------------------------------------\r\nfloat OpenCylinderIntersect( vec3 p0, vec3 p1, float rad, Ray r, out vec3 n )\r\n//---------------------------------------------------------------------------\r\n{\r\n\tfloat r2=rad*rad;\r\n\t\r\n\tvec3 dp=p1-p0;\r\n\tvec3 dpt=dp/dot(dp,dp);\r\n\t\r\n\tvec3 ao=r.origin-p0;\r\n\tvec3 aoxab=cross(ao,dpt);\r\n\tvec3 vxab=cross(r.direction,dpt);\r\n\tfloat ab2=dot(dpt,dpt);\r\n\tfloat a=2.0*dot(vxab,vxab);\r\n\tfloat ra=1.0/a;\r\n\tfloat b=2.0*dot(vxab,aoxab);\r\n\tfloat c=dot(aoxab,aoxab)-r2*ab2;\r\n\t\r\n\tfloat det=b*b-2.0*a*c;\r\n\t\r\n\tif(det<0.0)\r\n\treturn INFINITY;\r\n\t\r\n\tdet=sqrt(det);\r\n\t\r\n\tfloat t = INFINITY;\r\n\t\r\n\tfloat t0=(-b-det)*ra;\r\n\tfloat t1=(-b+det)*ra;\r\n\t\r\n\tvec3 ip;\r\n\tvec3 lp;\r\n\tfloat ct;\r\n\t\r\n\tif (t1 > 0.0)\r\n\t{\r\n\t\tip=r.origin+r.direction*t1;\r\n\t\tlp=ip-p0;\r\n\t\tct=dot(lp,dpt);\r\n\t\tif((ct>0.0)&&(ct<1.0))\r\n\t\t{\r\n\t\t\tt = t1;\r\n\t\t     \tn=(p0+dp*ct)-ip;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tif (t0 > 0.0)\r\n\t{\r\n\t\tip=r.origin+r.direction*t0;\r\n\t\tlp=ip-p0;\r\n\t\tct=dot(lp,dpt);\r\n\t\tif((ct>0.0)&&(ct<1.0))\r\n\t\t{\r\n\t\t\tt = t0;\r\n\t\t\tn=ip-(p0+dp*ct);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\treturn t;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_cappedcylinder_intersect\r\nTHREE.ShaderChunk['pathtracing_cappedcylinder_intersect'] = `\r\n//-----------------------------------------------------------------------------\r\nfloat CappedCylinderIntersect( vec3 p0, vec3 p1, float rad, Ray r, out vec3 n )\r\n//-----------------------------------------------------------------------------\r\n{\r\n\tfloat r2=rad*rad;\r\n\t\r\n\tvec3 dp=p1-p0;\r\n\tvec3 dpt=dp/dot(dp,dp);\r\n\t\r\n\tvec3 ao=r.origin-p0;\r\n\tvec3 aoxab=cross(ao,dpt);\r\n\tvec3 vxab=cross(r.direction,dpt);\r\n\tfloat ab2=dot(dpt,dpt);\r\n\tfloat a=2.0*dot(vxab,vxab);\r\n\tfloat ra=1.0/a;\r\n\tfloat b=2.0*dot(vxab,aoxab);\r\n\tfloat c=dot(aoxab,aoxab)-r2*ab2;\r\n\t\r\n\tfloat det=b*b-2.0*a*c;\r\n\t\r\n\tif(det<0.0)\r\n\t\treturn INFINITY;\r\n\t\r\n\tdet=sqrt(det);\r\n\t\r\n\tfloat t0=(-b-det)*ra;\r\n\tfloat t1=(-b+det)*ra;\r\n\t\r\n\tvec3 ip;\r\n\tvec3 lp;\r\n\tfloat ct;\r\n\tfloat result = INFINITY;\r\n\t\r\n\t// Cylinder caps\r\n\t// disk0\r\n\tvec3 diskNormal = normalize(dp);\r\n\tfloat denom = dot(diskNormal, r.direction);\r\n\tvec3 pOrO = p0 - r.origin;\r\n\tfloat tDisk0 = dot(pOrO, diskNormal) / denom;\r\n\tif (tDisk0 > 0.0)\r\n\t{\r\n\t\tvec3 intersectPos = r.origin + r.direction * tDisk0;\r\n\t\tvec3 v = intersectPos - p0;\r\n\t\tfloat d2 = dot(v,v);\r\n\t\tif (d2 <= r2)\r\n\t\t{\r\n\t\t\tresult = tDisk0;\r\n\t\t\tn = diskNormal;\r\n\t\t}\r\n\t}\r\n\t\r\n\t// disk1\r\n\tdenom = dot(diskNormal, r.direction);\r\n\tpOrO = p1 - r.origin;\r\n\tfloat tDisk1 = dot(pOrO, diskNormal) / denom;\r\n\tif (tDisk1 > 0.0)\r\n\t{\r\n\t\tvec3 intersectPos = r.origin + r.direction * tDisk1;\r\n\t\tvec3 v = intersectPos - p1;\r\n\t\tfloat d2 = dot(v,v);\r\n\t\tif (d2 <= r2 && tDisk1 < result)\r\n\t\t{\r\n\t\t\tresult = tDisk1;\r\n\t\t\tn = diskNormal;\r\n\t\t}\r\n\t}\r\n\t\r\n\t// Cylinder body\r\n\tif (t1 > 0.0)\r\n\t{\r\n\t\tip=r.origin+r.direction*t1;\r\n\t\tlp=ip-p0;\r\n\t\tct=dot(lp,dpt);\r\n\t\tif(ct>0.0 && ct<1.0 && t1<result)\r\n\t\t{\r\n\t\t\tresult = t1;\r\n\t\t     \tn=(p0+dp*ct)-ip;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tif (t0 > 0.0)\r\n\t{\r\n\t\tip=r.origin+r.direction*t0;\r\n\t\tlp=ip-p0;\r\n\t\tct=dot(lp,dpt);\r\n\t\tif(ct>0.0 && ct<1.0 && t0<result)\r\n\t\t{\r\n\t\t\tresult = t0;\r\n\t\t\tn=ip-(p0+dp*ct);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\treturn result;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_cone_intersect\r\nTHREE.ShaderChunk['pathtracing_cone_intersect'] = `\r\n//----------------------------------------------------------------------------\r\nfloat ConeIntersect( vec3 p0, float r0, vec3 p1, float r1, Ray r, out vec3 n )\r\n//----------------------------------------------------------------------------   \r\n{\r\n\tr0 += 0.1;\r\n\tfloat t = INFINITY;\r\n\tvec3 locX;\r\n\tvec3 locY;\r\n\tvec3 locZ=-(p1-p0)/(1.0 - r1/r0);\r\n\t\r\n\tRay ray = r;\r\n\tray.origin-=p0-locZ;\r\n\t\r\n\tif(abs(locZ.x)<abs(locZ.y))\r\n\t\tlocX=vec3(1,0,0);\r\n\telse\r\n\t\tlocX=vec3(0,1,0);\r\n\t\t\r\n\tfloat len=length(locZ);\r\n\tlocZ=normalize(locZ)/len;\r\n\tlocY=normalize(cross(locX,locZ))/r0;\r\n\tlocX=normalize(cross(locY,locZ))/r0;\r\n\t\r\n\tmat3 tm;\r\n\ttm[0]=locX;\r\n\ttm[1]=locY;\r\n\ttm[2]=locZ;\r\n\t\r\n\tray.direction*=tm;\r\n\tray.origin*=tm;\r\n\t\r\n\tfloat dx=ray.direction.x;\r\n\tfloat dy=ray.direction.y;\r\n\tfloat dz=ray.direction.z;\r\n\t\r\n\tfloat x0=ray.origin.x;\r\n\tfloat y0=ray.origin.y;\r\n\tfloat z0=ray.origin.z;\r\n\t\r\n\tfloat x02=x0*x0;\r\n\tfloat y02=y0*y0;\r\n\tfloat z02=z0*z0;\r\n\t\r\n\tfloat dx2=dx*dx;\r\n\tfloat dy2=dy*dy;\r\n\tfloat dz2=dz*dz;\r\n\t\r\n\tfloat det=(\r\n\t\t-2.0*x0*dx*z0*dz\r\n\t\t+2.0*x0*dx*y0*dy\r\n\t\t-2.0*z0*dz*y0*dy\r\n\t\t+dz2*x02\r\n\t\t+dz2*y02\r\n\t\t+dx2*z02\r\n\t\t+dy2*z02\r\n\t\t-dy2*x02\r\n\t\t-dx2*y02\r\n        );\r\n\t\r\n\tif(det<0.0)\r\n\t\treturn INFINITY;\r\n\t\t\r\n\tfloat t0=(-x0*dx+z0*dz-y0*dy-sqrt(abs(det)))/(dx2-dz2+dy2);\r\n\tfloat t1=(-x0*dx+z0*dz-y0*dy+sqrt(abs(det)))/(dx2-dz2+dy2);\r\n\tvec3 pt0=ray.origin+t0*ray.direction;\r\n\tvec3 pt1=ray.origin+t1*ray.direction;\r\n\t\r\n        if(t1>0.0 && pt1.z>r1/r0 && pt1.z<1.0)\r\n\t{\r\n\t\tt=t1;\r\n\t\tn=pt1;\r\n\t\tn.z=0.0;\r\n\t\tn=normalize(n);\r\n\t\tn.z=-pt1.z/abs(pt1.z);\r\n\t\tn=normalize(n);\r\n\t\tn=tm*-n;\r\n\t}\r\n\t\r\n\tif(t0>0.0 && pt0.z>r1/r0 && pt0.z<1.0)\r\n\t{\r\n\t\tt=t0;\r\n\t\tn=pt0;\r\n\t\tn.z=0.0;\r\n\t\tn=normalize(n);\r\n\t\tn.z=-pt0.z/abs(pt0.z);\r\n\t\tn=normalize(n);\r\n\t\tn=tm*n;\r\n\t}\r\n\t\r\n\treturn t;\t\r\n}\r\n`;\r\n//#endregion\r\n\r\n\r\n//#region pathtracing_capsule_intersect\r\nTHREE.ShaderChunk['pathtracing_capsule_intersect'] = `\r\n//-------------------------------------------------------------------------------\r\nfloat CapsuleIntersect( vec3 p0, float r0, vec3 p1, float r1, Ray r, out vec3 n )\r\n//-------------------------------------------------------------------------------\r\n{\r\n\t/*\r\n\t// used for ConeIntersect below, if different radius sphere end-caps are desired\r\n\tvec3 l  = p1-p0;\r\n\tfloat ld = length(l);\r\n\tl=l/ld;\r\n\tfloat d= r0-r1;\r\n\tfloat sa = d/ld;\r\n\tfloat h0 = r0*sa;\r\n\tfloat h1 = r1*sa;\r\n\tfloat cr0 = sqrt(r0*r0-h0*h0);\r\n\tfloat cr1 = sqrt(r1*r1-h1*h1);\r\n\tvec3 coneP0=p0+l*h0;\r\n\tvec3 coneP1=p1+l*h1;\r\n\t*/\r\n\t\r\n\tfloat t0=INFINITY;\r\n\t    \r\n\tfloat t1;\r\n\tvec3 uv1;\r\n\tvec3 n1;\r\n\t//t1 = ConeIntersect(coneP0,cr0,coneP1,cr1,r,n1);\r\n\tt1 = OpenCylinderIntersect(p0,p1,r0,r,n1);\r\n\tif(t1<t0)\r\n\t{\r\n\t\tt0=t1;\r\n\t\tn=n1;\r\n\t}\r\n\tt1 = SphereIntersect(r0,p0,r);\r\n\tif(t1<t0)\r\n\t{\r\n\t\tt0=t1;\r\n\t\tn=(r.origin + r.direction * t1) - p0;\r\n\t}\r\n\tt1 = SphereIntersect(r1,p1,r);\r\n\tif(t1<t0)\r\n\t{\r\n\t\tt0=t1;\r\n\t\tn=(r.origin + r.direction * t1) - p1;\r\n\t}\r\n\t    \r\n\treturn t0;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_paraboloid_intersect\r\nTHREE.ShaderChunk['pathtracing_paraboloid_intersect'] = `\r\n//------------------------------------------------------------------------------\r\nfloat ParaboloidIntersect( float rad, float height, vec3 pos, Ray r, out vec3 n )\r\n//------------------------------------------------------------------------------\r\n{\r\n\tvec3 rd = r.direction;\r\n\tvec3 ro = r.origin - pos;\r\n\tfloat k = height / (rad * rad);\r\n\t\r\n\t// quadratic equation coefficients\r\n\tfloat a = k * (rd.x * rd.x + rd.z * rd.z);\r\n\tfloat b = k * 2.0 * (rd.x * ro.x + rd.z * ro.z) - rd.y;\r\n\tfloat c = k * (ro.x * ro.x + ro.z * ro.z) - ro.y;\r\n\tfloat t0, t1;\r\n\tif (!solveQuadratic( a, b, c, t0, t1))\r\n\t\treturn INFINITY;\r\n\t\r\n\tvec3 ip1, ip2;\r\n\tfloat result = INFINITY;\r\n\t\r\n\tif (t1 > 0.0)\r\n\t{\t\r\n\t\tip2 = ro + rd * t1;\r\n\t\tif (ip2.y < height)\r\n\t\t{\r\n\t\t\tn = vec3( -2.0 * ip2.x, 2.0 * ip2.y, -2.0 * ip2.z );\r\n\t\t\tresult = t1;\r\n\t\t}\t\t\r\n\t}\r\n\t\r\n\tif (t0 > 0.0)\r\n\t{\r\n\t\tip1 = ro + rd * t0;\r\n\t\tif (ip1.y < height)\r\n\t\t{\r\n\t\t\tn = vec3( 2.0 * ip1.x, -2.0 * ip1.y, 2.0 * ip1.z );\r\n\t\t\tresult = t0;\r\n\t\t}\t\t\r\n\t}\r\n\t\r\n\tif( t0 > 0.0 && t1 > 0.0)\r\n\t{\r\n\t\tfloat dist1 = distance(ro,ip1);\r\n\t\tfloat dist2 = distance(ro,ip2);\r\n\t\t\r\n\t\tif (dist2 < dist1 && ip2.y < height)\r\n\t\t{\r\n\t\t\tn = vec3( -2.0 * ip2.x, 2.0 * ip2.y, -2.0 * ip2.z );\r\n\t\t\tresult = t1;\r\n\t\t}\t\r\n\t\t\r\n\t\tif (dist1 < dist2 && ip1.y < height)\r\n\t\t{\r\n\t\t\tn = vec3( 2.0 * ip1.x, -2.0 * ip1.y, 2.0 * ip1.z );\r\n\t\t\tresult = t0;\r\n\t\t}\t\t\t\r\n\t}\r\n\t\r\n\treturn result;\t\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_torus_intersect\r\nTHREE.ShaderChunk['pathtracing_torus_intersect'] = `\r\nfloat map_Torus( in vec3 pos )\r\n{\r\n\treturn length( vec2(length(pos.xz)-torii[0].radius0,pos.y) )-torii[0].radius1;\r\n}\r\nvec3 calcNormal_Torus( in vec3 pos )\r\n{\r\n\t// epsilon = a small number\r\n\tvec2 e = vec2(1.0,-1.0)*0.5773*0.0002;\r\n\treturn normalize( e.xyy*map_Torus( pos + e.xyy ) + \r\n\t\t\t  e.yyx*map_Torus( pos + e.yyx ) + \r\n\t\t\t  e.yxy*map_Torus( pos + e.yxy ) + \r\n\t\t\t  e.xxx*map_Torus( pos + e.xxx ) );\r\n}\r\n/* \r\nThanks to koiava for the ray marching strategy! https://www.shadertoy.com/user/koiava \r\n*/\r\nfloat TorusIntersect( float rad0, float rad1, Ray r )\r\n{\t\r\n\tvec3 n;\r\n\tfloat d = CappedCylinderIntersect( vec3(0,rad1,0), vec3(0,-rad1,0), rad0+rad1, r, n );\r\n\tif (d == INFINITY)\r\n\t\treturn INFINITY;\r\n\t\r\n\tvec3 pos = r.origin;\r\n\tfloat t = 0.0;\r\n\tfloat torusFar = d + (rad0 * 2.0) + (rad1 * 2.0);\r\n\tfor (int i = 0; i < 200; i++)\r\n\t{\r\n\t\td = map_Torus(pos);\r\n\t\tif (d < 0.001 || t > torusFar) break;\r\n\t\tpos += r.direction * d;\r\n\t\tt += d;\r\n\t}\r\n\t\r\n\treturn (d<0.001) ? t : INFINITY;\r\n}\r\n/*\r\n// borrowed from iq: https://www.shadertoy.com/view/4sBGDy\r\n//-----------------------------------------------------------------------\r\nfloat TorusIntersect( float rad0, float rad1, vec3 pos, Ray ray )\r\n//-----------------------------------------------------------------------\r\n{\r\n\tvec3 rO = ray.origin - pos;\r\n\tvec3 rD = ray.direction;\r\n\t\r\n\tfloat Ra2 = rad0*rad0;\r\n\tfloat ra2 = rad1*rad1;\r\n\t\r\n\tfloat m = dot(rO,rO);\r\n\tfloat n = dot(rO,rD);\r\n\t\t\r\n\tfloat k = (m - ra2 - Ra2) * 0.5;\r\n\tfloat a = n;\r\n\tfloat b = n*n + Ra2*rD.z*rD.z + k;\r\n\tfloat c = k*n + Ra2*rO.z*rD.z;\r\n\tfloat d = k*k + Ra2*rO.z*rO.z - Ra2*ra2;\r\n\t\r\n\tfloat a2 = a * a;\r\n\tfloat p = -3.0*a2     + 2.0*b;\r\n\tfloat q =  2.0*a2*a   - 2.0*a*b   + 2.0*c;\r\n\tfloat r = -3.0*a2*a2 + 4.0*a2*b - 8.0*a*c + 4.0*d;\r\n\tp *= ONE_OVER_THREE;\r\n\tr *= ONE_OVER_THREE;\r\n\tfloat p2 = p * p;\r\n\tfloat Q = p2 + r;\r\n\tfloat R = 3.0*r*p - p2*p - q*q;\r\n\t\r\n\tfloat h = R*R - Q*Q*Q;\r\n\tfloat z = 0.0;\r\n\tif( h < 0.0 )\r\n\t{\r\n\t\tfloat sQ = sqrt(Q);\r\n\t\tz = 2.0*sQ*cos( acos(R/(sQ*Q)) * ONE_OVER_THREE );\r\n\t}\r\n\telse\r\n\t{\r\n\t\tfloat sQ = pow( sqrt(h) + abs(R), ONE_OVER_THREE );\r\n\t\tz = sign(R)*abs( sQ + Q/sQ );\r\n\t}\r\n\t\r\n\tz = p - z;\r\n\t\t\r\n\tfloat d1 = z   - 3.0*p;\r\n\tfloat d2 = z*z - 3.0*r;\r\n\tif( abs(d1)<0.5 ) // originally < 0.0001, but this was too precise and caused holes when viewed from the side\r\n\t{\r\n\t\tif( d2<0.0 ) return INFINITY;\r\n\t\td2 = sqrt(d2);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif( d1<0.0 ) return INFINITY;\r\n\t\td1 = sqrt( d1*0.5 );\r\n\t\td2 = q/d1;\r\n\t}\r\n\t\r\n\tfloat result = INFINITY;\r\n\tfloat d1SqMinusZ = d1*d1 - z;\r\n\t\r\n\th = d1SqMinusZ - d2;\r\n\tif( h>0.0 )\r\n\t{\r\n\t\th = sqrt(h);\r\n\t\tfloat t1 = d1 - h - a;\r\n\t\tfloat t2 = d1 + h - a;\r\n\t\tif( t2>0.0 ) result=t2;\r\n\t\tif( t1>0.0 ) result=t1;\r\n\t}\r\n\th = d1SqMinusZ + d2;\r\n\tif( h>0.0 )\r\n\t{\r\n\t\th = sqrt(h);\r\n\t\tfloat t1 = -d1 - h - a;\r\n\t\tfloat t2 = -d1 + h - a;\r\n\t\tif( t2>0.0 ) result=min(result,t2);\r\n\t\tif( t1>0.0 ) result=min(result,t1); \r\n\t}\r\n\treturn result;\r\n}\r\n*/\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_quad_intersect\r\nTHREE.ShaderChunk['pathtracing_quad_intersect'] = `\r\n//----------------------------------------------------------------------------\r\nfloat QuadIntersect( vec3 v0, vec3 v1, vec3 v2, vec3 v3, vec3 normal, Ray r )\r\n//----------------------------------------------------------------------------\r\n{\r\n\tvec3 u, v, n;    // triangle vectors\r\n\tvec3 w0, w, x;   // ray and intersection vectors\r\n\tfloat rt, a, b;  // params to calc ray-plane intersect\r\n\t\r\n\t// get first triangle edge vectors and plane normal\r\n\tv = v2 - v0;\r\n\tu = v1 - v0; // switched u and v names to save calculation later below\r\n\t//n = cross(v, u); // switched u and v names to save calculation later below\r\n\tn = -normal; // can avoid cross product if normal is already known\r\n\t    \r\n\tw0 = r.origin - v0;\r\n\ta = -dot(n,w0);\r\n\tb = dot(n, r.direction);\r\n\tif (b < 0.0001)   // ray is parallel to quad plane\r\n\t\treturn INFINITY;\r\n\t// get intersect point of ray with quad plane\r\n\trt = a / b;\r\n\tif (rt < 0.0)          // ray goes away from quad\r\n\t\treturn INFINITY;   // => no intersect\r\n\t    \r\n\tx = r.origin + rt * r.direction; // intersect point of ray and plane\r\n\t// is x inside first Triangle?\r\n\tfloat uu, uv, vv, wu, wv, D;\r\n\tuu = dot(u,u);\r\n\tuv = dot(u,v);\r\n\tvv = dot(v,v);\r\n\tw = x - v0;\r\n\twu = dot(w,u);\r\n\twv = dot(w,v);\r\n\tD = 1.0 / (uv * uv - uu * vv);\r\n\t// get and test parametric coords\r\n\tfloat s, t;\r\n\ts = (uv * wv - vv * wu) * D;\r\n\tif (s >= 0.0 && s <= 1.0)\r\n\t{\r\n\t\tt = (uv * wu - uu * wv) * D;\r\n\t\tif (t >= 0.0 && (s + t) <= 1.0)\r\n\t\t{\r\n\t\t\treturn rt;\r\n\t\t}\r\n\t}\r\n\t\r\n\t// is x inside second Triangle?\r\n\tu = v3 - v0;\r\n\t///v = v2 - v0;  //optimization - already calculated above\r\n\tuu = dot(u,u);\r\n\tuv = dot(u,v);\r\n\t///vv = dot(v,v);//optimization - already calculated above\r\n\t///w = x - v0;   //optimization - already calculated above\r\n\twu = dot(w,u);\r\n\t///wv = dot(w,v);//optimization - already calculated above\r\n\tD = 1.0 / (uv * uv - uu * vv);\r\n\t// get and test parametric coords\r\n\ts = (uv * wv - vv * wu) * D;\r\n\tif (s >= 0.0 && s <= 1.0)\r\n\t{\r\n\t\tt = (uv * wu - uu * wv) * D;\r\n\t\tif (t >= 0.0 && (s + t) <= 1.0)\r\n\t\t{\r\n\t\t\treturn rt;\r\n\t\t}\r\n\t}\r\n\treturn INFINITY;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_box_intersect\r\nTHREE.ShaderChunk['pathtracing_box_intersect'] = `\r\n//--------------------------------------------------------------------------\r\nfloat BoxIntersect( vec3 minCorner, vec3 maxCorner, Ray r, out vec3 normal )\r\n//--------------------------------------------------------------------------\r\n{\r\n\tvec3 invDir = 1.0 / r.direction;\r\n\tvec3 tmin = (minCorner - r.origin) * invDir;\r\n\tvec3 tmax = (maxCorner - r.origin) * invDir;\r\n\t\r\n\tvec3 real_min = min(tmin, tmax);\r\n\tvec3 real_max = max(tmin, tmax);\r\n\t\r\n\tfloat minmax = min( min(real_max.x, real_max.y), real_max.z);\r\n\tfloat maxmin = max( max(real_min.x, real_min.y), real_min.z);\r\n\t\r\n\tif (minmax > maxmin)\r\n\t{\r\n\t\t\r\n\t\tif (maxmin > 0.0) // if we are outside the box\r\n\t\t{\r\n\t\t\tnormal = -sign(r.direction) * step(real_min.yzx, real_min) * step(real_min.zxy, real_min);\r\n\t\t\treturn maxmin;\t\r\n\t\t}\r\n\t\t\r\n\t\telse if (minmax > 0.0) // else if we are inside the box\r\n\t\t{\r\n\t\t\tnormal = -sign(r.direction) * step(real_max, real_max.yzx) * step(real_max, real_max.zxy);\r\n\t\t\treturn minmax;\r\n\t\t}\r\n\t\t\t\t\r\n\t}\r\n\t\r\n\treturn INFINITY;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_boundingbox_intersect\r\nTHREE.ShaderChunk['pathtracing_boundingbox_intersect'] = `\r\n//--------------------------------------------------------------------------------------\r\nbool BoundingBoxIntersect( vec3 minCorner, vec3 maxCorner, vec3 rayOrigin, vec3 invDir )\r\n//--------------------------------------------------------------------------------------\r\n{\r\n\tvec3 tmin = (minCorner - rayOrigin) * invDir;\r\n\tvec3 tmax = (maxCorner - rayOrigin) * invDir;\r\n\tvec3 real_min = min(tmin, tmax);\r\n   \tvec3 real_max = max(tmin, tmax);\r\n   \r\n   \tfloat minmax = min( min(real_max.x, real_max.y), real_max.z);\r\n   \tfloat maxmin = max( max(real_min.x, real_min.y), real_min.z);\r\n\t//return minmax > maxmin;\r\n\treturn minmax > max(maxmin, 0.0);\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_triangle_intersect\r\nTHREE.ShaderChunk['pathtracing_triangle_intersect'] = `\r\n//---------------------------------------------------------\r\nfloat TriangleIntersect( vec3 v0, vec3 v1, vec3 v2, Ray r )\r\n//---------------------------------------------------------\r\n{\r\n\tvec3 edge1 = v1 - v0;\r\n\tvec3 edge2 = v2 - v0;\r\n\tvec3 tvec = r.origin - v0;\r\n\tvec3 pvec = cross(r.direction, edge2);\r\n\tfloat det = 1.0 / dot(edge1, pvec);\r\n\tfloat u = dot(tvec, pvec) * det;\r\n\tif (u < 0.0 || u > 1.0)\r\n\t\treturn INFINITY;\r\n\tvec3 qvec = cross(tvec, edge1);\r\n\tfloat v = dot(r.direction, qvec) * det;\r\n\tif (v < 0.0 || u + v > 1.0)\r\n\t\treturn INFINITY;\r\n\treturn dot(edge2, qvec) * det;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_physical_sky_functions\r\nTHREE.ShaderChunk['pathtracing_physical_sky_functions'] = `\r\nfloat RayleighPhase(float cosTheta)\r\n{\r\n\treturn THREE_OVER_SIXTEENPI * (1.0 + (cosTheta * cosTheta));\r\n}\r\nfloat hgPhase(float cosTheta, float g)\r\n{\r\n        float g2 = g * g;\r\n        float inverse = 1.0 / pow(1.0 - 2.0 * g * cosTheta + g2, 1.5);\r\n\treturn ONE_OVER_FOURPI * ((1.0 - g2) * inverse);\r\n}\r\nvec3 totalMie()\r\n{\r\n\tfloat c = (0.2 * TURBIDITY) * 10E-18;\r\n\treturn 0.434 * c * MIE_CONST;\r\n}\r\nfloat SunIntensity(float zenithAngleCos)\r\n{\r\n\treturn SUN_INTENSITY * max( 0.0, 1.0 - exp( -( CUTOFF_ANGLE - acos(zenithAngleCos) ) ) );\r\n}\r\nvec3 Get_Sky_Color(Ray r, vec3 sunDirection)\r\n{\r\n\t\r\n    \tvec3 viewDir = normalize(r.direction);\r\n\t\r\n\t/* most of the following code is borrowed from the three.js shader file: SkyShader.js */\r\n    \t// Cosine angles\r\n\tfloat cosViewSunAngle = max(0.001, dot(viewDir, sunDirection));\r\n    \tfloat cosSunUpAngle = dot(sunDirection, UP_VECTOR); // allowed to be negative: + is daytime, - is nighttime\r\n    \tfloat cosUpViewAngle = max(0.001, dot(UP_VECTOR, viewDir)); // cannot be 0, used as divisor\r\n\t\r\n        // Get sun intensity based on how high in the sky it is\r\n    \tfloat sunE = SunIntensity(cosSunUpAngle);\r\n        \r\n\t// extinction (absorbtion + out scattering)\r\n\t// rayleigh coefficients\r\n    \tvec3 rayleighAtX = TOTAL_RAYLEIGH * RAYLEIGH_COEFFICIENT;\r\n    \r\n\t// mie coefficients\r\n\tvec3 mieAtX = totalMie() * MIE_COEFFICIENT;  \r\n    \r\n\t// optical length\r\n\tfloat zenithAngle = 1.0 / cosUpViewAngle;\r\n    \r\n\tfloat rayleighOpticalLength = RAYLEIGH_ZENITH_LENGTH * zenithAngle;\r\n\tfloat mieOpticalLength = MIE_ZENITH_LENGTH * zenithAngle;\r\n\t// combined extinction factor\t\r\n\tvec3 Fex = exp(-(rayleighAtX * rayleighOpticalLength + mieAtX * mieOpticalLength));\r\n\t// in scattering\r\n\tvec3 rayleighXtoEye = rayleighAtX * RayleighPhase(cosViewSunAngle);\r\n\tvec3 mieXtoEye = mieAtX * hgPhase(cosViewSunAngle, MIE_DIRECTIONAL_G);\r\n     \r\n    \tvec3 totalLightAtX = rayleighAtX + mieAtX;\r\n    \tvec3 lightFromXtoEye = rayleighXtoEye + mieXtoEye; \r\n    \r\n    \tvec3 somethingElse = sunE * (lightFromXtoEye / totalLightAtX);\r\n    \r\n    \tvec3 sky = somethingElse * (1.0 - Fex);\r\n\tfloat oneMinusCosSun = 1.0 - cosSunUpAngle;\r\n    \tsky *= mix( vec3(1.0), pow(somethingElse * Fex,vec3(0.5)), \r\n\t    clamp(oneMinusCosSun * oneMinusCosSun * oneMinusCosSun * oneMinusCosSun * oneMinusCosSun, 0.0, 1.0) );\r\n\t// composition + solar disc\r\n    \tfloat sundisk = smoothstep(SUN_ANGULAR_DIAMETER_COS, SUN_ANGULAR_DIAMETER_COS, cosViewSunAngle + 0.0004);\r\n\tvec3 sun = (sunE * SUN_INTENSITY * Fex) * sundisk;\r\n\t\r\n\treturn sky + sun;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_random_functions\r\nTHREE.ShaderChunk['pathtracing_random_functions'] = `\r\nfloat rand( inout float seed )\r\n{ \r\n\tseed -= uRandomVector.x * uRandomVector.y;\r\n\treturn fract( sin( seed ) * 43758.5453123 );\r\n}\r\nvec3 randomSphereDirection( inout float seed )\r\n{\r\n    \tvec2 r = vec2(rand(seed), rand(seed)) * TWO_PI;\r\n\treturn vec3( sin(r.x) * vec2(sin(r.y), cos(r.y)), cos(r.x) );\t\r\n}\r\nvec3 randomDirectionInHemisphere( vec3 n, inout float seed )\r\n{\r\n\tvec2 r = vec2(rand(seed), rand(seed)) * TWO_PI;\r\n\tvec3 dr = vec3( sin(r.x) * vec2(sin(r.y), cos(r.y)), cos(r.x) );\t\r\n\treturn dot(dr,n) * dr;\r\n}\r\nvec3 randomCosWeightedDirectionInHemisphere( vec3 nl, inout float seed )\r\n{\r\n\tfloat up = sqrt(rand(seed)); // weighted cos(theta)\r\n    \tfloat over = sqrt(1.0 - up * up); // sin(theta)\r\n    \tfloat around = rand(seed) * TWO_PI;\r\n\tvec3 u = normalize( cross( abs(nl.x) > 0.1 ? vec3(0, 1, 0) : vec3(1, 0, 0), nl ) );\r\n\tvec3 v = normalize( cross(nl, u) );\r\n    \treturn vec3( cos(around) * over * u ) + ( sin(around) * over * v ) + (up * nl);\t\t\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_direct_lighting_sphere\r\nTHREE.ShaderChunk['pathtracing_direct_lighting_sphere'] = `\r\nvec3 calcDirectLightingSphere(vec3 mask, vec3 x, vec3 nl, Sphere light, inout float seed)\r\n{\r\n\tvec3 dirLight = vec3(0.0);\r\n\tIntersection shadowIntersec;\r\n\t\r\n\t// cast shadow ray from intersection point\r\n\tvec3 ld = light.position + (randomSphereDirection(seed) * light.radius);\r\n\tvec3 srDir = normalize(ld - x);\r\n\t\t\r\n\tRay shadowRay = Ray(x, srDir);\r\n\tshadowRay.origin += nl * 2.0;\r\n\tfloat st = SceneIntersect(shadowRay, shadowIntersec);\r\n\tif ( shadowIntersec.type == LIGHT )\r\n\t{\r\n\t\tfloat r2 = light.radius * light.radius;\r\n\t\tvec3 d = light.position - shadowRay.origin;\r\n\t\tfloat d2 = dot(d,d);\r\n\t\tfloat cos_a_max = sqrt(1. - clamp( r2 / d2, 0., 1.));\r\n                float weight = 2. * (1. - cos_a_max);\r\n                dirLight = mask * light.emission * weight * max(0.01, dot(srDir, nl));\r\n\t}\r\n\t\r\n\treturn dirLight;\r\n}\r\n`;\r\n//#endregion\r\n\r\n//#region pathtracing_direct_lighting_quad\r\nTHREE.ShaderChunk['pathtracing_direct_lighting_quad'] = `\r\nvec3 calcDirectLightingQuad(vec3 mask, vec3 x, vec3 nl, Quad light, inout float seed)\r\n{\r\n\tvec3 dirLight = vec3(0.0);\r\n\tIntersection shadowIntersec;\r\n\tvec3 randPointOnLight;\r\n\trandPointOnLight.x = mix(light.v0.x, light.v1.x, rand(seed));\r\n\trandPointOnLight.y = light.v0.y;\r\n\trandPointOnLight.z = mix(light.v0.z, light.v3.z, rand(seed));\r\n\tvec3 srDir = normalize(randPointOnLight - x);\r\n\tfloat nlDotSrDir = max(dot(nl, srDir), 0.01);\r\n\t\t\r\n\t// cast shadow ray from intersection point\t\r\n\tRay shadowRay = Ray(x, srDir);\r\n\tshadowRay.origin += nl * 2.0; // larger dimensions of this scene require greater offsets\r\n\tfloat st = SceneIntersect(shadowRay, shadowIntersec);\r\n\tif ( shadowIntersec.type == LIGHT )\r\n\t{\r\n\t\tfloat r2 = distance(light.v0, light.v1) * distance(light.v0, light.v3);\r\n\t\tvec3 d = randPointOnLight - shadowRay.origin;\r\n\t\tfloat d2 = dot(d, d);\r\n\t\tfloat weight = dot(-srDir, normalize(shadowIntersec.normal)) * r2 / d2;\r\n\t\tdirLight = mask * light.emission * nlDotSrDir * clamp(weight, 0.0, 1.0);\r\n\t}\r\n\treturn dirLight;\r\n}\r\n`;\r\n//#endregion pathtracing_main\r\n\r\nTHREE.ShaderChunk['pathtracing_main'] = require(\"./pathtracing_main.glsl\");\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/glsl/pathTracingCommon.ts","module.exports = \"void main( void )\\r\\n{\\r\\n\\t// not needed, three.js has a built-in uniform named cameraPosition\\r\\n\\t//vec3 camPos     = vec3( uCameraMatrix[3][0],  uCameraMatrix[3][1],  uCameraMatrix[3][2]);\\r\\n\\t\\r\\n    vec3 camRight   = vec3( uCameraMatrix[0][0],  uCameraMatrix[0][1],  uCameraMatrix[0][2]);\\r\\n    vec3 camUp      = vec3( uCameraMatrix[1][0],  uCameraMatrix[1][1],  uCameraMatrix[1][2]);\\r\\n\\tvec3 camForward = vec3(-uCameraMatrix[2][0], -uCameraMatrix[2][1], -uCameraMatrix[2][2]);\\r\\n\\t\\r\\n\\t// seed for rand(seed) function\\r\\n\\tfloat seed = mod(uSampleCounter,1000.0) * uRandomVector.x - uRandomVector.y + uResolution.y * gl_FragCoord.x / uResolution.x + uResolution.x * gl_FragCoord.y / uResolution.y;\\r\\n\\t\\r\\n\\tfloat r1 = 2.0 * rand(seed);\\r\\n\\tfloat r2 = 2.0 * rand(seed);\\r\\n\\t\\r\\n\\tvec2 pixelPos = vec2(0);\\r\\n\\tvec2 offset = vec2(0);\\r\\n\\tif ( !uCameraIsMoving ) \\r\\n\\t{\\r\\n\\t\\toffset.x = r1 < 1.0 ? sqrt(r1) - 1.0 : 1.0 - sqrt(2.0 - r1);\\r\\n        offset.y = r2 < 1.0 ? sqrt(r2) - 1.0 : 1.0 - sqrt(2.0 - r2);\\r\\n\\t}\\r\\n\\t\\r\\n\\toffset /= (uResolution);\\r\\n\\tpixelPos = (2.0 * (vUv + offset) - 1.0);\\r\\n\\tvec3 rayDir = normalize( pixelPos.x * camRight * uULen + pixelPos.y * camUp * uVLen + camForward );\\r\\n\\t\\r\\n\\t// depth of field\\r\\n\\tvec3 focalPoint = uFocusDistance * rayDir;\\r\\n\\tfloat randomAngle = rand(seed) * TWO_PI; // pick random point on aperture\\r\\n\\tfloat randomRadius = rand(seed) * uApertureSize;\\r\\n\\tvec3  randomAperturePos = ( cos(randomAngle) * camRight + sin(randomAngle) * camUp ) * randomRadius;\\r\\n\\t// point on aperture to focal point\\r\\n\\tvec3 finalRayDir = normalize(focalPoint - randomAperturePos);\\r\\n\\t\\r\\n\\tRay ray = Ray( cameraPosition + randomAperturePos , finalRayDir );\\r\\n\\tSetupScene();\\r\\n\\t     \\t\\t\\r\\n\\t// perform path tracing and get resulting pixel color\\r\\n\\tvec3 pixelColor = CalculateRadiance( ray, seed );\\r\\n\\t\\r\\n\\tvec3 previousColor = texture2D(tPreviousTexture, vUv).rgb;\\r\\n\\t\\r\\n\\tif ( uSampleCounter == 1.0 )\\r\\n\\t{\\r\\n\\t\\tpreviousColor = vec3(0.0); // clear rendering accumulation buffer\\r\\n\\t}\\r\\n\\telse if ( uCameraIsMoving )\\r\\n\\t{\\r\\n\\t\\tpreviousColor *= 0.5; // motion-blur trail amount (old image)\\r\\n\\t\\tpixelColor *= 0.5; // brightness of new image (noisy)\\r\\n\\t}\\r\\n\\t\\t\\r\\n\\tgl_FragColor = vec4( pixelColor + previousColor, 1.0 );\\r\\n\\t\\r\\n}\\r\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/glsl/pathtracing_main.glsl\n// module id = 6\n// module chunks = 0","module.exports = \"precision highp float;\\r\\nprecision highp int;\\r\\nvarying vec2 vUv;\\r\\nvoid main()\\r\\n{\\r\\n\\tvUv = uv;\\r\\n\\tgl_Position = vec4( position, 1.0 );\\r\\n}\\r\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/glsl/pathTracingVertexShader.glsl\n// module id = 7\n// module chunks = 0","/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.dat = factory());\n}(this, (function () { 'use strict';\n\nfunction ___$insertStyle(css) {\n  if (!css) {\n    return;\n  }\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  var style = document.createElement('style');\n\n  style.setAttribute('type', 'text/css');\n  style.innerHTML = css;\n  document.head.appendChild(style);\n\n  return css;\n}\n\nfunction colorToString (color, forceCSSHex) {\n  var colorFormat = color.__state.conversionName.toString();\n  var r = Math.round(color.r);\n  var g = Math.round(color.g);\n  var b = Math.round(color.b);\n  var a = color.a;\n  var h = Math.round(color.h);\n  var s = color.s.toFixed(1);\n  var v = color.v.toFixed(1);\n  if (forceCSSHex || colorFormat === 'THREE_CHAR_HEX' || colorFormat === 'SIX_CHAR_HEX') {\n    var str = color.hex.toString(16);\n    while (str.length < 6) {\n      str = '0' + str;\n    }\n    return '#' + str;\n  } else if (colorFormat === 'CSS_RGB') {\n    return 'rgb(' + r + ',' + g + ',' + b + ')';\n  } else if (colorFormat === 'CSS_RGBA') {\n    return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n  } else if (colorFormat === 'HEX') {\n    return '0x' + color.hex.toString(16);\n  } else if (colorFormat === 'RGB_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ']';\n  } else if (colorFormat === 'RGBA_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ',' + a + ']';\n  } else if (colorFormat === 'RGB_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + '}';\n  } else if (colorFormat === 'RGBA_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + ',a:' + a + '}';\n  } else if (colorFormat === 'HSV_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + '}';\n  } else if (colorFormat === 'HSVA_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + ',a:' + a + '}';\n  }\n  return 'unknown format';\n}\n\nvar ARR_EACH = Array.prototype.forEach;\nvar ARR_SLICE = Array.prototype.slice;\nvar Common = {\n  BREAK: {},\n  extend: function extend(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (!this.isUndefined(obj[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  defaults: function defaults(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (this.isUndefined(target[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  compose: function compose() {\n    var toCall = ARR_SLICE.call(arguments);\n    return function () {\n      var args = ARR_SLICE.call(arguments);\n      for (var i = toCall.length - 1; i >= 0; i--) {\n        args = [toCall[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  },\n  each: function each(obj, itr, scope) {\n    if (!obj) {\n      return;\n    }\n    if (ARR_EACH && obj.forEach && obj.forEach === ARR_EACH) {\n      obj.forEach(itr, scope);\n    } else if (obj.length === obj.length + 0) {\n      var key = void 0;\n      var l = void 0;\n      for (key = 0, l = obj.length; key < l; key++) {\n        if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) {\n          return;\n        }\n      }\n    } else {\n      for (var _key in obj) {\n        if (itr.call(scope, obj[_key], _key) === this.BREAK) {\n          return;\n        }\n      }\n    }\n  },\n  defer: function defer(fnc) {\n    setTimeout(fnc, 0);\n  },\n  debounce: function debounce(func, threshold, callImmediately) {\n    var timeout = void 0;\n    return function () {\n      var obj = this;\n      var args = arguments;\n      function delayed() {\n        timeout = null;\n        if (!callImmediately) func.apply(obj, args);\n      }\n      var callNow = callImmediately || !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(delayed, threshold);\n      if (callNow) {\n        func.apply(obj, args);\n      }\n    };\n  },\n  toArray: function toArray(obj) {\n    if (obj.toArray) return obj.toArray();\n    return ARR_SLICE.call(obj);\n  },\n  isUndefined: function isUndefined(obj) {\n    return obj === undefined;\n  },\n  isNull: function isNull(obj) {\n    return obj === null;\n  },\n  isNaN: function (_isNaN) {\n    function isNaN(_x) {\n      return _isNaN.apply(this, arguments);\n    }\n    isNaN.toString = function () {\n      return _isNaN.toString();\n    };\n    return isNaN;\n  }(function (obj) {\n    return isNaN(obj);\n  }),\n  isArray: Array.isArray || function (obj) {\n    return obj.constructor === Array;\n  },\n  isObject: function isObject(obj) {\n    return obj === Object(obj);\n  },\n  isNumber: function isNumber(obj) {\n    return obj === obj + 0;\n  },\n  isString: function isString(obj) {\n    return obj === obj + '';\n  },\n  isBoolean: function isBoolean(obj) {\n    return obj === false || obj === true;\n  },\n  isFunction: function isFunction(obj) {\n    return Object.prototype.toString.call(obj) === '[object Function]';\n  }\n};\n\nvar INTERPRETATIONS = [\n{\n  litmus: Common.isString,\n  conversions: {\n    THREE_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString() + test[1].toString() + test[2].toString() + test[2].toString() + test[3].toString() + test[3].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    SIX_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9]{6})$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGB: {\n      read: function read(original) {\n        var test = original.match(/^rgb\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3])\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGBA: {\n      read: function read(original) {\n        var test = original.match(/^rgba\\(\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*,\\s*(.+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3]),\n          a: parseFloat(test[4])\n        };\n      },\n      write: colorToString\n    }\n  }\n},\n{\n  litmus: Common.isNumber,\n  conversions: {\n    HEX: {\n      read: function read(original) {\n        return {\n          space: 'HEX',\n          hex: original,\n          conversionName: 'HEX'\n        };\n      },\n      write: function write(color) {\n        return color.hex;\n      }\n    }\n  }\n},\n{\n  litmus: Common.isArray,\n  conversions: {\n    RGB_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 3) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b];\n      }\n    },\n    RGBA_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 4) return false;\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2],\n          a: original[3]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b, color.a];\n      }\n    }\n  }\n},\n{\n  litmus: Common.isObject,\n  conversions: {\n    RGBA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b) && Common.isNumber(original.a)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b,\n          a: color.a\n        };\n      }\n    },\n    RGB_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b\n        };\n      }\n    },\n    HSVA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v) && Common.isNumber(original.a)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v,\n          a: color.a\n        };\n      }\n    },\n    HSV_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v\n        };\n      }\n    }\n  }\n}];\nvar result = void 0;\nvar toReturn = void 0;\nvar interpret = function interpret() {\n  toReturn = false;\n  var original = arguments.length > 1 ? Common.toArray(arguments) : arguments[0];\n  Common.each(INTERPRETATIONS, function (family) {\n    if (family.litmus(original)) {\n      Common.each(family.conversions, function (conversion, conversionName) {\n        result = conversion.read(original);\n        if (toReturn === false && result !== false) {\n          toReturn = result;\n          result.conversionName = conversionName;\n          result.conversion = conversion;\n          return Common.BREAK;\n        }\n      });\n      return Common.BREAK;\n    }\n  });\n  return toReturn;\n};\n\nvar tmpComponent = void 0;\nvar ColorMath = {\n  hsv_to_rgb: function hsv_to_rgb(h, s, v) {\n    var hi = Math.floor(h / 60) % 6;\n    var f = h / 60 - Math.floor(h / 60);\n    var p = v * (1.0 - s);\n    var q = v * (1.0 - f * s);\n    var t = v * (1.0 - (1.0 - f) * s);\n    var c = [[v, t, p], [q, v, p], [p, v, t], [p, q, v], [t, p, v], [v, p, q]][hi];\n    return {\n      r: c[0] * 255,\n      g: c[1] * 255,\n      b: c[2] * 255\n    };\n  },\n  rgb_to_hsv: function rgb_to_hsv(r, g, b) {\n    var min = Math.min(r, g, b);\n    var max = Math.max(r, g, b);\n    var delta = max - min;\n    var h = void 0;\n    var s = void 0;\n    if (max !== 0) {\n      s = delta / max;\n    } else {\n      return {\n        h: NaN,\n        s: 0,\n        v: 0\n      };\n    }\n    if (r === max) {\n      h = (g - b) / delta;\n    } else if (g === max) {\n      h = 2 + (b - r) / delta;\n    } else {\n      h = 4 + (r - g) / delta;\n    }\n    h /= 6;\n    if (h < 0) {\n      h += 1;\n    }\n    return {\n      h: h * 360,\n      s: s,\n      v: max / 255\n    };\n  },\n  rgb_to_hex: function rgb_to_hex(r, g, b) {\n    var hex = this.hex_with_component(0, 2, r);\n    hex = this.hex_with_component(hex, 1, g);\n    hex = this.hex_with_component(hex, 0, b);\n    return hex;\n  },\n  component_from_hex: function component_from_hex(hex, componentIndex) {\n    return hex >> componentIndex * 8 & 0xFF;\n  },\n  hex_with_component: function hex_with_component(hex, componentIndex, value) {\n    return value << (tmpComponent = componentIndex * 8) | hex & ~(0xFF << tmpComponent);\n  }\n};\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\n\n\nvar get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar possibleConstructorReturn = function (self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n};\n\nvar Color = function () {\n  function Color() {\n    classCallCheck(this, Color);\n    this.__state = interpret.apply(this, arguments);\n    if (this.__state === false) {\n      throw new Error('Failed to interpret color arguments');\n    }\n    this.__state.a = this.__state.a || 1;\n  }\n  createClass(Color, [{\n    key: 'toString',\n    value: function toString() {\n      return colorToString(this);\n    }\n  }, {\n    key: 'toHexString',\n    value: function toHexString() {\n      return colorToString(this, true);\n    }\n  }, {\n    key: 'toOriginal',\n    value: function toOriginal() {\n      return this.__state.conversion.write(this);\n    }\n  }]);\n  return Color;\n}();\nfunction defineRGBComponent(target, component, componentHexIndex) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'RGB') {\n        return this.__state[component];\n      }\n      Color.recalculateRGB(this, component, componentHexIndex);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'RGB') {\n        Color.recalculateRGB(this, component, componentHexIndex);\n        this.__state.space = 'RGB';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nfunction defineHSVComponent(target, component) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'HSV') {\n        return this.__state[component];\n      }\n      Color.recalculateHSV(this);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'HSV') {\n        Color.recalculateHSV(this);\n        this.__state.space = 'HSV';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nColor.recalculateRGB = function (color, component, componentHexIndex) {\n  if (color.__state.space === 'HEX') {\n    color.__state[component] = ColorMath.component_from_hex(color.__state.hex, componentHexIndex);\n  } else if (color.__state.space === 'HSV') {\n    Common.extend(color.__state, ColorMath.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n  } else {\n    throw new Error('Corrupted color state');\n  }\n};\nColor.recalculateHSV = function (color) {\n  var result = ColorMath.rgb_to_hsv(color.r, color.g, color.b);\n  Common.extend(color.__state, {\n    s: result.s,\n    v: result.v\n  });\n  if (!Common.isNaN(result.h)) {\n    color.__state.h = result.h;\n  } else if (Common.isUndefined(color.__state.h)) {\n    color.__state.h = 0;\n  }\n};\nColor.COMPONENTS = ['r', 'g', 'b', 'h', 's', 'v', 'hex', 'a'];\ndefineRGBComponent(Color.prototype, 'r', 2);\ndefineRGBComponent(Color.prototype, 'g', 1);\ndefineRGBComponent(Color.prototype, 'b', 0);\ndefineHSVComponent(Color.prototype, 'h');\ndefineHSVComponent(Color.prototype, 's');\ndefineHSVComponent(Color.prototype, 'v');\nObject.defineProperty(Color.prototype, 'a', {\n  get: function get$$1() {\n    return this.__state.a;\n  },\n  set: function set$$1(v) {\n    this.__state.a = v;\n  }\n});\nObject.defineProperty(Color.prototype, 'hex', {\n  get: function get$$1() {\n    if (!this.__state.space !== 'HEX') {\n      this.__state.hex = ColorMath.rgb_to_hex(this.r, this.g, this.b);\n    }\n    return this.__state.hex;\n  },\n  set: function set$$1(v) {\n    this.__state.space = 'HEX';\n    this.__state.hex = v;\n  }\n});\n\nvar Controller = function () {\n  function Controller(object, property) {\n    classCallCheck(this, Controller);\n    this.initialValue = object[property];\n    this.domElement = document.createElement('div');\n    this.object = object;\n    this.property = property;\n    this.__onChange = undefined;\n    this.__onFinishChange = undefined;\n  }\n  createClass(Controller, [{\n    key: 'onChange',\n    value: function onChange(fnc) {\n      this.__onChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'onFinishChange',\n    value: function onFinishChange(fnc) {\n      this.__onFinishChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'setValue',\n    value: function setValue(newValue) {\n      this.object[this.property] = newValue;\n      if (this.__onChange) {\n        this.__onChange.call(this, newValue);\n      }\n      this.updateDisplay();\n      return this;\n    }\n  }, {\n    key: 'getValue',\n    value: function getValue() {\n      return this.object[this.property];\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      return this;\n    }\n  }, {\n    key: 'isModified',\n    value: function isModified() {\n      return this.initialValue !== this.getValue();\n    }\n  }]);\n  return Controller;\n}();\n\nvar EVENT_MAP = {\n  HTMLEvents: ['change'],\n  MouseEvents: ['click', 'mousemove', 'mousedown', 'mouseup', 'mouseover'],\n  KeyboardEvents: ['keydown']\n};\nvar EVENT_MAP_INV = {};\nCommon.each(EVENT_MAP, function (v, k) {\n  Common.each(v, function (e) {\n    EVENT_MAP_INV[e] = k;\n  });\n});\nvar CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\nfunction cssValueToPixels(val) {\n  if (val === '0' || Common.isUndefined(val)) {\n    return 0;\n  }\n  var match = val.match(CSS_VALUE_PIXELS);\n  if (!Common.isNull(match)) {\n    return parseFloat(match[1]);\n  }\n  return 0;\n}\nvar dom = {\n  makeSelectable: function makeSelectable(elem, selectable) {\n    if (elem === undefined || elem.style === undefined) return;\n    elem.onselectstart = selectable ? function () {\n      return false;\n    } : function () {};\n    elem.style.MozUserSelect = selectable ? 'auto' : 'none';\n    elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\n    elem.unselectable = selectable ? 'on' : 'off';\n  },\n  makeFullscreen: function makeFullscreen(elem, hor, vert) {\n    var vertical = vert;\n    var horizontal = hor;\n    if (Common.isUndefined(horizontal)) {\n      horizontal = true;\n    }\n    if (Common.isUndefined(vertical)) {\n      vertical = true;\n    }\n    elem.style.position = 'absolute';\n    if (horizontal) {\n      elem.style.left = 0;\n      elem.style.right = 0;\n    }\n    if (vertical) {\n      elem.style.top = 0;\n      elem.style.bottom = 0;\n    }\n  },\n  fakeEvent: function fakeEvent(elem, eventType, pars, aux) {\n    var params = pars || {};\n    var className = EVENT_MAP_INV[eventType];\n    if (!className) {\n      throw new Error('Event type ' + eventType + ' not supported.');\n    }\n    var evt = document.createEvent(className);\n    switch (className) {\n      case 'MouseEvents':\n        {\n          var clientX = params.x || params.clientX || 0;\n          var clientY = params.y || params.clientY || 0;\n          evt.initMouseEvent(eventType, params.bubbles || false, params.cancelable || true, window, params.clickCount || 1, 0,\n          0,\n          clientX,\n          clientY,\n          false, false, false, false, 0, null);\n          break;\n        }\n      case 'KeyboardEvents':\n        {\n          var init = evt.initKeyboardEvent || evt.initKeyEvent;\n          Common.defaults(params, {\n            cancelable: true,\n            ctrlKey: false,\n            altKey: false,\n            shiftKey: false,\n            metaKey: false,\n            keyCode: undefined,\n            charCode: undefined\n          });\n          init(eventType, params.bubbles || false, params.cancelable, window, params.ctrlKey, params.altKey, params.shiftKey, params.metaKey, params.keyCode, params.charCode);\n          break;\n        }\n      default:\n        {\n          evt.initEvent(eventType, params.bubbles || false, params.cancelable || true);\n          break;\n        }\n    }\n    Common.defaults(evt, aux);\n    elem.dispatchEvent(evt);\n  },\n  bind: function bind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.addEventListener) {\n      elem.addEventListener(event, func, bool);\n    } else if (elem.attachEvent) {\n      elem.attachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  unbind: function unbind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.removeEventListener) {\n      elem.removeEventListener(event, func, bool);\n    } else if (elem.detachEvent) {\n      elem.detachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  addClass: function addClass(elem, className) {\n    if (elem.className === undefined) {\n      elem.className = className;\n    } else if (elem.className !== className) {\n      var classes = elem.className.split(/ +/);\n      if (classes.indexOf(className) === -1) {\n        classes.push(className);\n        elem.className = classes.join(' ').replace(/^\\s+/, '').replace(/\\s+$/, '');\n      }\n    }\n    return dom;\n  },\n  removeClass: function removeClass(elem, className) {\n    if (className) {\n      if (elem.className === className) {\n        elem.removeAttribute('class');\n      } else {\n        var classes = elem.className.split(/ +/);\n        var index = classes.indexOf(className);\n        if (index !== -1) {\n          classes.splice(index, 1);\n          elem.className = classes.join(' ');\n        }\n      }\n    } else {\n      elem.className = undefined;\n    }\n    return dom;\n  },\n  hasClass: function hasClass(elem, className) {\n    return new RegExp('(?:^|\\\\s+)' + className + '(?:\\\\s+|$)').test(elem.className) || false;\n  },\n  getWidth: function getWidth(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-left-width']) + cssValueToPixels(style['border-right-width']) + cssValueToPixels(style['padding-left']) + cssValueToPixels(style['padding-right']) + cssValueToPixels(style.width);\n  },\n  getHeight: function getHeight(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-top-width']) + cssValueToPixels(style['border-bottom-width']) + cssValueToPixels(style['padding-top']) + cssValueToPixels(style['padding-bottom']) + cssValueToPixels(style.height);\n  },\n  getOffset: function getOffset(el) {\n    var elem = el;\n    var offset = { left: 0, top: 0 };\n    if (elem.offsetParent) {\n      do {\n        offset.left += elem.offsetLeft;\n        offset.top += elem.offsetTop;\n        elem = elem.offsetParent;\n      } while (elem);\n    }\n    return offset;\n  },\n  isActive: function isActive(elem) {\n    return elem === document.activeElement && (elem.type || elem.href);\n  }\n};\n\nvar BooleanController = function (_Controller) {\n  inherits(BooleanController, _Controller);\n  function BooleanController(object, property) {\n    classCallCheck(this, BooleanController);\n    var _this2 = possibleConstructorReturn(this, (BooleanController.__proto__ || Object.getPrototypeOf(BooleanController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__prev = _this2.getValue();\n    _this2.__checkbox = document.createElement('input');\n    _this2.__checkbox.setAttribute('type', 'checkbox');\n    function onChange() {\n      _this.setValue(!_this.__prev);\n    }\n    dom.bind(_this2.__checkbox, 'change', onChange, false);\n    _this2.domElement.appendChild(_this2.__checkbox);\n    _this2.updateDisplay();\n    return _this2;\n  }\n  createClass(BooleanController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      this.__prev = this.getValue();\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (this.getValue() === true) {\n        this.__checkbox.setAttribute('checked', 'checked');\n        this.__checkbox.checked = true;\n        this.__prev = true;\n      } else {\n        this.__checkbox.checked = false;\n        this.__prev = false;\n      }\n      return get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return BooleanController;\n}(Controller);\n\nvar OptionController = function (_Controller) {\n  inherits(OptionController, _Controller);\n  function OptionController(object, property, opts) {\n    classCallCheck(this, OptionController);\n    var _this2 = possibleConstructorReturn(this, (OptionController.__proto__ || Object.getPrototypeOf(OptionController)).call(this, object, property));\n    var options = opts;\n    var _this = _this2;\n    _this2.__select = document.createElement('select');\n    if (Common.isArray(options)) {\n      var map = {};\n      Common.each(options, function (element) {\n        map[element] = element;\n      });\n      options = map;\n    }\n    Common.each(options, function (value, key) {\n      var opt = document.createElement('option');\n      opt.innerHTML = key;\n      opt.setAttribute('value', value);\n      _this.__select.appendChild(opt);\n    });\n    _this2.updateDisplay();\n    dom.bind(_this2.__select, 'change', function () {\n      var desiredValue = this.options[this.selectedIndex].value;\n      _this.setValue(desiredValue);\n    });\n    _this2.domElement.appendChild(_this2.__select);\n    return _this2;\n  }\n  createClass(OptionController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (dom.isActive(this.__select)) return this;\n      this.__select.value = this.getValue();\n      return get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return OptionController;\n}(Controller);\n\nvar StringController = function (_Controller) {\n  inherits(StringController, _Controller);\n  function StringController(object, property) {\n    classCallCheck(this, StringController);\n    var _this2 = possibleConstructorReturn(this, (StringController.__proto__ || Object.getPrototypeOf(StringController)).call(this, object, property));\n    var _this = _this2;\n    function onChange() {\n      _this.setValue(_this.__input.value);\n    }\n    function onBlur() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'keyup', onChange);\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        this.blur();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(StringController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (!dom.isActive(this.__input)) {\n        this.__input.value = this.getValue();\n      }\n      return get(StringController.prototype.__proto__ || Object.getPrototypeOf(StringController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return StringController;\n}(Controller);\n\nfunction numDecimals(x) {\n  var _x = x.toString();\n  if (_x.indexOf('.') > -1) {\n    return _x.length - _x.indexOf('.') - 1;\n  }\n  return 0;\n}\nvar NumberController = function (_Controller) {\n  inherits(NumberController, _Controller);\n  function NumberController(object, property, params) {\n    classCallCheck(this, NumberController);\n    var _this = possibleConstructorReturn(this, (NumberController.__proto__ || Object.getPrototypeOf(NumberController)).call(this, object, property));\n    var _params = params || {};\n    _this.__min = _params.min;\n    _this.__max = _params.max;\n    _this.__step = _params.step;\n    if (Common.isUndefined(_this.__step)) {\n      if (_this.initialValue === 0) {\n        _this.__impliedStep = 1;\n      } else {\n        _this.__impliedStep = Math.pow(10, Math.floor(Math.log(Math.abs(_this.initialValue)) / Math.LN10)) / 10;\n      }\n    } else {\n      _this.__impliedStep = _this.__step;\n    }\n    _this.__precision = numDecimals(_this.__impliedStep);\n    return _this;\n  }\n  createClass(NumberController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var _v = v;\n      if (this.__min !== undefined && _v < this.__min) {\n        _v = this.__min;\n      } else if (this.__max !== undefined && _v > this.__max) {\n        _v = this.__max;\n      }\n      if (this.__step !== undefined && _v % this.__step !== 0) {\n        _v = Math.round(_v / this.__step) * this.__step;\n      }\n      return get(NumberController.prototype.__proto__ || Object.getPrototypeOf(NumberController.prototype), 'setValue', this).call(this, _v);\n    }\n  }, {\n    key: 'min',\n    value: function min(minValue) {\n      this.__min = minValue;\n      return this;\n    }\n  }, {\n    key: 'max',\n    value: function max(maxValue) {\n      this.__max = maxValue;\n      return this;\n    }\n  }, {\n    key: 'step',\n    value: function step(stepValue) {\n      this.__step = stepValue;\n      this.__impliedStep = stepValue;\n      this.__precision = numDecimals(stepValue);\n      return this;\n    }\n  }]);\n  return NumberController;\n}(Controller);\n\nfunction roundToDecimal(value, decimals) {\n  var tenTo = Math.pow(10, decimals);\n  return Math.round(value * tenTo) / tenTo;\n}\nvar NumberControllerBox = function (_NumberController) {\n  inherits(NumberControllerBox, _NumberController);\n  function NumberControllerBox(object, property, params) {\n    classCallCheck(this, NumberControllerBox);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerBox.__proto__ || Object.getPrototypeOf(NumberControllerBox)).call(this, object, property, params));\n    _this2.__truncationSuspended = false;\n    var _this = _this2;\n    var prevY = void 0;\n    function onChange() {\n      var attempted = parseFloat(_this.__input.value);\n      if (!Common.isNaN(attempted)) {\n        _this.setValue(attempted);\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onBlur() {\n      onFinish();\n    }\n    function onMouseDrag(e) {\n      var diff = prevY - e.clientY;\n      _this.setValue(_this.getValue() + diff * _this.__impliedStep);\n      prevY = e.clientY;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      onFinish();\n    }\n    function onMouseDown(e) {\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      prevY = e.clientY;\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'mousedown', onMouseDown);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        _this.__truncationSuspended = true;\n        this.blur();\n        _this.__truncationSuspended = false;\n        onFinish();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(NumberControllerBox, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      this.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal(this.getValue(), this.__precision);\n      return get(NumberControllerBox.prototype.__proto__ || Object.getPrototypeOf(NumberControllerBox.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerBox;\n}(NumberController);\n\nfunction map(v, i1, i2, o1, o2) {\n  return o1 + (o2 - o1) * ((v - i1) / (i2 - i1));\n}\nvar NumberControllerSlider = function (_NumberController) {\n  inherits(NumberControllerSlider, _NumberController);\n  function NumberControllerSlider(object, property, min, max, step) {\n    classCallCheck(this, NumberControllerSlider);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerSlider.__proto__ || Object.getPrototypeOf(NumberControllerSlider)).call(this, object, property, { min: min, max: max, step: step }));\n    var _this = _this2;\n    _this2.__background = document.createElement('div');\n    _this2.__foreground = document.createElement('div');\n    dom.bind(_this2.__background, 'mousedown', onMouseDown);\n    dom.bind(_this2.__background, 'touchstart', onTouchStart);\n    dom.addClass(_this2.__background, 'slider');\n    dom.addClass(_this2.__foreground, 'slider-fg');\n    function onMouseDown(e) {\n      document.activeElement.blur();\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      onMouseDrag(e);\n    }\n    function onMouseDrag(e) {\n      e.preventDefault();\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(e.clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n      return false;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onTouchStart(e) {\n      if (e.touches.length !== 1) {\n        return;\n      }\n      dom.bind(window, 'touchmove', onTouchMove);\n      dom.bind(window, 'touchend', onTouchEnd);\n      onTouchMove(e);\n    }\n    function onTouchMove(e) {\n      var clientX = e.touches[0].clientX;\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n    }\n    function onTouchEnd() {\n      dom.unbind(window, 'touchmove', onTouchMove);\n      dom.unbind(window, 'touchend', onTouchEnd);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.updateDisplay();\n    _this2.__background.appendChild(_this2.__foreground);\n    _this2.domElement.appendChild(_this2.__background);\n    return _this2;\n  }\n  createClass(NumberControllerSlider, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var pct = (this.getValue() - this.__min) / (this.__max - this.__min);\n      this.__foreground.style.width = pct * 100 + '%';\n      return get(NumberControllerSlider.prototype.__proto__ || Object.getPrototypeOf(NumberControllerSlider.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerSlider;\n}(NumberController);\n\nvar FunctionController = function (_Controller) {\n  inherits(FunctionController, _Controller);\n  function FunctionController(object, property, text) {\n    classCallCheck(this, FunctionController);\n    var _this2 = possibleConstructorReturn(this, (FunctionController.__proto__ || Object.getPrototypeOf(FunctionController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__button = document.createElement('div');\n    _this2.__button.innerHTML = text === undefined ? 'Fire' : text;\n    dom.bind(_this2.__button, 'click', function (e) {\n      e.preventDefault();\n      _this.fire();\n      return false;\n    });\n    dom.addClass(_this2.__button, 'button');\n    _this2.domElement.appendChild(_this2.__button);\n    return _this2;\n  }\n  createClass(FunctionController, [{\n    key: 'fire',\n    value: function fire() {\n      if (this.__onChange) {\n        this.__onChange.call(this);\n      }\n      this.getValue().call(this.object);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n    }\n  }]);\n  return FunctionController;\n}(Controller);\n\nvar ColorController = function (_Controller) {\n  inherits(ColorController, _Controller);\n  function ColorController(object, property) {\n    classCallCheck(this, ColorController);\n    var _this2 = possibleConstructorReturn(this, (ColorController.__proto__ || Object.getPrototypeOf(ColorController)).call(this, object, property));\n    _this2.__color = new Color(_this2.getValue());\n    _this2.__temp = new Color(0);\n    var _this = _this2;\n    _this2.domElement = document.createElement('div');\n    dom.makeSelectable(_this2.domElement, false);\n    _this2.__selector = document.createElement('div');\n    _this2.__selector.className = 'selector';\n    _this2.__saturation_field = document.createElement('div');\n    _this2.__saturation_field.className = 'saturation-field';\n    _this2.__field_knob = document.createElement('div');\n    _this2.__field_knob.className = 'field-knob';\n    _this2.__field_knob_border = '2px solid ';\n    _this2.__hue_knob = document.createElement('div');\n    _this2.__hue_knob.className = 'hue-knob';\n    _this2.__hue_field = document.createElement('div');\n    _this2.__hue_field.className = 'hue-field';\n    _this2.__input = document.createElement('input');\n    _this2.__input.type = 'text';\n    _this2.__input_textShadow = '0 1px 1px ';\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        onBlur.call(this);\n      }\n    });\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__selector, 'mousedown', function ()        {\n      dom.addClass(this, 'drag').bind(window, 'mouseup', function ()        {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    dom.bind(_this2.__selector, 'touchstart', function ()        {\n      dom.addClass(this, 'drag').bind(window, 'touchend', function ()        {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    var valueField = document.createElement('div');\n    Common.extend(_this2.__selector.style, {\n      width: '122px',\n      height: '102px',\n      padding: '3px',\n      backgroundColor: '#222',\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\n    });\n    Common.extend(_this2.__field_knob.style, {\n      position: 'absolute',\n      width: '12px',\n      height: '12px',\n      border: _this2.__field_knob_border + (_this2.__color.v < 0.5 ? '#fff' : '#000'),\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\n      borderRadius: '12px',\n      zIndex: 1\n    });\n    Common.extend(_this2.__hue_knob.style, {\n      position: 'absolute',\n      width: '15px',\n      height: '2px',\n      borderRight: '4px solid #fff',\n      zIndex: 1\n    });\n    Common.extend(_this2.__saturation_field.style, {\n      width: '100px',\n      height: '100px',\n      border: '1px solid #555',\n      marginRight: '3px',\n      display: 'inline-block',\n      cursor: 'pointer'\n    });\n    Common.extend(valueField.style, {\n      width: '100%',\n      height: '100%',\n      background: 'none'\n    });\n    linearGradient(valueField, 'top', 'rgba(0,0,0,0)', '#000');\n    Common.extend(_this2.__hue_field.style, {\n      width: '15px',\n      height: '100px',\n      border: '1px solid #555',\n      cursor: 'ns-resize',\n      position: 'absolute',\n      top: '3px',\n      right: '3px'\n    });\n    hueGradient(_this2.__hue_field);\n    Common.extend(_this2.__input.style, {\n      outline: 'none',\n      textAlign: 'center',\n      color: '#fff',\n      border: 0,\n      fontWeight: 'bold',\n      textShadow: _this2.__input_textShadow + 'rgba(0,0,0,0.7)'\n    });\n    dom.bind(_this2.__saturation_field, 'mousedown', fieldDown);\n    dom.bind(_this2.__saturation_field, 'touchstart', fieldDown);\n    dom.bind(_this2.__field_knob, 'mousedown', fieldDown);\n    dom.bind(_this2.__field_knob, 'touchstart', fieldDown);\n    dom.bind(_this2.__hue_field, 'mousedown', fieldDownH);\n    dom.bind(_this2.__hue_field, 'touchstart', fieldDownH);\n    function fieldDown(e) {\n      setSV(e);\n      dom.bind(window, 'mousemove', setSV);\n      dom.bind(window, 'touchmove', setSV);\n      dom.bind(window, 'mouseup', fieldUpSV);\n      dom.bind(window, 'touchend', fieldUpSV);\n    }\n    function fieldDownH(e) {\n      setH(e);\n      dom.bind(window, 'mousemove', setH);\n      dom.bind(window, 'touchmove', setH);\n      dom.bind(window, 'mouseup', fieldUpH);\n      dom.bind(window, 'touchend', fieldUpH);\n    }\n    function fieldUpSV() {\n      dom.unbind(window, 'mousemove', setSV);\n      dom.unbind(window, 'touchmove', setSV);\n      dom.unbind(window, 'mouseup', fieldUpSV);\n      dom.unbind(window, 'touchend', fieldUpSV);\n      onFinish();\n    }\n    function fieldUpH() {\n      dom.unbind(window, 'mousemove', setH);\n      dom.unbind(window, 'touchmove', setH);\n      dom.unbind(window, 'mouseup', fieldUpH);\n      dom.unbind(window, 'touchend', fieldUpH);\n      onFinish();\n    }\n    function onBlur() {\n      var i = interpret(this.value);\n      if (i !== false) {\n        _this.__color.__state = i;\n        _this.setValue(_this.__color.toOriginal());\n      } else {\n        this.value = _this.__color.toString();\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.__color.toOriginal());\n      }\n    }\n    _this2.__saturation_field.appendChild(valueField);\n    _this2.__selector.appendChild(_this2.__field_knob);\n    _this2.__selector.appendChild(_this2.__saturation_field);\n    _this2.__selector.appendChild(_this2.__hue_field);\n    _this2.__hue_field.appendChild(_this2.__hue_knob);\n    _this2.domElement.appendChild(_this2.__input);\n    _this2.domElement.appendChild(_this2.__selector);\n    _this2.updateDisplay();\n    function setSV(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__saturation_field.getBoundingClientRect();\n      var _ref = e.touches && e.touches[0] || e,\n          clientX = _ref.clientX,\n          clientY = _ref.clientY;\n      var s = (clientX - fieldRect.left) / (fieldRect.right - fieldRect.left);\n      var v = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (v > 1) {\n        v = 1;\n      } else if (v < 0) {\n        v = 0;\n      }\n      if (s > 1) {\n        s = 1;\n      } else if (s < 0) {\n        s = 0;\n      }\n      _this.__color.v = v;\n      _this.__color.s = s;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    function setH(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__hue_field.getBoundingClientRect();\n      var _ref2 = e.touches && e.touches[0] || e,\n          clientY = _ref2.clientY;\n      var h = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (h > 1) {\n        h = 1;\n      } else if (h < 0) {\n        h = 0;\n      }\n      _this.__color.h = h * 360;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    return _this2;\n  }\n  createClass(ColorController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var i = interpret(this.getValue());\n      if (i !== false) {\n        var mismatch = false;\n        Common.each(Color.COMPONENTS, function (component) {\n          if (!Common.isUndefined(i[component]) && !Common.isUndefined(this.__color.__state[component]) && i[component] !== this.__color.__state[component]) {\n            mismatch = true;\n            return {};\n          }\n        }, this);\n        if (mismatch) {\n          Common.extend(this.__color.__state, i);\n        }\n      }\n      Common.extend(this.__temp.__state, this.__color.__state);\n      this.__temp.a = 1;\n      var flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;\n      var _flip = 255 - flip;\n      Common.extend(this.__field_knob.style, {\n        marginLeft: 100 * this.__color.s - 7 + 'px',\n        marginTop: 100 * (1 - this.__color.v) - 7 + 'px',\n        backgroundColor: this.__temp.toHexString(),\n        border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'\n      });\n      this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + 'px';\n      this.__temp.s = 1;\n      this.__temp.v = 1;\n      linearGradient(this.__saturation_field, 'left', '#fff', this.__temp.toHexString());\n      this.__input.value = this.__color.toString();\n      Common.extend(this.__input.style, {\n        backgroundColor: this.__color.toHexString(),\n        color: 'rgb(' + flip + ',' + flip + ',' + flip + ')',\n        textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'\n      });\n    }\n  }]);\n  return ColorController;\n}(Controller);\nvar vendors = ['-moz-', '-o-', '-webkit-', '-ms-', ''];\nfunction linearGradient(elem, x, a, b) {\n  elem.style.background = '';\n  Common.each(vendors, function (vendor) {\n    elem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';\n  });\n}\nfunction hueGradient(elem) {\n  elem.style.background = '';\n  elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n  elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n}\n\nvar css = {\n  load: function load(url, indoc) {\n    var doc = indoc || document;\n    var link = doc.createElement('link');\n    link.type = 'text/css';\n    link.rel = 'stylesheet';\n    link.href = url;\n    doc.getElementsByTagName('head')[0].appendChild(link);\n  },\n  inject: function inject(cssContent, indoc) {\n    var doc = indoc || document;\n    var injected = document.createElement('style');\n    injected.type = 'text/css';\n    injected.innerHTML = cssContent;\n    var head = doc.getElementsByTagName('head')[0];\n    try {\n      head.appendChild(injected);\n    } catch (e) {\n    }\n  }\n};\n\nvar saveDialogContents = \"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n\\n    </div>\\n\\n  </div>\\n\\n</div>\";\n\nvar ControllerFactory = function ControllerFactory(object, property) {\n  var initialValue = object[property];\n  if (Common.isArray(arguments[2]) || Common.isObject(arguments[2])) {\n    return new OptionController(object, property, arguments[2]);\n  }\n  if (Common.isNumber(initialValue)) {\n    if (Common.isNumber(arguments[2]) && Common.isNumber(arguments[3])) {\n      if (Common.isNumber(arguments[4])) {\n        return new NumberControllerSlider(object, property, arguments[2], arguments[3], arguments[4]);\n      }\n      return new NumberControllerSlider(object, property, arguments[2], arguments[3]);\n    }\n    if (Common.isNumber(arguments[4])) {\n      return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3], step: arguments[4] });\n    }\n    return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3] });\n  }\n  if (Common.isString(initialValue)) {\n    return new StringController(object, property);\n  }\n  if (Common.isFunction(initialValue)) {\n    return new FunctionController(object, property, '');\n  }\n  if (Common.isBoolean(initialValue)) {\n    return new BooleanController(object, property);\n  }\n  return null;\n};\n\nfunction requestAnimationFrame(callback) {\n  setTimeout(callback, 1000 / 60);\n}\nvar requestAnimationFrame$1 = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || requestAnimationFrame;\n\nvar CenteredDiv = function () {\n  function CenteredDiv() {\n    classCallCheck(this, CenteredDiv);\n    this.backgroundElement = document.createElement('div');\n    Common.extend(this.backgroundElement.style, {\n      backgroundColor: 'rgba(0,0,0,0.8)',\n      top: 0,\n      left: 0,\n      display: 'none',\n      zIndex: '1000',\n      opacity: 0,\n      WebkitTransition: 'opacity 0.2s linear',\n      transition: 'opacity 0.2s linear'\n    });\n    dom.makeFullscreen(this.backgroundElement);\n    this.backgroundElement.style.position = 'fixed';\n    this.domElement = document.createElement('div');\n    Common.extend(this.domElement.style, {\n      position: 'fixed',\n      display: 'none',\n      zIndex: '1001',\n      opacity: 0,\n      WebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear',\n      transition: 'transform 0.2s ease-out, opacity 0.2s linear'\n    });\n    document.body.appendChild(this.backgroundElement);\n    document.body.appendChild(this.domElement);\n    var _this = this;\n    dom.bind(this.backgroundElement, 'click', function () {\n      _this.hide();\n    });\n  }\n  createClass(CenteredDiv, [{\n    key: 'show',\n    value: function show() {\n      var _this = this;\n      this.backgroundElement.style.display = 'block';\n      this.domElement.style.display = 'block';\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n      this.layout();\n      Common.defer(function () {\n        _this.backgroundElement.style.opacity = 1;\n        _this.domElement.style.opacity = 1;\n        _this.domElement.style.webkitTransform = 'scale(1)';\n      });\n    }\n  }, {\n    key: 'hide',\n    value: function hide() {\n      var _this = this;\n      var hide = function hide() {\n        _this.domElement.style.display = 'none';\n        _this.backgroundElement.style.display = 'none';\n        dom.unbind(_this.domElement, 'webkitTransitionEnd', hide);\n        dom.unbind(_this.domElement, 'transitionend', hide);\n        dom.unbind(_this.domElement, 'oTransitionEnd', hide);\n      };\n      dom.bind(this.domElement, 'webkitTransitionEnd', hide);\n      dom.bind(this.domElement, 'transitionend', hide);\n      dom.bind(this.domElement, 'oTransitionEnd', hide);\n      this.backgroundElement.style.opacity = 0;\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n    }\n  }, {\n    key: 'layout',\n    value: function layout() {\n      this.domElement.style.left = window.innerWidth / 2 - dom.getWidth(this.domElement) / 2 + 'px';\n      this.domElement.style.top = window.innerHeight / 2 - dom.getHeight(this.domElement) / 2 + 'px';\n    }\n  }]);\n  return CenteredDiv;\n}();\n\nvar styleSheet = ___$insertStyle(\".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\");\n\ncss.inject(styleSheet);\nvar CSS_NAMESPACE = 'dg';\nvar HIDE_KEY_CODE = 72;\nvar CLOSE_BUTTON_HEIGHT = 20;\nvar DEFAULT_DEFAULT_PRESET_NAME = 'Default';\nvar SUPPORTS_LOCAL_STORAGE = function () {\n  try {\n    return 'localStorage' in window && window.localStorage !== null;\n  } catch (e) {\n    return false;\n  }\n}();\nvar SAVE_DIALOGUE = void 0;\nvar autoPlaceVirgin = true;\nvar autoPlaceContainer = void 0;\nvar hide = false;\nvar hideableGuis = [];\nvar GUI = function GUI(pars) {\n  var _this = this;\n  var params = pars || {};\n  this.domElement = document.createElement('div');\n  this.__ul = document.createElement('ul');\n  this.domElement.appendChild(this.__ul);\n  dom.addClass(this.domElement, CSS_NAMESPACE);\n  this.__folders = {};\n  this.__controllers = [];\n  this.__rememberedObjects = [];\n  this.__rememberedObjectIndecesToControllers = [];\n  this.__listening = [];\n  params = Common.defaults(params, {\n    closeOnTop: false,\n    autoPlace: true,\n    width: GUI.DEFAULT_WIDTH\n  });\n  params = Common.defaults(params, {\n    resizable: params.autoPlace,\n    hideable: params.autoPlace\n  });\n  if (!Common.isUndefined(params.load)) {\n    if (params.preset) {\n      params.load.preset = params.preset;\n    }\n  } else {\n    params.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };\n  }\n  if (Common.isUndefined(params.parent) && params.hideable) {\n    hideableGuis.push(this);\n  }\n  params.resizable = Common.isUndefined(params.parent) && params.resizable;\n  if (params.autoPlace && Common.isUndefined(params.scrollable)) {\n    params.scrollable = true;\n  }\n  var useLocalStorage = SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(this, 'isLocal')) === 'true';\n  var saveToLocalStorage = void 0;\n  Object.defineProperties(this,\n  {\n    parent: {\n      get: function get$$1() {\n        return params.parent;\n      }\n    },\n    scrollable: {\n      get: function get$$1() {\n        return params.scrollable;\n      }\n    },\n    autoPlace: {\n      get: function get$$1() {\n        return params.autoPlace;\n      }\n    },\n    closeOnTop: {\n      get: function get$$1() {\n        return params.closeOnTop;\n      }\n    },\n    preset: {\n      get: function get$$1() {\n        if (_this.parent) {\n          return _this.getRoot().preset;\n        }\n        return params.load.preset;\n      },\n      set: function set$$1(v) {\n        if (_this.parent) {\n          _this.getRoot().preset = v;\n        } else {\n          params.load.preset = v;\n        }\n        setPresetSelectIndex(this);\n        _this.revert();\n      }\n    },\n    width: {\n      get: function get$$1() {\n        return params.width;\n      },\n      set: function set$$1(v) {\n        params.width = v;\n        setWidth(_this, v);\n      }\n    },\n    name: {\n      get: function get$$1() {\n        return params.name;\n      },\n      set: function set$$1(v) {\n        params.name = v;\n        if (titleRowName) {\n          titleRowName.innerHTML = params.name;\n        }\n      }\n    },\n    closed: {\n      get: function get$$1() {\n        return params.closed;\n      },\n      set: function set$$1(v) {\n        params.closed = v;\n        if (params.closed) {\n          dom.addClass(_this.__ul, GUI.CLASS_CLOSED);\n        } else {\n          dom.removeClass(_this.__ul, GUI.CLASS_CLOSED);\n        }\n        this.onResize();\n        if (_this.__closeButton) {\n          _this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\n        }\n      }\n    },\n    load: {\n      get: function get$$1() {\n        return params.load;\n      }\n    },\n    useLocalStorage: {\n      get: function get$$1() {\n        return useLocalStorage;\n      },\n      set: function set$$1(bool) {\n        if (SUPPORTS_LOCAL_STORAGE) {\n          useLocalStorage = bool;\n          if (bool) {\n            dom.bind(window, 'unload', saveToLocalStorage);\n          } else {\n            dom.unbind(window, 'unload', saveToLocalStorage);\n          }\n          localStorage.setItem(getLocalStorageHash(_this, 'isLocal'), bool);\n        }\n      }\n    }\n  });\n  if (Common.isUndefined(params.parent)) {\n    params.closed = false;\n    dom.addClass(this.domElement, GUI.CLASS_MAIN);\n    dom.makeSelectable(this.domElement, false);\n    if (SUPPORTS_LOCAL_STORAGE) {\n      if (useLocalStorage) {\n        _this.useLocalStorage = true;\n        var savedGui = localStorage.getItem(getLocalStorageHash(this, 'gui'));\n        if (savedGui) {\n          params.load = JSON.parse(savedGui);\n        }\n      }\n    }\n    this.__closeButton = document.createElement('div');\n    this.__closeButton.innerHTML = GUI.TEXT_CLOSED;\n    dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BUTTON);\n    if (params.closeOnTop) {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_TOP);\n      this.domElement.insertBefore(this.__closeButton, this.domElement.childNodes[0]);\n    } else {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BOTTOM);\n      this.domElement.appendChild(this.__closeButton);\n    }\n    dom.bind(this.__closeButton, 'click', function () {\n      _this.closed = !_this.closed;\n    });\n  } else {\n    if (params.closed === undefined) {\n      params.closed = true;\n    }\n    var _titleRowName = document.createTextNode(params.name);\n    dom.addClass(_titleRowName, 'controller-name');\n    var titleRow = addRow(_this, _titleRowName);\n    var onClickTitle = function onClickTitle(e) {\n      e.preventDefault();\n      _this.closed = !_this.closed;\n      return false;\n    };\n    dom.addClass(this.__ul, GUI.CLASS_CLOSED);\n    dom.addClass(titleRow, 'title');\n    dom.bind(titleRow, 'click', onClickTitle);\n    if (!params.closed) {\n      this.closed = false;\n    }\n  }\n  if (params.autoPlace) {\n    if (Common.isUndefined(params.parent)) {\n      if (autoPlaceVirgin) {\n        autoPlaceContainer = document.createElement('div');\n        dom.addClass(autoPlaceContainer, CSS_NAMESPACE);\n        dom.addClass(autoPlaceContainer, GUI.CLASS_AUTO_PLACE_CONTAINER);\n        document.body.appendChild(autoPlaceContainer);\n        autoPlaceVirgin = false;\n      }\n      autoPlaceContainer.appendChild(this.domElement);\n      dom.addClass(this.domElement, GUI.CLASS_AUTO_PLACE);\n    }\n    if (!this.parent) {\n      setWidth(_this, params.width);\n    }\n  }\n  this.__resizeHandler = function () {\n    _this.onResizeDebounced();\n  };\n  dom.bind(window, 'resize', this.__resizeHandler);\n  dom.bind(this.__ul, 'webkitTransitionEnd', this.__resizeHandler);\n  dom.bind(this.__ul, 'transitionend', this.__resizeHandler);\n  dom.bind(this.__ul, 'oTransitionEnd', this.__resizeHandler);\n  this.onResize();\n  if (params.resizable) {\n    addResizeHandle(this);\n  }\n  saveToLocalStorage = function saveToLocalStorage() {\n    if (SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(_this, 'isLocal')) === 'true') {\n      localStorage.setItem(getLocalStorageHash(_this, 'gui'), JSON.stringify(_this.getSaveObject()));\n    }\n  };\n  this.saveToLocalStorageIfPossible = saveToLocalStorage;\n  function resetWidth() {\n    var root = _this.getRoot();\n    root.width += 1;\n    Common.defer(function () {\n      root.width -= 1;\n    });\n  }\n  if (!params.parent) {\n    resetWidth();\n  }\n};\nGUI.toggleHide = function () {\n  hide = !hide;\n  Common.each(hideableGuis, function (gui) {\n    gui.domElement.style.display = hide ? 'none' : '';\n  });\n};\nGUI.CLASS_AUTO_PLACE = 'a';\nGUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\nGUI.CLASS_MAIN = 'main';\nGUI.CLASS_CONTROLLER_ROW = 'cr';\nGUI.CLASS_TOO_TALL = 'taller-than-window';\nGUI.CLASS_CLOSED = 'closed';\nGUI.CLASS_CLOSE_BUTTON = 'close-button';\nGUI.CLASS_CLOSE_TOP = 'close-top';\nGUI.CLASS_CLOSE_BOTTOM = 'close-bottom';\nGUI.CLASS_DRAG = 'drag';\nGUI.DEFAULT_WIDTH = 245;\nGUI.TEXT_CLOSED = 'Close Controls';\nGUI.TEXT_OPEN = 'Open Controls';\nGUI._keydownHandler = function (e) {\n  if (document.activeElement.type !== 'text' && (e.which === HIDE_KEY_CODE || e.keyCode === HIDE_KEY_CODE)) {\n    GUI.toggleHide();\n  }\n};\ndom.bind(window, 'keydown', GUI._keydownHandler, false);\nCommon.extend(GUI.prototype,\n{\n  add: function add(object, property) {\n    return _add(this, object, property, {\n      factoryArgs: Array.prototype.slice.call(arguments, 2)\n    });\n  },\n  addColor: function addColor(object, property) {\n    return _add(this, object, property, {\n      color: true\n    });\n  },\n  remove: function remove(controller) {\n    this.__ul.removeChild(controller.__li);\n    this.__controllers.splice(this.__controllers.indexOf(controller), 1);\n    var _this = this;\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  destroy: function destroy() {\n    if (this.parent) {\n      throw new Error('Only the root GUI should be removed with .destroy(). ' + 'For subfolders, use gui.removeFolder(folder) instead.');\n    }\n    if (this.autoPlace) {\n      autoPlaceContainer.removeChild(this.domElement);\n    }\n    var _this = this;\n    Common.each(this.__folders, function (subfolder) {\n      _this.removeFolder(subfolder);\n    });\n    dom.unbind(window, 'keydown', GUI._keydownHandler, false);\n    removeListeners(this);\n  },\n  addFolder: function addFolder(name) {\n    if (this.__folders[name] !== undefined) {\n      throw new Error('You already have a folder in this GUI by the' + ' name \"' + name + '\"');\n    }\n    var newGuiParams = { name: name, parent: this };\n    newGuiParams.autoPlace = this.autoPlace;\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[name]) {\n      newGuiParams.closed = this.load.folders[name].closed;\n      newGuiParams.load = this.load.folders[name];\n    }\n    var gui = new GUI(newGuiParams);\n    this.__folders[name] = gui;\n    var li = addRow(this, gui.domElement);\n    dom.addClass(li, 'folder');\n    return gui;\n  },\n  removeFolder: function removeFolder(folder) {\n    this.__ul.removeChild(folder.domElement.parentElement);\n    delete this.__folders[folder.name];\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[folder.name]) {\n      delete this.load.folders[folder.name];\n    }\n    removeListeners(folder);\n    var _this = this;\n    Common.each(folder.__folders, function (subfolder) {\n      folder.removeFolder(subfolder);\n    });\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  open: function open() {\n    this.closed = false;\n  },\n  close: function close() {\n    this.closed = true;\n  },\n  onResize: function onResize() {\n    var root = this.getRoot();\n    if (root.scrollable) {\n      var top = dom.getOffset(root.__ul).top;\n      var h = 0;\n      Common.each(root.__ul.childNodes, function (node) {\n        if (!(root.autoPlace && node === root.__save_row)) {\n          h += dom.getHeight(node);\n        }\n      });\n      if (window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h) {\n        dom.addClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\n      } else {\n        dom.removeClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = 'auto';\n      }\n    }\n    if (root.__resize_handle) {\n      Common.defer(function () {\n        root.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\n      });\n    }\n    if (root.__closeButton) {\n      root.__closeButton.style.width = root.width + 'px';\n    }\n  },\n  onResizeDebounced: Common.debounce(function () {\n    this.onResize();\n  }, 50),\n  remember: function remember() {\n    if (Common.isUndefined(SAVE_DIALOGUE)) {\n      SAVE_DIALOGUE = new CenteredDiv();\n      SAVE_DIALOGUE.domElement.innerHTML = saveDialogContents;\n    }\n    if (this.parent) {\n      throw new Error('You can only call remember on a top level GUI.');\n    }\n    var _this = this;\n    Common.each(Array.prototype.slice.call(arguments), function (object) {\n      if (_this.__rememberedObjects.length === 0) {\n        addSaveMenu(_this);\n      }\n      if (_this.__rememberedObjects.indexOf(object) === -1) {\n        _this.__rememberedObjects.push(object);\n      }\n    });\n    if (this.autoPlace) {\n      setWidth(this, this.width);\n    }\n  },\n  getRoot: function getRoot() {\n    var gui = this;\n    while (gui.parent) {\n      gui = gui.parent;\n    }\n    return gui;\n  },\n  getSaveObject: function getSaveObject() {\n    var toReturn = this.load;\n    toReturn.closed = this.closed;\n    if (this.__rememberedObjects.length > 0) {\n      toReturn.preset = this.preset;\n      if (!toReturn.remembered) {\n        toReturn.remembered = {};\n      }\n      toReturn.remembered[this.preset] = getCurrentPreset(this);\n    }\n    toReturn.folders = {};\n    Common.each(this.__folders, function (element, key) {\n      toReturn.folders[key] = element.getSaveObject();\n    });\n    return toReturn;\n  },\n  save: function save() {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n    }\n    this.load.remembered[this.preset] = getCurrentPreset(this);\n    markPresetModified(this, false);\n    this.saveToLocalStorageIfPossible();\n  },\n  saveAs: function saveAs(presetName) {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n      this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME] = getCurrentPreset(this, true);\n    }\n    this.load.remembered[presetName] = getCurrentPreset(this);\n    this.preset = presetName;\n    addPresetOption(this, presetName, true);\n    this.saveToLocalStorageIfPossible();\n  },\n  revert: function revert(gui) {\n    Common.each(this.__controllers, function (controller) {\n      if (!this.getRoot().load.remembered) {\n        controller.setValue(controller.initialValue);\n      } else {\n        recallSavedValue(gui || this.getRoot(), controller);\n      }\n      if (controller.__onFinishChange) {\n        controller.__onFinishChange.call(controller, controller.getValue());\n      }\n    }, this);\n    Common.each(this.__folders, function (folder) {\n      folder.revert(folder);\n    });\n    if (!gui) {\n      markPresetModified(this.getRoot(), false);\n    }\n  },\n  listen: function listen(controller) {\n    var init = this.__listening.length === 0;\n    this.__listening.push(controller);\n    if (init) {\n      updateDisplays(this.__listening);\n    }\n  },\n  updateDisplay: function updateDisplay() {\n    Common.each(this.__controllers, function (controller) {\n      controller.updateDisplay();\n    });\n    Common.each(this.__folders, function (folder) {\n      folder.updateDisplay();\n    });\n  }\n});\nfunction addRow(gui, newDom, liBefore) {\n  var li = document.createElement('li');\n  if (newDom) {\n    li.appendChild(newDom);\n  }\n  if (liBefore) {\n    gui.__ul.insertBefore(li, liBefore);\n  } else {\n    gui.__ul.appendChild(li);\n  }\n  gui.onResize();\n  return li;\n}\nfunction removeListeners(gui) {\n  dom.unbind(window, 'resize', gui.__resizeHandler);\n  if (gui.saveToLocalStorageIfPossible) {\n    dom.unbind(window, 'unload', gui.saveToLocalStorageIfPossible);\n  }\n}\nfunction markPresetModified(gui, modified) {\n  var opt = gui.__preset_select[gui.__preset_select.selectedIndex];\n  if (modified) {\n    opt.innerHTML = opt.value + '*';\n  } else {\n    opt.innerHTML = opt.value;\n  }\n}\nfunction augmentController(gui, li, controller) {\n  controller.__li = li;\n  controller.__gui = gui;\n  Common.extend(controller,                                   {\n    options: function options(_options) {\n      if (arguments.length > 1) {\n        var nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: nextSibling,\n          factoryArgs: [Common.toArray(arguments)]\n        });\n      }\n      if (Common.isArray(_options) || Common.isObject(_options)) {\n        var _nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: _nextSibling,\n          factoryArgs: [_options]\n        });\n      }\n    },\n    name: function name(_name) {\n      controller.__li.firstElementChild.firstElementChild.innerHTML = _name;\n      return controller;\n    },\n    listen: function listen() {\n      controller.__gui.listen(controller);\n      return controller;\n    },\n    remove: function remove() {\n      controller.__gui.remove(controller);\n      return controller;\n    }\n  });\n  if (controller instanceof NumberControllerSlider) {\n    var box = new NumberControllerBox(controller.object, controller.property, { min: controller.__min, max: controller.__max, step: controller.__step });\n    Common.each(['updateDisplay', 'onChange', 'onFinishChange', 'step'], function (method) {\n      var pc = controller[method];\n      var pb = box[method];\n      controller[method] = box[method] = function () {\n        var args = Array.prototype.slice.call(arguments);\n        pb.apply(box, args);\n        return pc.apply(controller, args);\n      };\n    });\n    dom.addClass(li, 'has-slider');\n    controller.domElement.insertBefore(box.domElement, controller.domElement.firstElementChild);\n  } else if (controller instanceof NumberControllerBox) {\n    var r = function r(returned) {\n      if (Common.isNumber(controller.__min) && Common.isNumber(controller.__max)) {\n        var oldName = controller.__li.firstElementChild.firstElementChild.innerHTML;\n        var wasListening = controller.__gui.__listening.indexOf(controller) > -1;\n        controller.remove();\n        var newController = _add(gui, controller.object, controller.property, {\n          before: controller.__li.nextElementSibling,\n          factoryArgs: [controller.__min, controller.__max, controller.__step]\n        });\n        newController.name(oldName);\n        if (wasListening) newController.listen();\n        return newController;\n      }\n      return returned;\n    };\n    controller.min = Common.compose(r, controller.min);\n    controller.max = Common.compose(r, controller.max);\n  } else if (controller instanceof BooleanController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__checkbox, 'click');\n    });\n    dom.bind(controller.__checkbox, 'click', function (e) {\n      e.stopPropagation();\n    });\n  } else if (controller instanceof FunctionController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__button, 'click');\n    });\n    dom.bind(li, 'mouseover', function () {\n      dom.addClass(controller.__button, 'hover');\n    });\n    dom.bind(li, 'mouseout', function () {\n      dom.removeClass(controller.__button, 'hover');\n    });\n  } else if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n    controller.updateDisplay = Common.compose(function (val) {\n      li.style.borderLeftColor = controller.__color.toString();\n      return val;\n    }, controller.updateDisplay);\n    controller.updateDisplay();\n  }\n  controller.setValue = Common.compose(function (val) {\n    if (gui.getRoot().__preset_select && controller.isModified()) {\n      markPresetModified(gui.getRoot(), true);\n    }\n    return val;\n  }, controller.setValue);\n}\nfunction recallSavedValue(gui, controller) {\n  var root = gui.getRoot();\n  var matchedIndex = root.__rememberedObjects.indexOf(controller.object);\n  if (matchedIndex !== -1) {\n    var controllerMap = root.__rememberedObjectIndecesToControllers[matchedIndex];\n    if (controllerMap === undefined) {\n      controllerMap = {};\n      root.__rememberedObjectIndecesToControllers[matchedIndex] = controllerMap;\n    }\n    controllerMap[controller.property] = controller;\n    if (root.load && root.load.remembered) {\n      var presetMap = root.load.remembered;\n      var preset = void 0;\n      if (presetMap[gui.preset]) {\n        preset = presetMap[gui.preset];\n      } else if (presetMap[DEFAULT_DEFAULT_PRESET_NAME]) {\n        preset = presetMap[DEFAULT_DEFAULT_PRESET_NAME];\n      } else {\n        return;\n      }\n      if (preset[matchedIndex] && preset[matchedIndex][controller.property] !== undefined) {\n        var value = preset[matchedIndex][controller.property];\n        controller.initialValue = value;\n        controller.setValue(value);\n      }\n    }\n  }\n}\nfunction _add(gui, object, property, params) {\n  if (object[property] === undefined) {\n    throw new Error('Object \"' + object + '\" has no property \"' + property + '\"');\n  }\n  var controller = void 0;\n  if (params.color) {\n    controller = new ColorController(object, property);\n  } else {\n    var factoryArgs = [object, property].concat(params.factoryArgs);\n    controller = ControllerFactory.apply(gui, factoryArgs);\n  }\n  if (params.before instanceof Controller) {\n    params.before = params.before.__li;\n  }\n  recallSavedValue(gui, controller);\n  dom.addClass(controller.domElement, 'c');\n  var name = document.createElement('span');\n  dom.addClass(name, 'property-name');\n  name.innerHTML = controller.property;\n  var container = document.createElement('div');\n  container.appendChild(name);\n  container.appendChild(controller.domElement);\n  var li = addRow(gui, container, params.before);\n  dom.addClass(li, GUI.CLASS_CONTROLLER_ROW);\n  if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n  } else {\n    dom.addClass(li, _typeof(controller.getValue()));\n  }\n  augmentController(gui, li, controller);\n  gui.__controllers.push(controller);\n  return controller;\n}\nfunction getLocalStorageHash(gui, key) {\n  return document.location.href + '.' + key;\n}\nfunction addPresetOption(gui, name, setSelected) {\n  var opt = document.createElement('option');\n  opt.innerHTML = name;\n  opt.value = name;\n  gui.__preset_select.appendChild(opt);\n  if (setSelected) {\n    gui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\n  }\n}\nfunction showHideExplain(gui, explain) {\n  explain.style.display = gui.useLocalStorage ? 'block' : 'none';\n}\nfunction addSaveMenu(gui) {\n  var div = gui.__save_row = document.createElement('li');\n  dom.addClass(gui.domElement, 'has-save');\n  gui.__ul.insertBefore(div, gui.__ul.firstChild);\n  dom.addClass(div, 'save-row');\n  var gears = document.createElement('span');\n  gears.innerHTML = '&nbsp;';\n  dom.addClass(gears, 'button gears');\n  var button = document.createElement('span');\n  button.innerHTML = 'Save';\n  dom.addClass(button, 'button');\n  dom.addClass(button, 'save');\n  var button2 = document.createElement('span');\n  button2.innerHTML = 'New';\n  dom.addClass(button2, 'button');\n  dom.addClass(button2, 'save-as');\n  var button3 = document.createElement('span');\n  button3.innerHTML = 'Revert';\n  dom.addClass(button3, 'button');\n  dom.addClass(button3, 'revert');\n  var select = gui.__preset_select = document.createElement('select');\n  if (gui.load && gui.load.remembered) {\n    Common.each(gui.load.remembered, function (value, key) {\n      addPresetOption(gui, key, key === gui.preset);\n    });\n  } else {\n    addPresetOption(gui, DEFAULT_DEFAULT_PRESET_NAME, false);\n  }\n  dom.bind(select, 'change', function () {\n    for (var index = 0; index < gui.__preset_select.length; index++) {\n      gui.__preset_select[index].innerHTML = gui.__preset_select[index].value;\n    }\n    gui.preset = this.value;\n  });\n  div.appendChild(select);\n  div.appendChild(gears);\n  div.appendChild(button);\n  div.appendChild(button2);\n  div.appendChild(button3);\n  if (SUPPORTS_LOCAL_STORAGE) {\n    var explain = document.getElementById('dg-local-explain');\n    var localStorageCheckBox = document.getElementById('dg-local-storage');\n    var saveLocally = document.getElementById('dg-save-locally');\n    saveLocally.style.display = 'block';\n    if (localStorage.getItem(getLocalStorageHash(gui, 'isLocal')) === 'true') {\n      localStorageCheckBox.setAttribute('checked', 'checked');\n    }\n    showHideExplain(gui, explain);\n    dom.bind(localStorageCheckBox, 'change', function () {\n      gui.useLocalStorage = !gui.useLocalStorage;\n      showHideExplain(gui, explain);\n    });\n  }\n  var newConstructorTextArea = document.getElementById('dg-new-constructor');\n  dom.bind(newConstructorTextArea, 'keydown', function (e) {\n    if (e.metaKey && (e.which === 67 || e.keyCode === 67)) {\n      SAVE_DIALOGUE.hide();\n    }\n  });\n  dom.bind(gears, 'click', function () {\n    newConstructorTextArea.innerHTML = JSON.stringify(gui.getSaveObject(), undefined, 2);\n    SAVE_DIALOGUE.show();\n    newConstructorTextArea.focus();\n    newConstructorTextArea.select();\n  });\n  dom.bind(button, 'click', function () {\n    gui.save();\n  });\n  dom.bind(button2, 'click', function () {\n    var presetName = prompt('Enter a new preset name.');\n    if (presetName) {\n      gui.saveAs(presetName);\n    }\n  });\n  dom.bind(button3, 'click', function () {\n    gui.revert();\n  });\n}\nfunction addResizeHandle(gui) {\n  var pmouseX = void 0;\n  gui.__resize_handle = document.createElement('div');\n  Common.extend(gui.__resize_handle.style, {\n    width: '6px',\n    marginLeft: '-3px',\n    height: '200px',\n    cursor: 'ew-resize',\n    position: 'absolute'\n  });\n  function drag(e) {\n    e.preventDefault();\n    gui.width += pmouseX - e.clientX;\n    gui.onResize();\n    pmouseX = e.clientX;\n    return false;\n  }\n  function dragStop() {\n    dom.removeClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.unbind(window, 'mousemove', drag);\n    dom.unbind(window, 'mouseup', dragStop);\n  }\n  function dragStart(e) {\n    e.preventDefault();\n    pmouseX = e.clientX;\n    dom.addClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.bind(window, 'mousemove', drag);\n    dom.bind(window, 'mouseup', dragStop);\n    return false;\n  }\n  dom.bind(gui.__resize_handle, 'mousedown', dragStart);\n  dom.bind(gui.__closeButton, 'mousedown', dragStart);\n  gui.domElement.insertBefore(gui.__resize_handle, gui.domElement.firstElementChild);\n}\nfunction setWidth(gui, w) {\n  gui.domElement.style.width = w + 'px';\n  if (gui.__save_row && gui.autoPlace) {\n    gui.__save_row.style.width = w + 'px';\n  }\n  if (gui.__closeButton) {\n    gui.__closeButton.style.width = w + 'px';\n  }\n}\nfunction getCurrentPreset(gui, useInitialValues) {\n  var toReturn = {};\n  Common.each(gui.__rememberedObjects, function (val, index) {\n    var savedValues = {};\n    var controllerMap = gui.__rememberedObjectIndecesToControllers[index];\n    Common.each(controllerMap, function (controller, property) {\n      savedValues[property] = useInitialValues ? controller.initialValue : controller.getValue();\n    });\n    toReturn[index] = savedValues;\n  });\n  return toReturn;\n}\nfunction setPresetSelectIndex(gui) {\n  for (var index = 0; index < gui.__preset_select.length; index++) {\n    if (gui.__preset_select[index].value === gui.preset) {\n      gui.__preset_select.selectedIndex = index;\n    }\n  }\n}\nfunction updateDisplays(controllerArray) {\n  if (controllerArray.length !== 0) {\n    requestAnimationFrame$1.call(window, function () {\n      updateDisplays(controllerArray);\n    });\n  }\n  Common.each(controllerArray, function (c) {\n    c.updateDisplay();\n  });\n}\n\nvar index = {\n  color: {\n    Color: Color,\n    math: ColorMath,\n    interpret: interpret\n  },\n  controllers: {\n    Controller: Controller,\n    BooleanController: BooleanController,\n    OptionController: OptionController,\n    StringController: StringController,\n    NumberController: NumberController,\n    NumberControllerBox: NumberControllerBox,\n    NumberControllerSlider: NumberControllerSlider,\n    FunctionController: FunctionController,\n    ColorController: ColorController\n  },\n  dom: {\n    dom: dom\n  },\n  gui: {\n    GUI: GUI\n  },\n  GUI: GUI\n};\n\nreturn index;\n\n})));\n//# sourceMappingURL=dat.gui.js.map\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/dat.gui/build/dat.gui.js\n// module id = 8\n// module chunks = 0","module.exports = \"precision highp float;\\r\\nprecision highp int;\\r\\nprecision highp sampler2D;\\r\\nuniform mat4 uShortBoxInvMatrix;\\r\\nuniform mat3 uShortBoxNormalMatrix;\\r\\nuniform mat4 uTallBoxInvMatrix;\\r\\nuniform mat3 uTallBoxNormalMatrix;\\r\\n#include <pathtracing_uniforms_and_defines>\\r\\n#define N_QUADS 6\\r\\n#define N_BOXES 2\\r\\nstruct Ray { vec3 origin; vec3 direction; };\\r\\nstruct Quad { vec3 normal; vec3 v0; vec3 v1; vec3 v2; vec3 v3; vec3 emission; vec3 color; int type; };\\r\\nstruct Box { vec3 minCorner; vec3 maxCorner; vec3 emission; vec3 color; int type; };\\r\\nstruct Intersection { vec3 normal; vec3 emission; vec3 color; int type; };\\r\\nQuad quads[N_QUADS];\\r\\nBox boxes[N_BOXES];\\r\\n#include <pathtracing_random_functions>\\r\\n#include <pathtracing_quad_intersect>\\r\\n#include <pathtracing_box_intersect>\\r\\n\\r\\n//-----------------------------------------------------------------------\\r\\nfloat SceneIntersect(Ray r, inout Intersection intersec)\\r\\n\\r\\n//-----------------------------------------------------------------------\\r\\n{\\r\\n\\tvec3 normal;\\r\\n\\tfloat d;\\r\\n\\tfloat t = INFINITY;\\r\\n\\r\\n\\t// clear fields out\\r\\n\\tintersec.normal = vec3(0);\\r\\n\\tintersec.emission = vec3(0);\\r\\n\\tintersec.color = vec3(0);\\r\\n\\tintersec.type = -1;\\r\\n\\r\\n\\tfor (int i = 0; i < N_QUADS; i++)\\r\\n\\t{\\r\\n\\t\\td = QuadIntersect(quads[i].v0, quads[i].v1, quads[i].v2, quads[i].v3, quads[i].normal, r);\\r\\n\\t\\tif (d < t) {\\r\\n\\t\\t\\tt = d;\\r\\n\\t\\t\\tintersec.normal = quads[i].normal;\\r\\n\\t\\t\\tintersec.emission = quads[i].emission;\\r\\n\\t\\t\\tintersec.color = quads[i].color;\\r\\n\\t\\t\\tintersec.type = quads[i].type;\\r\\n\\t\\t}\\r\\n\\t}\\r\\n\\r\\n\\r\\n\\t// TALL MIRROR BOX\\r\\n\\tRay rObj;\\r\\n\\t// transform ray into Tall Box's object space\\r\\n\\trObj.origin = vec3(uTallBoxInvMatrix * vec4(r.origin, 1.0));\\r\\n\\trObj.direction = vec3(uTallBoxInvMatrix * vec4(r.direction, 0.0));\\r\\n\\td = BoxIntersect(boxes[0].minCorner, boxes[0].maxCorner, rObj, normal);\\r\\n\\r\\n\\tif (d < t) {\\r\\n\\t\\tt = d;\\r\\n\\r\\n\\t\\t// transfom normal back into world space\\r\\n\\t\\tnormal = vec3(uTallBoxNormalMatrix * normal);\\r\\n\\r\\n\\t\\tintersec.normal = normalize(normal);\\r\\n\\t\\tintersec.emission = boxes[0].emission;\\r\\n\\t\\tintersec.color = boxes[0].color;\\r\\n\\t\\tintersec.type = boxes[0].type;\\r\\n\\t}\\r\\n\\r\\n\\r\\n\\t// SHORT DIFFUSE WHITE BOX\\r\\n\\t// transform ray into Short Box's object space\\r\\n\\trObj.origin = vec3(uShortBoxInvMatrix * vec4(r.origin, 1.0));\\r\\n\\trObj.direction = vec3(uShortBoxInvMatrix * vec4(r.direction, 0.0));\\r\\n\\td = BoxIntersect(boxes[1].minCorner, boxes[1].maxCorner, rObj, normal);\\r\\n\\r\\n\\tif (d < t) {\\r\\n\\t\\tt = d;\\r\\n\\r\\n\\t\\t// transfom normal back into world space\\r\\n\\t\\tnormal = vec3(uShortBoxNormalMatrix * normal);\\r\\n\\r\\n\\t\\tintersec.normal = normalize(normal);\\r\\n\\t\\tintersec.emission = boxes[1].emission;\\r\\n\\t\\tintersec.color = boxes[1].color;\\r\\n\\t\\tintersec.type = boxes[1].type;\\r\\n\\t}\\r\\n\\r\\n\\r\\n\\treturn t;\\r\\n}\\r\\n\\r\\nvec3 calcDirectLightingQuad_MultiMethod(vec3 mask, vec3 x, vec3 nl, Quad light, inout float seed, inout bool lightFound)\\r\\n{\\r\\n\\tvec3 dirLight = vec3(0.0);\\r\\n\\tIntersection shadowIntersec;\\r\\n\\tvec3 randPointOnLight;\\r\\n\\trandPointOnLight.x = mix(light.v0.x, light.v1.x, rand(seed));\\r\\n\\trandPointOnLight.y = light.v0.y;\\r\\n\\trandPointOnLight.z = mix(light.v0.z, light.v3.z, rand(seed));\\r\\n\\tvec3 srDir = normalize(randPointOnLight - x);\\r\\n\\tfloat nlDotSrDir = max(dot(nl, srDir), 0.01);\\r\\n\\r\\n\\t// cast shadow ray from intersection point\\t\\r\\n\\tRay shadowRay = Ray(x, srDir);\\r\\n\\tshadowRay.origin += nl * 2.0; // larger dimensions of this scene require greater offsets\\r\\n\\tfloat st = SceneIntersect(shadowRay, shadowIntersec);\\r\\n\\tif (shadowIntersec.type == LIGHT) {\\r\\n\\t\\tlightFound = true;\\r\\n\\t\\tfloat r2 = distance(light.v0, light.v1) * distance(light.v0, light.v3);\\r\\n\\t\\tvec3 d = randPointOnLight - shadowRay.origin;\\r\\n\\t\\tfloat d2 = dot(d, d);\\r\\n\\t\\tfloat weight = dot(-srDir, normalize(shadowIntersec.normal)) * r2 / d2;\\r\\n\\t\\tdirLight = mask * light.emission * nlDotSrDir * clamp(weight, 0.0, 1.0);\\r\\n\\t}\\r\\n\\treturn dirLight;\\r\\n}\\r\\n#define EYEPATH_LENGTH      4\\r\\n#define CAUSTICPATH_LENGTH  2\\r\\n#define LIGHTPATH_LENGTH    1\\r\\n//-----------------------------------------------------------------------\\r\\nvec3 CalculateRadiance(Ray r, inout float seed)\\r\\n//-----------------------------------------------------------------------\\r\\n{\\r\\n\\tIntersection intersec;\\r\\n\\tvec3 accumCol = vec3(0);\\r\\n\\tvec3 maskEyePath = vec3(1);\\r\\n\\tvec3 maskLightPath = vec3(1);\\r\\n\\tvec3 eyeX = vec3(0);\\r\\n\\tvec3 lightX = vec3(0);\\r\\n\\tvec3 firstX = vec3(0);\\r\\n\\tvec3 nlFirst = vec3(0);\\r\\n\\tvec3 nl, n, x;\\r\\n\\tvec3 nlEyePath = vec3(0);\\r\\n\\tvec3 nlLightPath = vec3(0);\\r\\n\\tfloat t = INFINITY;\\r\\n\\tbool bounceIsSpecular = true;\\r\\n\\tbool diffuseReached = false;\\r\\n\\tbool lightFound = false;\\r\\n\\tbool exitEarly = false;\\r\\n\\r\\n\\t// Eye path tracing (from Camera) ///////////////////////////////////////////////////////////////////////////\\r\\n\\r\\n\\tfor (int depth = 0; depth < EYEPATH_LENGTH; depth++)\\r\\n\\t{\\r\\n\\r\\n\\t\\tt = SceneIntersect(r, intersec);\\r\\n\\r\\n\\t\\tif (t == INFINITY) {\\r\\n\\t\\t\\texitEarly = true;\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif (intersec.type == LIGHT) {\\r\\n\\t\\t\\tif (bounceIsSpecular) {\\r\\n\\t\\t\\t\\taccumCol += maskEyePath * intersec.emission;\\r\\n\\t\\t\\t\\texitEarly = true;\\r\\n\\t\\t\\t}\\r\\n\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\t// useful data \\r\\n\\t\\tn = normalize(intersec.normal);\\r\\n\\t\\tnl = dot(n, r.direction) < 0.0 ? normalize(n) : normalize(n * -1.0);\\r\\n\\t\\tx = r.origin + r.direction * t;\\r\\n\\r\\n\\r\\n\\t\\tif (intersec.type == DIFF) // Ideal DIFFUSE reflection\\r\\n\\t\\t{\\r\\n\\t\\t\\tdiffuseReached = true;\\r\\n\\t\\t\\tbounceIsSpecular = false;\\r\\n\\t\\t\\tmaskEyePath *= intersec.color;\\r\\n\\t\\t\\teyeX = x + nl * 2.0;\\r\\n\\t\\t\\tnlEyePath = nl;\\r\\n\\t\\t\\tif (depth == 0) {\\r\\n\\t\\t\\t\\tfirstX = eyeX;\\r\\n\\t\\t\\t\\tnlFirst = nlEyePath;\\r\\n\\t\\t\\t}\\r\\n\\t\\t\\taccumCol += 1.0 * calcDirectLightingQuad_MultiMethod(maskEyePath, x, nl, quads[5], seed, lightFound);\\r\\n\\r\\n\\t\\t\\t// Russian roulette\\r\\n\\t\\t\\tif (rand(seed) < 0.3 || depth > 2)\\r\\n\\t\\t\\t\\tbreak;\\r\\n\\r\\n\\t\\t\\t// choose random Diffuse sample vector\\r\\n\\t\\t\\tr = Ray(x, randomCosWeightedDirectionInHemisphere(nl, seed));\\r\\n\\t\\t\\tr.origin += r.direction * 2.0;\\r\\n\\t\\t\\teyeX = r.origin;\\r\\n\\r\\n\\t\\t\\tcontinue;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif (intersec.type == SPEC)  // Ideal SPECULAR reflection\\r\\n\\t\\t{\\r\\n\\t\\t\\tmaskEyePath *= intersec.color;\\r\\n\\t\\t\\tr = Ray(x, reflect(r.direction, nl));\\r\\n\\t\\t\\tr.origin += r.direction * 2.0;\\r\\n\\r\\n\\t\\t\\tcontinue;\\r\\n\\t\\t}\\r\\n\\r\\n\\t} // end for (int depth = 0; depth < EYEPATH_LENGTH; depth++)\\r\\n\\r\\n\\tif (exitEarly || !diffuseReached)\\r\\n\\t\\treturn accumCol;\\r\\n\\tr.origin = firstX;\\r\\n\\tvec3 randVec = vec3(rand(seed) * 2.0 - 1.0, rand(seed) * 2.0 - 1.0, rand(seed) * 2.0 - 1.0);\\r\\n\\tvec3 offset = vec3(randVec.x * 82.0, randVec.y * 170.0, randVec.z * 80.0);\\r\\n\\tvec3 target = vec3(180.0 + offset.x, 170.0 + offset.y, -350.0 + offset.z);\\r\\n\\tvec3 causticDirection = normalize(target - r.origin);\\r\\n\\tr.direction = causticDirection;\\r\\n\\texitEarly = false;\\r\\n\\tfor (int depth = 0; depth < CAUSTICPATH_LENGTH; depth++)\\r\\n\\t{\\r\\n\\r\\n\\t\\tt = SceneIntersect(r, intersec);\\r\\n\\r\\n\\t\\tif (t == INFINITY) {\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif (intersec.type == LIGHT) {\\r\\n\\t\\t\\tif (depth == 1) {\\r\\n\\t\\t\\t\\taccumCol += 0.7 * maskEyePath * intersec.emission * max(0.0, dot(nlFirst, causticDirection));\\r\\n\\t\\t\\t\\texitEarly = true;\\r\\n\\t\\t\\t}\\r\\n\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\t// useful data \\r\\n\\t\\tn = normalize(intersec.normal);\\r\\n\\t\\tnl = dot(n, r.direction) < 0.0 ? normalize(n) : normalize(n * -1.0);\\r\\n\\t\\tx = r.origin + r.direction * t;\\r\\n\\r\\n\\t\\tif (intersec.type == DIFF) // Ideal DIFFUSE reflection\\r\\n\\t\\t{\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif (intersec.type == SPEC)  // Ideal SPECULAR reflection\\r\\n\\t\\t{\\r\\n\\t\\t\\tmaskEyePath *= intersec.color;\\r\\n\\t\\t\\tr = Ray(x, reflect(r.direction, nl));\\r\\n\\t\\t\\tr.origin += r.direction * 2.0;\\r\\n\\r\\n\\t\\t\\tcontinue;\\r\\n\\t\\t}\\r\\n\\r\\n\\t} // end for (int depth = 0; depth < CAUSTICPATH_LENGTH; depth++)\\r\\n\\r\\n\\tif (exitEarly || lightFound)\\r\\n\\t\\treturn accumCol;\\r\\n\\t// Light path tracing (from Light sources) ////////////////////////////////////////////////////////////////////\\r\\n\\tvec3 randPointOnLight;\\r\\n\\trandPointOnLight.x = mix(quads[5].v0.x, quads[5].v1.x, rand(seed));\\r\\n\\trandPointOnLight.y = quads[5].v0.y;\\r\\n\\trandPointOnLight.z = mix(quads[5].v0.z, quads[5].v3.z, rand(seed));\\r\\n\\tvec3 randLightDir = randomCosWeightedDirectionInHemisphere(quads[5].normal, seed);\\r\\n\\trandLightDir = normalize(randLightDir);\\r\\n\\tr = Ray(randPointOnLight, randLightDir);\\r\\n\\tr.origin += r.direction * 2.0;\\r\\n\\tlightX = r.origin;\\r\\n\\tmaskLightPath = quads[5].emission;\\r\\n\\tnlLightPath = quads[5].normal;\\r\\n\\r\\n\\r\\n\\tfor (int depth = 0; depth < LIGHTPATH_LENGTH; depth++)\\r\\n\\t{\\r\\n\\r\\n\\t\\tt = SceneIntersect(r, intersec);\\r\\n\\r\\n\\t\\tif (t == INFINITY) {\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\t// useful data \\r\\n\\t\\tn = normalize(intersec.normal);\\r\\n\\t\\tnl = dot(n, r.direction) < 0.0 ? normalize(n) : normalize(n * -1.0);\\r\\n\\t\\tx = r.origin + r.direction * t;\\r\\n\\r\\n\\r\\n\\t\\tif (intersec.type == DIFF) // Ideal DIFFUSE reflection\\r\\n\\t\\t{\\r\\n\\t\\t\\tmaskLightPath *= max(0.0, dot(-r.direction, nl));\\r\\n\\t\\t\\tmaskLightPath *= intersec.color;\\r\\n\\t\\t\\tlightX = x + nl * 2.0;\\r\\n\\t\\t\\tnlLightPath = nl;\\r\\n\\t\\t\\tdiffuseReached = true;\\r\\n\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif (intersec.type == SPEC)  // Ideal SPECULAR reflection\\r\\n\\t\\t{\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t} // end for (int depth = 0; depth < LIGHTPATH_LENGTH; depth++)\\r\\n\\r\\n\\tif (!diffuseReached)\\r\\n\\t\\treturn accumCol;\\r\\n\\t// if we made it this far, the light ray has reached a diffuse surface that we can \\r\\n\\t// sample from, and light source has not yet been found by directLighting (we are in shadow)\\r\\n\\t// Connect Camera path and Light path ////////////////////////////////////////////////////////////\\r\\n\\r\\n\\tRay connectRay = Ray(eyeX, normalize(lightX - eyeX));\\r\\n\\tfloat connectDist = distance(eyeX, lightX);\\r\\n\\tfloat c = SceneIntersect(connectRay, intersec);\\r\\n\\tif (c > (connectDist - 1.0)) {\\r\\n\\t\\tmaskLightPath *= max(0.0, dot(-connectRay.direction, nlLightPath));\\r\\n\\t\\tmaskEyePath *= max(0.0, dot(connectRay.direction, nlEyePath));\\r\\n\\t\\taccumCol += 0.1 * (maskEyePath * maskLightPath);\\r\\n\\t}\\r\\n\\r\\n\\treturn accumCol;\\r\\n}\\r\\n//-----------------------------------------------------------------------\\r\\nvoid SetupScene(void)\\r\\n//-----------------------------------------------------------------------\\r\\n{\\r\\n\\tvec3 z = vec3(0);// No color value, Black\\r\\n\\tvec3 L1 = vec3(1.0, 0.7, 0.38) * 15.0;// Bright Yellowish light\\r\\n\\r\\n\\tquads[0] = Quad(vec3(0.0, 0.0, 1.0), vec3(0.0, 0.0, -559.2), vec3(549.6, 0.0, -559.2), vec3(549.6, 548.8, -559.2), vec3(0.0, 548.8, -559.2), z, vec3(1), DIFF);// Back Wall\\r\\n\\tquads[1] = Quad(vec3(1.0, 0.0, 0.0), vec3(0.0, 0.0, 0.0), vec3(0.0, 0.0, -559.2), vec3(0.0, 548.8, -559.2), vec3(0.0, 548.8, 0.0), z, vec3(0.7, 0.12, 0.05), DIFF);// Left Wall Red\\r\\n\\tquads[2] = Quad(vec3(-1.0, 0.0, 0.0), vec3(549.6, 0.0, -559.2), vec3(549.6, 0.0, 0.0), vec3(549.6, 548.8, 0.0), vec3(549.6, 548.8, -559.2), z, vec3(0.2, 0.4, 0.36), DIFF);// Right Wall Green\\r\\n\\tquads[3] = Quad(vec3(0.0, -1.0, 0.0), vec3(0.0, 548.8, -559.2), vec3(549.6, 548.8, -559.2), vec3(549.6, 548.8, 0.0), vec3(0.0, 548.8, 0.0), z, vec3(1), DIFF);// Ceiling\\r\\n\\tquads[4] = Quad(vec3(0.0, 1.0, 0.0), vec3(0.0, 0.0, 0.0), vec3(549.6, 0.0, 0.0), vec3(549.6, 0.0, -559.2), vec3(0.0, 0.0, -559.2), z, vec3(1), DIFF);// Floor\\r\\n\\tquads[5] = Quad(vec3(0.0, -1.0, 0.0), vec3(213.0, 548.0, -332.0), vec3(343.0, 548.0, -332.0), vec3(343.0, 548.0, -227.0), vec3(213.0, 548.0, -227.0), L1, z, LIGHT);// Area Light Rectangle in ceiling\\r\\n\\r\\n\\tboxes[0] = Box(vec3(-82.0, -170.0, -80.0), vec3(82.0, 170.0, 80.0), z, vec3(1), SPEC);// Tall Mirror Box Left\\r\\n\\tboxes[1] = Box(vec3(-86.0, -85.0, -80.0), vec3(86.0, 85.0, 80.0), z, vec3(1), DIFF);// Short Diffuse Box Right\\r\\n}\\r\\n#include <pathtracing_main>\\r\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/glsl/pathTracingFragmentShader.glsl\n// module id = 9\n// module chunks = 0","module.exports = \"#include <pathtracing_uniforms_and_defines>\\r\\n\\r\\n#define PIXEL_SAMPLES \\t\\t1\\t\\t//samples per pixel. Increase for better image quality\\r\\n#define MAX_DEPTH\\t\\t\\t5\\t\\t//GI depth\\r\\n#define CLAMP_VALUE\\t\\t\\t4.0\\t\\t//biased rendering\\r\\n\\r\\n#define SPHERE_LIGHT\\r\\n#define BOX\\r\\n\\r\\n//used macros and constants\\r\\n// #define PI \\t\\t\\t\\t3.1415926\\r\\n// #define TWO_PI \\t\\t\\t6.2831852\\r\\n// #define FOUR_PI \\t\\t\\t12.566370\\r\\n#define INV_PI \\t\\t\\t\\t0.3183099\\r\\n#define INV_TWO_PI \\t\\t\\t0.1591549\\r\\n#define INV_FOUR_PI \\t\\t0.0795775\\r\\n#define EPSILON \\t\\t\\t0.0001 \\r\\n#define EQUAL_FLT(a,b,eps)\\t(((a)>((b)-(eps))) && ((a)<((b)+(eps))))\\r\\n#define IS_ZERO(a) \\t\\t\\tEQUAL_FLT(a,0.0,EPSILON)\\r\\n//********************************************\\r\\n\\r\\nvec3 orthogonalize(in vec3 n, in vec3 v) {\\r\\n    return v - n * dot(n, v);\\r\\n}\\r\\n\\r\\n// random number generator **********\\r\\n// taken from iq :)\\r\\nfloat seed;\\t//seed initialized in main\\r\\nfloat rnd() { return fract(sin(seed++)*43758.5453123); }\\r\\n//***********************************\\r\\n\\r\\n//////////////////////////////////////////////////////////////////////////\\r\\n// Converting PDF from Solid angle to Area\\r\\nfloat PdfWtoA( float aPdfW, float aDist2, float aCosThere ){\\r\\n    return aDist2 == 0.0 ? 0.0 : aPdfW * abs(aCosThere) / aDist2;\\r\\n}\\r\\n\\r\\n// Converting PDF between from Area to Solid angle\\r\\nfloat PdfAtoW( float aPdfA, float aDist2, float aCosThere ){\\r\\n    return abs(aCosThere) == 0.0 ? 0.0 : aPdfA * aDist2 / abs(aCosThere);\\r\\n}\\r\\n\\r\\nfloat misWeight( in float a, in float b ) {\\r\\n    float a2 = a*a;\\r\\n    float b2 = b*b;\\r\\n    float a2b2 = a2 + b2;\\r\\n    return a2 / a2b2;\\r\\n}\\r\\n//////////////////////////////////////////////////////////////////////////\\r\\n\\r\\nvec3 toVec3( vec4 v ) {\\r\\n    return v.w == 0.0 ? v.xyz : v.xyz*(1.0/v.w);\\r\\n}\\r\\n\\r\\nmat3 mat3Inverse( in mat3 m ) {\\r\\n#if __VERSION__ >= 300\\r\\n    return inverse(m);\\t//webGL 2.0\\r\\n#else\\r\\n    return mat3(\\tvec3( m[0][0], m[1][0], m[2][0] ),\\r\\n\\t\\t\\t\\t\\tvec3( m[0][1], m[1][1], m[2][1] ),\\r\\n                    vec3( m[0][2], m[1][2], m[2][2] ) );\\r\\n#endif\\r\\n}\\r\\n\\r\\n//fast inverse for orthogonal matrices\\r\\nmat4 mat4Inverse( in mat4 m ) {\\r\\n#if __VERSION__ >= 300\\r\\n    return inverse(m);\\t//webGL 2.0\\r\\n#else\\r\\n    mat3 rotate_inv = mat3(\\tvec3( m[0][0], m[1][0], m[2][0] ),\\r\\n                          \\tvec3( m[0][1], m[1][1], m[2][1] ),\\r\\n                          \\tvec3( m[0][2], m[1][2], m[2][2] ) );\\r\\n    \\r\\n    return mat4(\\tvec4( rotate_inv[0], 0.0 ),\\r\\n                \\tvec4( rotate_inv[1], 0.0 ),\\r\\n                \\tvec4( rotate_inv[2], 0.0 ),\\r\\n              \\t\\tvec4( (-rotate_inv)*m[3].xyz, 1.0 ) );\\r\\n#endif\\r\\n}\\r\\n      \\r\\nstruct SurfaceHitInfo {\\r\\n    vec3 position_;\\r\\n\\tvec3 normal_;\\r\\n    vec3 tangent_;\\r\\n    vec2 uv_;\\r\\n    int mtl_id_;\\r\\n};\\r\\n    \\r\\n#define SURFACE_ID_BASE\\t0\\r\\n#define LIGHT_ID_BASE\\t64\\r\\n\\r\\n#define MTL_LIGHT \\t\\t0\\r\\n#define MTL_DIFFUSE\\t\\t1\\r\\n    \\r\\n\\r\\n#define OBJ_PLANE\\t\\t0\\r\\n#define OBJ_SPHERE\\t\\t1\\r\\n#define OBJ_CYLINDER\\t2\\r\\n#define OBJ_AABB\\t\\t3\\r\\n#define OBJ_DISK\\t\\t4\\r\\n#define OBJ_BUNNY\\t\\t5\\r\\n    \\r\\nstruct Object {\\r\\n    int type_;\\r\\n    int mtl_id_;\\r\\n    mat4 transform_;\\r\\n    mat4 transform_inv_;\\r\\n    \\r\\n    float params_[6];\\r\\n};\\r\\n\\r\\n//Weighted sum of Lambertian and Blinn brdfs\\r\\nstruct Material {\\r\\n    int type_; // 0 - diffuse, 1 - mirror, \\r\\n    vec3 color_;\\r\\n};\\r\\n    \\r\\nstruct Light {\\r\\n    vec3 color_;\\r\\n    float intensity_;\\r\\n};\\r\\n    \\r\\nstruct Ray {\\r\\n    vec3 origin;\\r\\n    vec3 direction;\\r\\n};\\r\\n    \\r\\nstruct Camera {\\r\\n    mat3 rotate;\\r\\n    vec3 pos;\\r\\n    float fovV;\\r\\n    float focusDist;\\r\\n};\\r\\n    \\r\\nstruct LightSamplingRecord {\\r\\n    vec3 w;\\r\\n    float d;\\r\\n    float pdf;\\r\\n};\\r\\n    \\r\\n// ************ SCENE ***************\\r\\n \\r\\n#ifdef BOX\\r\\n#define N_OBJECTS 7\\r\\n#define N_MATERIALS 5\\r\\n#else\\r\\n#define N_OBJECTS 6\\r\\n#define N_MATERIALS 4\\r\\n#endif\\r\\n\\r\\nLight lights[2];\\r\\nMaterial materials[N_MATERIALS];\\r\\nObject objects[N_OBJECTS];\\r\\nCamera camera;\\r\\n//***********************************\\r\\nMaterial getMaterial(int i) {\\r\\n#if __VERSION__ >= 300\\r\\n    return materials[i];\\t//webGL 2.0\\r\\n#else\\r\\n    if(i==0) return materials[0]; \\r\\n    if(i==1) return materials[1];\\r\\n    if(i==2) return materials[2];\\r\\n    if(i==4) return materials[4];\\r\\n    return materials[3];\\r\\n#endif \\r\\n}\\r\\n\\r\\nLight getLight(int i) {\\r\\n    if(i==0) return lights[0]; else\\r\\n        return lights[1];\\r\\n    //return lights[i];\\r\\n}\\r\\n\\r\\nvec3 getColor(vec2 uv, int tex) {\\r\\n    if(tex==0)\\treturn vec3(0.8, 0.5, 0.3);\\r\\n    if(tex==1)\\treturn vec3(0.5, 0.5, 0.6);\\r\\n\\t\\t\\t\\treturn vec3(0.7, 0.7, 0.7);\\r\\n}\\r\\n\\r\\nvec3 getNormal(vec2 uv, int tex ) {\\r\\n    return vec3(0.0, 0.0, 1.0);\\r\\n}\\r\\n\\r\\nvec3 getRadiance(vec2 uv) {\\r\\n    return /*getColor(uv, 2)*lights[0].color_**/vec3(1.0, 1.0, 1.0)*lights[0].intensity_;\\r\\n}\\r\\n\\r\\nvoid createMaterial( int type, vec3 c, out Material mtl) { mtl.type_ = type; mtl.color_ = c;}\\r\\n\\r\\nvoid createLight(vec3 color, float intensity, out Light light) {\\r\\n    light.color_ = color;\\r\\n    light.intensity_ = intensity;\\r\\n}\\r\\n\\r\\nvoid createAABB( mat4 transform, vec3 bound_min, vec3 bound_max, int mtl, out Object obj) {\\r\\n    vec3 xAcis = normalize( vec3( 0.9, 0.0, 0.2 ) );\\r\\n    vec3 yAcis = vec3( 0.0, 1.0, 0.0 );\\r\\n    obj.type_ = OBJ_AABB;\\r\\n    obj.mtl_id_ = mtl;\\r\\n    obj.transform_ = transform;\\r\\n    obj.transform_inv_ = mat4Inverse( obj.transform_ );\\r\\n    obj.params_[0] = bound_min.x;\\r\\n    obj.params_[1] = bound_min.y;\\r\\n    obj.params_[2] = bound_min.z;\\r\\n    obj.params_[3] = bound_max.x;\\r\\n    obj.params_[4] = bound_max.y;\\r\\n    obj.params_[5] = bound_max.z;\\r\\n}\\r\\n\\r\\nvoid createPlane(mat4 transform, float minX, float minY, float maxX, float maxY, int mtl, out Object obj) {\\r\\n    obj.type_ = OBJ_PLANE;\\r\\n    obj.mtl_id_ = mtl;\\r\\n    obj.transform_ = transform;\\r\\n    obj.transform_inv_ = mat4Inverse( obj.transform_ );\\r\\n    obj.params_[0] = minX;\\t\\t\\t//min x\\r\\n    obj.params_[1] = minY;\\t\\t\\t//min y\\r\\n    obj.params_[2] = maxX;\\t\\t\\t//max x\\r\\n    obj.params_[3] = maxY;\\t\\t\\t//max y\\r\\n    obj.params_[4] = 0.0;\\t\\t//not used\\r\\n    obj.params_[5] = 0.0;\\t\\t//not used\\r\\n}\\r\\n\\r\\nvoid createDisk(mat4 transform, float r, float R, int mtl, out Object obj) {\\r\\n    obj.type_ = OBJ_DISK;\\r\\n    obj.mtl_id_ = mtl;\\r\\n    obj.transform_ = transform;\\r\\n    obj.transform_inv_ = mat4Inverse( obj.transform_ );\\r\\n    obj.params_[0] = r*r;\\r\\n    obj.params_[1] = R*R;\\r\\n}\\r\\n\\r\\nvoid createSphere(mat4 transform, float r, int mtl, out Object obj) {\\r\\n    obj.type_ = OBJ_SPHERE;\\r\\n    obj.mtl_id_ = mtl;\\r\\n    obj.transform_ = transform;\\r\\n    obj.transform_inv_ = mat4Inverse( obj.transform_ );\\r\\n    obj.params_[0] = r;\\t\\t\\t//radius\\r\\n    obj.params_[1] = r*r;\\t\\t//radius^2\\r\\n    obj.params_[2] = 0.0;\\t\\t//not used\\r\\n    obj.params_[3] = 0.0;\\t\\t//not used\\r\\n    obj.params_[4] = 0.0;\\t\\t//not used \\r\\n    obj.params_[5] = 0.0;\\t\\t//not used\\r\\n}\\r\\n\\r\\nvoid createCylinder(mat4 transform, float r, float minZ, float maxZ, float maxTheta, int mtl, out Object obj) {\\r\\n    obj.type_ = OBJ_CYLINDER;\\r\\n    obj.mtl_id_ = mtl;\\r\\n    obj.transform_ = transform;\\r\\n    obj.transform_inv_ = mat4Inverse( obj.transform_ );\\r\\n    obj.params_[0] = r;\\t\\t\\t//radius\\r\\n    obj.params_[1] = minZ;\\t\\t//min z\\r\\n    obj.params_[2] = maxZ;\\t\\t//max z\\r\\n    obj.params_[3] = maxTheta;\\t//max phi\\r\\n    obj.params_[4] = 0.0;\\t\\t//not used\\r\\n    obj.params_[5] = 0.0;\\t\\t//not used\\r\\n}\\r\\n\\r\\nvoid createBunny(mat4 transform, int mtl, out Object obj) {\\r\\n    obj.type_ = OBJ_BUNNY;\\r\\n    obj.mtl_id_ = mtl;\\r\\n    obj.transform_ = transform;\\r\\n    obj.transform_inv_ = mat4Inverse( obj.transform_ );\\r\\n    obj.params_[0] = 0.0;\\t\\t//not used\\r\\n    obj.params_[1] = 0.0;\\t\\t//not used\\r\\n    obj.params_[2] = 0.0;\\t\\t//not used\\r\\n    obj.params_[3] = 0.0;\\t    //not used\\r\\n    obj.params_[4] = 0.0;\\t\\t//not used\\r\\n    obj.params_[5] = 0.0;\\t\\t//not used\\r\\n}\\r\\n\\r\\nmat4 createCS(vec3 p, vec3 z, vec3 x) {\\r\\n    z = normalize(z);\\r\\n    vec3 y = normalize(cross(z,x));\\r\\n    x = cross(y,z);\\r\\n    \\r\\n    return mat4(\\tvec4( x, 0.0 ), \\r\\n    \\t\\t\\t \\tvec4( y, 0.0 ),\\r\\n    \\t\\t\\t\\tvec4( z, 0.0 ),\\r\\n    \\t\\t\\t\\tvec4( p, 1.0 ));\\r\\n}\\r\\n\\r\\n// Geometry functions ***********************************************************\\r\\nvec2 uniformPointWithinCircle( in float radius, in float Xi1, in float Xi2 ) {\\r\\n    float r = radius*sqrt(1.0 - Xi1);\\r\\n    float theta = Xi2*TWO_PI;\\r\\n\\treturn vec2( r*cos(theta), r*sin(theta) );\\r\\n}\\r\\n\\r\\nvec3 uniformDirectionWithinCone( in vec3 d, in float phi, in float sina, in float cosa ) {    \\r\\n\\tvec3 w = normalize(d);\\r\\n    vec3 u = normalize(cross(w.yzx, w));\\r\\n    vec3 v = cross(w, u);\\r\\n\\treturn (u*cos(phi) + v*sin(phi)) * sina + w * cosa;\\r\\n}\\r\\n\\r\\n//taken from: https://www.shadertoy.com/view/4sSSW3\\r\\nvoid basis(in vec3 n, out vec3 f, out vec3 r) {\\r\\n    if(n.z < -0.999999) {\\r\\n        f = vec3(0 , -1, 0);\\r\\n        r = vec3(-1, 0, 0);\\r\\n    } else {\\r\\n    \\tfloat a = 1./(1. + n.z);\\r\\n    \\tfloat b = -n.x*n.y*a;\\r\\n    \\tf = vec3(1. - n.x*n.x*a, b, -n.x);\\r\\n    \\tr = vec3(b, 1. - n.y*n.y*a , -n.y);\\r\\n    }\\r\\n}\\r\\n\\r\\nmat3 mat3FromNormal(in vec3 n) {\\r\\n    vec3 x;\\r\\n    vec3 y;\\r\\n    basis(n, x, y);\\r\\n    return mat3(x,y,n);\\r\\n}\\r\\n\\r\\nvoid cartesianToSpherical(in vec3 xyz, out float rho, out float phi, out float theta ) {\\r\\n    rho = sqrt((xyz.x * xyz.x) + (xyz.y * xyz.y) + (xyz.z * xyz.z));\\r\\n    phi = asin(xyz.y / rho);\\r\\n\\ttheta = atan( xyz.z, xyz.x );\\r\\n}\\r\\n\\r\\nvec3 sphericalToCartesian( in float rho, in float phi, in float theta ) {\\r\\n    float sinTheta = sin(theta);\\r\\n    return vec3( sinTheta*cos(phi), sinTheta*sin(phi), cos(theta) )*rho;\\r\\n}\\r\\n\\r\\nvec3 sampleHemisphereCosWeighted( in float Xi1, in float Xi2 ) {\\r\\n    float theta = acos(sqrt(1.0-Xi1));\\r\\n    float phi = TWO_PI * Xi2;\\r\\n\\r\\n    return sphericalToCartesian( 1.0, phi, theta );\\r\\n}\\r\\n\\r\\nvec3 randomDirection( in float Xi1, in float Xi2 ) {\\r\\n    float theta = acos(1.0 - 2.0*Xi1);\\r\\n    float phi = TWO_PI * Xi2;\\r\\n    \\r\\n    return sphericalToCartesian( 1.0, phi, theta );\\r\\n}\\r\\n//*****************************************************************************\\r\\n\\r\\n// ************************   Scattering functions  *************************\\r\\nbool sameHemisphere(in vec3 n, in vec3 a, in vec3 b){\\r\\n\\treturn ((dot(n,a)*dot(n,b))>0.0);\\r\\n}\\r\\n\\r\\nbool sameHemisphere(in vec3 a, in vec3 b){\\r\\n\\treturn (a.z*b.z>0.0);\\r\\n}\\r\\n\\r\\nvec3 mtlEval(Material mtl, in vec3 Ng, in vec3 Ns, in vec3 Ee, in vec3 L) {\\r\\n    if(mtl.type_ == 1) return vec3(0.0);\\r\\n\\r\\n    return \\tvec3(INV_PI) * mtl.color_;\\r\\n}\\r\\n\\r\\n\\r\\n\\r\\nvec3 mtlSample(Material mtl, in vec3 Ng, in vec3 Ns, in vec3 Ee, in float Xi1, in float Xi2, out vec3 L, out float pdf) {\\r\\n    if(mtl.type_ == 0) {\\r\\n        mat3 trans = mat3FromNormal(Ns);\\r\\n        //mat3 inv_trans = mat3Inverse( trans );\\r\\n\\r\\n        //convert directions to local space\\r\\n        //vec3 E_local = inv_trans * Ee;\\r\\n        vec3 L_local;\\r\\n        \\r\\n    \\t//if (E_local.z == 0.0) return vec3(0.);\\r\\n        \\r\\n        L_local = sampleHemisphereCosWeighted( Xi1, Xi2 );\\r\\n        pdf = INV_PI * L_local.z;\\r\\n        \\r\\n        //convert directions to global space\\r\\n    \\tL = trans*L_local;\\r\\n    } else {\\r\\n        L = reflect(-Ee, Ns);\\r\\n        pdf = 1.0;\\r\\n        return vec3(1.0);\\r\\n    }\\r\\n    \\r\\n    if(!sameHemisphere(Ns, Ee, L) || !sameHemisphere(Ng, Ee, L)) {\\r\\n        pdf = 0.0;\\r\\n    }\\r\\n    \\r\\n    return mtlEval(mtl, Ng, Ns, Ee, L);\\r\\n}\\r\\n\\r\\nfloat mtlPdf(Material mtl, in vec3 Ng, in vec3 Ns, in vec3 Ee, in vec3 L) {\\r\\n    \\r\\n    if(mtl.type_ == 0) {\\r\\n        mat3 trans = mat3FromNormal(Ns);\\r\\n        mat3 inv_trans = mat3Inverse( trans );\\r\\n\\r\\n        vec3 E_local = inv_trans * Ee;\\r\\n        vec3 L_local = inv_trans * L;\\r\\n\\r\\n        if(!sameHemisphere(Ng, E_local, L_local)) {\\r\\n            return 0.0;\\r\\n        }\\r\\n        \\r\\n        return abs(L_local.z)*INV_PI;\\r\\n    } else {\\r\\n        return 0.0;\\r\\n    }\\r\\n}\\r\\n\\r\\n\\r\\n\\r\\n// ************************  INTERSECTION FUNCTIONS **************************\\r\\n\\r\\nbool solveQuadratic(float A, float B, float C, out float t0, out float t1) {\\r\\n\\tfloat discrim = B*B-4.0*A*C;\\r\\n    \\r\\n\\tif ( discrim <= 0.0 )\\r\\n        return false;\\r\\n    \\r\\n\\tfloat rootDiscrim = sqrt( discrim );\\r\\n    \\r\\n    float t_0 = (-B-rootDiscrim)/(2.0*A);\\r\\n    float t_1 = (-B+rootDiscrim)/(2.0*A);\\r\\n    \\r\\n    t0 = min( t_0, t_1 );\\r\\n    t1 = max( t_0, t_1 );\\r\\n    \\r\\n\\treturn true;\\r\\n}\\r\\n\\r\\nbool rayAABBIntersection( in Ray ray, float minX, float minY, float minZ, float maxX, float maxY, float maxZ, out float t, out SurfaceHitInfo isect ) {\\r\\n    vec3 boxMin = vec3( minX, minY, minZ );\\r\\n    vec3 boxMax = vec3( maxX, maxY, maxZ );\\r\\n    \\r\\n    vec3 OMIN = ( boxMin - ray.origin ) / ray.direction;\\r\\n    vec3 OMAX = ( boxMax - ray.origin ) / ray.direction;\\r\\n    vec3 MAX = max ( OMAX, OMIN );\\r\\n    vec3 MIN = min ( OMAX, OMIN );\\r\\n    float t1 = min ( MAX.x, min ( MAX.y, MAX.z ) );\\r\\n    t = max ( max ( MIN.x, 0.0 ), max ( MIN.y, MIN.z ) );\\r\\n    \\r\\n    if ( t1 <= t )\\r\\n        return false;\\r\\n    \\r\\n    isect.position_ = ray.origin + ray.direction*t;\\r\\n    if( isect.position_.x < minX - EPSILON ) {\\r\\n        isect.normal_ =  vec3( -1.0, 0.0, 0.0 );\\r\\n    } else if( isect.position_.x > maxX - EPSILON ) {\\r\\n        isect.normal_ =  vec3( 1.0, 0.0, 0.0 );\\r\\n    } else if( isect.position_.y < minY - EPSILON ) {\\r\\n        isect.normal_ =  vec3( 0.0, -1.0, 0.0 );\\r\\n    } else if( isect.position_.y > maxY - EPSILON ) {\\r\\n        isect.normal_ =  vec3( 0.0, 1.0, 0.0 );\\r\\n    } else if( isect.position_.z < minZ - EPSILON ) {\\r\\n        isect.normal_ =  vec3( 0.0, 0.0, -1.0 );\\r\\n    } else /*if( isect.position_.z > maxZ - EPSILON ) )*/ {\\r\\n        isect.normal_ =  vec3( 0.0, 0.0, 1.0 );\\r\\n    }\\r\\n    \\r\\n    return true;\\r\\n}\\r\\n\\r\\nbool iSphere(in Ray ray, in vec3 sph_o, in float sph_r2, out float t0, out float t1) {\\r\\n    vec3 L = ray.origin - sph_o;\\r\\n    float a = dot( ray.direction, ray.direction );\\r\\n    float b = 2.0 * dot( ray.direction, L );\\r\\n    float c = dot( L, L ) - sph_r2;\\r\\n    return solveQuadratic(a, b, c, t0, t1);\\r\\n}\\r\\n\\r\\nbool raySphereIntersection( in Ray ray, in float radiusSquared, out float t, out SurfaceHitInfo isect ) {\\r\\n    float t0, t1;\\r\\n    if (!iSphere(ray, vec3(.0), radiusSquared, t0, t1))\\r\\n\\t\\treturn false;\\r\\n    \\r\\n    t = mix(mix(-1.0, t1, float(t1 > 0.0)), t0, float(t0 > 0.0));\\r\\n    \\r\\n    isect.position_ = ray.origin + ray.direction*t;\\r\\n    isect.normal_ = normalize( isect.position_ );\\r\\n\\t\\r\\n\\treturn (t != -1.0);\\r\\n}\\r\\n\\r\\nbool rayAAPlaneIntersection( in Ray ray, in float min_x, in float min_y, in float max_x, in float max_y, out float t, out SurfaceHitInfo isect ) {\\r\\n    if ( ray.direction.z == 0.0 )\\r\\n    \\treturn false;\\r\\n    \\r\\n    t = ( -ray.origin.z ) / ray.direction.z;\\r\\n    \\r\\n    isect.position_ = ray.origin + ray.direction*t;\\r\\n    isect.normal_ \\t= vec3( 0.0, 0.0, 1.0 );\\r\\n    return\\t(isect.position_.x > min_x) &&\\r\\n       \\t\\t(isect.position_.x < max_x) &&\\r\\n      \\t\\t(isect.position_.y > min_y) &&\\r\\n      \\t\\t(isect.position_.y < max_y);\\r\\n}\\r\\n\\r\\nbool iCylinder(in Ray r, float radius, out float t0, out float t1) {\\r\\n\\tfloat a = r.direction.x*r.direction.x + r.direction.y*r.direction.y;\\r\\n\\tfloat b = 2.0 * (r.direction.x*r.origin.x + r.direction.y*r.origin.y);\\r\\n\\tfloat c = r.origin.x*r.origin.x + r.origin.y*r.origin.y - radius*radius;\\r\\n\\treturn solveQuadratic(a, b, c, t0, t1);\\r\\n}\\r\\n\\r\\nbool rayCylinderIntersection( in Ray r, in float radius, in float minZ, in float maxZ, in float maxPhi, out float t, out SurfaceHitInfo isect ) {\\r\\n\\tfloat phi;\\r\\n\\tvec3 phit;\\r\\n\\tfloat t0, t1;\\r\\n    \\r\\n\\tif (!iCylinder(r, radius, t0, t1))\\r\\n\\t\\treturn false;\\r\\n\\r\\n    if ( t1 < 0.0 )\\r\\n        return false;\\r\\n    \\r\\n\\tt = t0;\\r\\n    \\r\\n\\tif (t0 < 0.0)\\r\\n\\t\\tt = t1;\\r\\n\\r\\n\\t// Compute cylinder hit point and $\\\\phi$\\r\\n\\tphit = r.origin + r.direction*t;\\r\\n\\tphi = atan(phit.y,phit.x);\\r\\n    phi += PI;\\r\\n    \\r\\n\\tif (phi < 0.0)\\r\\n        phi += TWO_PI;\\r\\n \\r\\n\\t// Test cylinder intersection against clipping parameters\\r\\n\\tif ( (phit.z < minZ) || (phit.z > maxZ) || (phi > maxPhi) ) {\\r\\n\\t\\tif (t == t1)\\r\\n            return false;\\r\\n\\t\\tt = t1;\\r\\n\\t\\t// Compute cylinder hit point and $\\\\phi$\\r\\n\\t\\tphit = r.origin + r.direction*t;\\r\\n\\t\\tphi = atan(phit.y,phit.x);\\r\\n        phi += PI;\\r\\n\\r\\n\\t\\tif ( (phit.z < minZ) || (phit.z > maxZ) || (phi > maxPhi) )\\r\\n\\t\\t\\treturn false;\\r\\n\\t}\\r\\n    \\r\\n    isect.position_ = phit;\\r\\n    isect.normal_ = normalize( vec3( phit.xy, 0.0 ) );\\r\\n    \\r\\n\\treturn true;\\r\\n}\\r\\n\\r\\n// Distance from p to sphere of radius s (centered at origin)\\r\\nfloat sdSphere( vec3 p, float s )\\r\\n{\\r\\n    return length(p)-s;\\r\\n}\\r\\n\\r\\nfloat map( in vec3 pos )\\r\\n{\\r\\n    float a = 15.0;\\r\\n    return 0.2 * sdSphere( pos, 1.3 )\\r\\n                           + 0.03*sin(a*pos.x)*sin(a*pos.y)*sin(a*pos.z);\\r\\n}\\r\\n\\r\\nvec3 calcNormal( in vec3 pos )\\r\\n{\\r\\n    // epsilon = a small number\\r\\n    vec2 e = vec2(1.0,-1.0)*0.5773*0.0002;\\r\\n    \\r\\n    return normalize( e.xyy*map( pos + e.xyy ) + \\r\\n\\t\\t\\t\\t\\t  e.yyx*map( pos + e.yyx ) + \\r\\n\\t\\t\\t\\t\\t  e.yxy*map( pos + e.yxy ) + \\r\\n\\t\\t\\t\\t\\t  e.xxx*map( pos + e.xxx ) );\\r\\n}\\r\\n\\r\\n// Cast a ray from origin ro in direction rd until it hits an object.\\r\\n// Return (t,m) where t is distance traveled along the ray, and m\\r\\n// is the material of the object hit.\\r\\nbool castRay( in Ray ray, out float t, out vec3 n ){\\r\\n    float tmin = 0.0;\\r\\n    float tmax = 100.0;\\r\\n    \\r\\n    if(!iSphere(ray, vec3(0.), 2.25, tmin, tmax))return false;\\r\\n    tmin = max(tmin, 0.0);\\r\\n    \\r\\n    t = tmin;\\r\\n    for( int i=0; i<256; i++ )\\r\\n    {\\r\\n\\t    float precis = 0.0002*t;\\r\\n        vec3 p = ray.origin + ray.direction*t;\\r\\n        float d = map( p );\\r\\n\\t    \\r\\n        if( d<precis || t>tmax ) break;\\r\\n        t += d;\\r\\n    }\\r\\n    \\r\\n    n = calcNormal( ray.origin + ray.direction*t );\\r\\n    bool res = t > tmin && t < tmax;\\r\\n    \\r\\n    return res;\\r\\n}\\r\\n\\r\\nbool rayBunnyIntersection( in Ray ray, in bool forShadowTest, out float t, out SurfaceHitInfo isect ) {\\r\\n    bool res = castRay( ray, t, isect.normal_ );\\r\\n    isect.position_ = ray.origin + ray.direction*t;\\r\\n    return res;\\r\\n}\\r\\n\\r\\nbool rayObjectIntersect( in Ray ray, in Object obj, in float distMin, in float distMax, in bool forShadowTest, out SurfaceHitInfo hit, out float dist ) {\\r\\n    bool hitResult = false;\\r\\n    float t;\\r\\n    SurfaceHitInfo currentHit;\\r\\n\\r\\n    //Convert ray to object space\\r\\n    Ray rayLocal;\\r\\n    rayLocal.origin = toVec3( obj.transform_inv_*vec4( ray.origin, 1.0 ) );\\r\\n    rayLocal.direction \\t= toVec3( obj.transform_inv_*vec4( ray.direction   , 0.0 ) );\\r\\n\\r\\n    if( obj.type_ == OBJ_PLANE ) {\\r\\n        hitResult = rayAAPlaneIntersection( rayLocal, obj.params_[0], obj.params_[1], obj.params_[2], obj.params_[3], t, currentHit );\\r\\n    } else if( obj.type_ == OBJ_SPHERE ) {\\r\\n        hitResult = raySphereIntersection( \\trayLocal, obj.params_[1], t, currentHit );\\r\\n    } else if( obj.type_ == OBJ_CYLINDER ) {\\r\\n        hitResult = rayCylinderIntersection(rayLocal, obj.params_[0], obj.params_[1], obj.params_[2], obj.params_[3], t, currentHit );\\r\\n    } else if( obj.type_ == OBJ_AABB ) {\\r\\n        hitResult = rayAABBIntersection( rayLocal, obj.params_[0], obj.params_[1], obj.params_[2], obj.params_[3], obj.params_[4], obj.params_[5], t, currentHit );\\r\\n    } else if( obj.type_ == OBJ_BUNNY ) {\\r\\n        hitResult = rayBunnyIntersection( rayLocal, forShadowTest, t, currentHit );\\r\\n    }\\r\\n\\r\\n    if( hitResult && ( t > distMin ) && ( t < distMax ) ) {\\r\\n        //Convert results to world space\\r\\n        currentHit.position_ = toVec3( obj.transform_*vec4( currentHit.position_, 1.0 ) );\\r\\n        currentHit.normal_   = toVec3( obj.transform_*vec4( currentHit.normal_  , 0.0 ) );\\r\\n        currentHit.tangent_  = toVec3( obj.transform_*vec4( currentHit.tangent_ , 0.0 ) );\\r\\n\\r\\n        dist = t;\\r\\n        hit = currentHit;\\r\\n        hit.mtl_id_ = obj.mtl_id_;\\r\\n        \\r\\n        return true;\\r\\n    } else {\\r\\n    \\treturn false;\\r\\n    }\\r\\n}\\r\\n\\r\\n#define CHECK_OBJ( obj ) { SurfaceHitInfo currentHit; float currDist; if( rayObjectIntersect( ray, obj, distMin, nearestDist, forShadowTest, currentHit, currDist ) && ( currDist < nearestDist ) ) { nearestDist = currDist; hit = currentHit; } }\\r\\nbool raySceneIntersection( in Ray ray, in float distMin, in bool forShadowTest, out SurfaceHitInfo hit, out float nearestDist ) {\\r\\n    nearestDist = 10000.0;\\r\\n    \\r\\n    for(int i=0; i<N_OBJECTS; i++ ) {\\r\\n        CHECK_OBJ( objects[i] );\\r\\n    }\\r\\n    return ( nearestDist < 1000.0 );\\r\\n}\\r\\n// ***************************************************************************\\r\\n\\r\\n\\r\\nvoid initScene() {\\r\\n    \\r\\n    //create lights\\r\\n    createLight(vec3(1.0, 1.0, 0.9), 140.0, lights[0]);\\r\\n    \\r\\n    //Create materials\\r\\n    createMaterial(0, vec3(1.0, 1.0, 1.0), materials[0]);\\r\\n    createMaterial(0, vec3(0.85, 0.85, 0.85), materials[1]);\\r\\n    createMaterial(1, vec3(1.0, 0.5, 1.0), materials[2]);\\r\\n    createMaterial(0, vec3(0.5, 0.5, 1.0), materials[3]);\\r\\n#ifdef BOX\\r\\n    createMaterial(0, vec3(0.96, 0.02, 0.05), materials[4]);\\r\\n#endif\\r\\n    \\r\\n    //init lights\\r\\n    float r = 0.3;\\r\\n    float xFactor = (uMouse.x==0.0)?0.0:2.0*(uMouse.x/uResolution.x) - 1.0;\\r\\n    float yFactor = (uMouse.y==0.0)?0.0:2.0*(uMouse.y/uResolution.y) - 1.0;\\r\\n    float x = xFactor*7.0;\\r\\n    float z = -3.0-yFactor*5.0;\\r\\n    float a = -2.2;\\r\\n    mat4 trans = createCS(\\tvec3(x, 3.0, z),\\r\\n                          \\tvec3(0.0, sin(a), cos(a)),\\r\\n                  \\t\\t\\tvec3(1.0, 0.0, 0.0));\\r\\n#ifdef SPHERE_LIGHT\\r\\n    createSphere(trans, r, LIGHT_ID_BASE+0, objects[0] );\\r\\n#else\\r\\n    float aa = 2.0 * r;\\r\\n    float bb = 3.0 * r;\\r\\n    createPlane(trans, -bb, -aa, bb, aa, LIGHT_ID_BASE+0, objects[0]);\\r\\n#endif\\r\\n    \\r\\n    \\r\\n    //plane 1\\r\\n    trans = mat4(\\tvec4( 1.0, 0.0, 0.0, 0.0 ),\\r\\n                    vec4( 0.0, 1.0, 0.0, 0.0 ),\\r\\n                    vec4( 0.0, 0.0, 1.0, 0.0 ),\\r\\n                    vec4( 0.0, 5.0, -10.0, 1.0 ));\\r\\n    createPlane(trans, -10.0, -2.0, 10.0, 4.0, SURFACE_ID_BASE+1, objects[1]);\\r\\n   \\r\\n    //plane 2\\r\\n    trans = mat4(\\tvec4( 1.0, 0.0, 0.0, 0.0 ),\\r\\n                    vec4( 0.0, 0.0, -1.0, 0.0 ),\\r\\n                    vec4( 0.0, -1.0, 0.0, 0.0 ),\\r\\n                    vec4( 0.0, -1.0, -4.0, 1.0 ));\\r\\n    createPlane(trans, -10.0, -4.0, 10.0, 2.0, SURFACE_ID_BASE+1, objects[2]);\\r\\n \\r\\n    //Cylinder\\r\\n    trans = mat4(\\tvec4( 0.0, 1.0, 0.0, 0.0 ),\\r\\n                    vec4( 0.0, 0.0, 1.0, 0.0 ),\\r\\n                    vec4( 1.0, 0.0, 0.0, 0.0 ),\\r\\n                    vec4( -0.0, 3.0, -6.0, 1.0 ));\\r\\n    createCylinder(trans, 4.0, -10.0, 10.0, PI/2.0, SURFACE_ID_BASE+1, objects[3] );\\r\\n    \\r\\n    trans = mat4( \\tvec4( 1.0, 0.0, 0.0, 0.0 ),\\r\\n                    vec4( 0.0, 1.0, 0.0, 0.0 ),\\r\\n                    vec4( 0.0, 0.0, 1.0, 0.0 ),\\r\\n                    vec4( -2.0, 0.3, -4.5, 1.0 ));\\r\\n    createBunny(trans, SURFACE_ID_BASE+2, objects[4]);\\r\\n    \\r\\n    vec3 xvec = normalize(vec3(0.8, 0.2, -0.1));\\r\\n    trans = createCS(\\tvec3(2.0, 0.3, -4.5),\\r\\n                        xvec,\\r\\n                  \\t\\tvec3(0.0, 1.0, 0.0));\\r\\n    createBunny(trans, SURFACE_ID_BASE+3, objects[5]);\\r\\n    \\r\\n#ifdef BOX\\r\\n    //box\\r\\n    xvec = normalize(vec3(0.8, 0.0, -0.25));\\r\\n    trans = createCS(\\tvec3(0.0, -0.5, -2.5),\\r\\n                        xvec,\\r\\n                  \\t\\tvec3(0.0, 1.0, 0.0));\\r\\n    createAABB( trans, -vec3(0.5), vec3(0.5), SURFACE_ID_BASE+4, objects[6]);\\r\\n#endif\\r\\n}\\r\\n\\r\\n///////////////////////////////////////////////////////////////////////\\r\\nvoid initCamera( \\tin vec3 pos,\\r\\n                \\tin vec3 target,\\r\\n                \\tin vec3 upDir,\\r\\n                \\tin float fovV,\\r\\n                \\tin float focus_dist\\r\\n               ) {\\r\\n    camera.pos = vec3( 0.3, 3.0, 4.8 );\\r\\n    \\r\\n    target = vec3( 0.0, 0.4, -5.0 );\\r\\n    \\r\\n\\tvec3 back = normalize( camera.pos-target );\\r\\n\\tvec3 right = normalize( cross( upDir, back ) );\\r\\n\\tvec3 up = cross( back, right );\\r\\n    camera.rotate[0] = right;\\r\\n    camera.rotate[1] = up;\\r\\n    camera.rotate[2] = back;\\r\\n    camera.fovV = fovV;\\r\\n    camera.focusDist = focus_dist;\\r\\n}\\r\\n\\r\\nRay genRay( in vec2 pixel, in float Xi1, in float Xi2 ) {\\r\\n    Ray ray;\\r\\n\\r\\n    vec2 iPlaneSize=2.*tan(0.5*camera.fovV)*vec2(uResolution.x/uResolution.y,1.);\\r\\n\\tvec2 ixy=(pixel/uResolution.xy - 0.5)*iPlaneSize;\\r\\n    \\r\\n    ray.origin = camera.pos;\\r\\n    ray.direction = camera.rotate*normalize(vec3(ixy.x,ixy.y,-1.0));\\r\\n\\r\\n\\treturn ray;\\r\\n}\\r\\n\\r\\n#ifdef SPHERE_LIGHT\\r\\nvec3 sampleLightSource( \\tin vec3 x,\\r\\n                          \\tfloat Xi1, float Xi2,\\r\\n                          \\tout LightSamplingRecord sampleRec ) {\\r\\n    float sph_r2 = objects[0].params_[1];\\r\\n    vec3 sph_p = toVec3( objects[0].transform_*vec4(vec3(0.0,0.0,0.0), 1.0) );\\r\\n    \\r\\n    vec3 w = sph_p - x;\\t\\t\\t//direction to light center\\r\\n\\tfloat dc_2 = dot(w, w);\\t\\t//squared distance to light center\\r\\n    float dc = sqrt(dc_2);\\t\\t//distance to light center\\r\\n    \\r\\n    \\r\\n    float sin_theta_max_2 = sph_r2 / dc_2;\\r\\n\\tfloat cos_theta_max = sqrt( 1.0 - clamp( sin_theta_max_2, 0.0, 1.0 ) );\\r\\n    float cos_theta = mix( cos_theta_max, 1.0, Xi1 );\\r\\n    float sin_theta_2 = 1.0 - cos_theta*cos_theta;\\r\\n    float sin_theta = sqrt(sin_theta_2);\\r\\n    sampleRec.w = uniformDirectionWithinCone( w, TWO_PI*Xi2, sin_theta, cos_theta );\\r\\n    sampleRec.pdf = 1.0/( TWO_PI * (1.0 - cos_theta_max) );\\r\\n        \\r\\n    //Calculate intersection distance\\r\\n\\t//http://ompf2.com/viewtopic.php?f=3&t=1914\\r\\n    sampleRec.d = dc*cos_theta - sqrt(sph_r2 - dc_2*sin_theta_2);\\r\\n    \\r\\n    return lights[0].color_*lights[0].intensity_;\\r\\n}\\r\\n\\r\\nfloat sampleLightSourcePdf( in vec3 x,\\r\\n                            in vec3 wi,\\r\\n                           \\tin float d,\\r\\n                            in float cosAtLight ) {\\r\\n    float sph_r2 = objects[0].params_[1];\\r\\n    vec3 sph_p = toVec3( objects[0].transform_*vec4(vec3(0.0,0.0,0.0), 1.0) );\\r\\n    float solidangle;\\r\\n    vec3 w = sph_p - x;\\t\\t\\t//direction to light center\\r\\n\\tfloat dc_2 = dot(w, w);\\t\\t//squared distance to light center\\r\\n    float dc = sqrt(dc_2);\\t\\t//distance to light center\\r\\n    \\r\\n    if( dc_2 > sph_r2 ) {\\r\\n    \\tfloat sin_theta_max_2 = clamp( sph_r2 / dc_2, 0.0, 1.0);\\r\\n\\t\\tfloat cos_theta_max = sqrt( 1.0 - sin_theta_max_2 );\\r\\n    \\tsolidangle = TWO_PI * (1.0 - cos_theta_max);\\r\\n    } else { \\r\\n    \\tsolidangle = FOUR_PI;\\r\\n    }\\r\\n    \\r\\n    return 1.0/solidangle;\\r\\n}\\r\\n#else\\r\\nvec3 sampleLightSource(\\t\\tin vec3 x,\\r\\n                          \\tfloat Xi1, float Xi2,\\r\\n                       out LightSamplingRecord sampleRec) {\\r\\n    float min_x = objects[0].params_[0];\\t\\t\\t//min x\\r\\n    float min_y = objects[0].params_[1];\\t\\t\\t//min y\\r\\n    float max_x = objects[0].params_[2];\\t\\t\\t//max x\\r\\n    float max_y = objects[0].params_[3];\\t\\t\\t//max y\\r\\n    float dim_x = max_x - min_x;\\r\\n    float dim_y = max_y - min_y;\\r\\n    vec3 p_local = vec3(min_x + dim_x*Xi1, min_y + dim_y*Xi2, 0.0);\\r\\n    vec3 n_local = vec3(0.0, 0.0, 1.0);\\r\\n    vec3 p_global = toVec3( objects[0].transform_*vec4(p_local, 1.0) );\\r\\n    vec3 n_global = toVec3( objects[0].transform_*vec4(n_local, 0.0) );\\r\\n    \\r\\n    float pdfA = 1.0 / (dim_x*dim_y);\\r\\n    sampleRec.w = p_global - x;\\r\\n    sampleRec.d = length(sampleRec.w);\\r\\n    sampleRec.w = normalize(sampleRec.w);\\r\\n    float cosAtLight = dot(n_global, -sampleRec.w);\\r\\n    vec3 L = cosAtLight>0.0?getRadiance(vec2(Xi1,Xi2)):vec3(0.0);\\r\\n    sampleRec.pdf = PdfAtoW(pdfA, sampleRec.d*sampleRec.d, cosAtLight);\\r\\n    \\r\\n\\treturn L*0.3;\\r\\n}\\r\\n\\r\\nfloat sampleLightSourcePdf( in vec3 x,\\r\\n                               in vec3 wi,\\r\\n                             \\tfloat d,\\r\\n                              \\tfloat cosAtLight\\r\\n                             ) {\\r\\n    float min_x = objects[0].params_[0];\\t\\t\\t//min x\\r\\n    float min_y = objects[0].params_[1];\\t\\t\\t//min y\\r\\n    float max_x = objects[0].params_[2];\\t\\t\\t//max x\\r\\n    float max_y = objects[0].params_[3];\\t\\t\\t//max y\\r\\n    float dim_x = max_x - min_x;\\r\\n    float dim_y = max_y - min_y;\\r\\n    float pdfA = 1.0 / (dim_x*dim_y);\\r\\n    return PdfAtoW(pdfA, d*d, cosAtLight);\\r\\n}\\r\\n#endif\\r\\n\\r\\nbool isLightVisible( Ray shadowRay ) {\\r\\n    float distToHit;\\r\\n    SurfaceHitInfo tmpHit;\\r\\n    \\r\\n    raySceneIntersection( shadowRay, EPSILON, true, tmpHit, distToHit );\\r\\n    \\r\\n    return ( tmpHit.mtl_id_ >= LIGHT_ID_BASE );\\r\\n}\\r\\n\\r\\nvec3 sampleBSDF(\\tin vec3 x,\\r\\n                  \\tin vec3 ng,\\r\\n                  \\tin vec3 ns,\\r\\n                \\tin vec3 wi,\\r\\n                  \\tin Material mtl,\\r\\n                  \\tin bool useMIS,\\r\\n                \\tout vec3 wo,\\r\\n                \\tout float brdfPdfW,\\r\\n                \\tout vec3 fr,\\r\\n                \\tout bool hitRes,\\r\\n                \\tout SurfaceHitInfo hit) {\\r\\n    vec3 Lo = vec3(0.0);\\r\\n    \\r\\n    fr = mtlSample(mtl, ng, ns, wi, rnd(), rnd(), wo, brdfPdfW);\\r\\n\\r\\n    float dotNWo = dot(wo, ns);\\r\\n    //Continue if sampled direction is under surface\\r\\n    if ((dot(fr,fr)>0.0) && (brdfPdfW > EPSILON)) {\\r\\n        Ray shadowRay = Ray(x, wo);\\r\\n\\r\\n        //abstractLight* pLight = 0;\\r\\n        float cosAtLight = 1.0;\\r\\n        float distanceToLight = -1.0;\\r\\n        vec3 Li = vec3(0.0);\\r\\n\\r\\n        {\\r\\n            float distToHit;\\r\\n\\r\\n            if(raySceneIntersection( shadowRay, EPSILON, false, hit, distToHit )) {\\r\\n                if(hit.mtl_id_>=LIGHT_ID_BASE) {\\r\\n                    distanceToLight = distToHit;\\r\\n                    cosAtLight = dot(hit.normal_, -wo);\\r\\n                    if(cosAtLight > 0.0) {\\r\\n                        Li = getRadiance(hit.uv_);\\r\\n                        //Li = lights[0].color_*lights[0].intensity_;\\r\\n                    }\\r\\n                } else {\\r\\n                    hitRes = true;\\r\\n                }\\r\\n            } else {\\r\\n                hitRes = false;\\r\\n                //TODO check for infinite lights\\r\\n            }\\r\\n        }\\r\\n\\r\\n        if (distanceToLight>0.0) {\\r\\n            if (cosAtLight > 0.0) {\\r\\n                vec3 contribution = (Li * fr * dotNWo) / brdfPdfW;\\r\\n\\r\\n                if (useMIS && !(mtl.type_==1)) {\\r\\n                    float lightPickPdf = 1.0;//lightPickingPdf(x, n);\\r\\n                    float lightPdfW = sampleLightSourcePdf( x, wi, distanceToLight, cosAtLight );\\r\\n \\r\\n                    contribution *= misWeight(brdfPdfW, lightPdfW);\\r\\n                }\\r\\n\\r\\n                Lo += contribution;\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    return Lo;\\r\\n}\\r\\n\\r\\nvec3 salmpleLight(\\tin vec3 x,\\r\\n                  \\tin vec3 ng,\\r\\n                  \\tin vec3 ns,\\r\\n                  \\tin vec3 wi,\\r\\n                  \\tin Material mtl,\\r\\n                  \\tin bool useMIS ) {\\r\\n    vec3 Lo = vec3(0.0);\\t//outgoing radiance\\r\\n\\r\\n    float lightPickingPdf = 1.0;\\r\\n    Light light = lights[0];\\r\\n\\r\\n    vec3 wo;\\r\\n    float lightPdfW, lightDist;\\r\\n\\r\\n    LightSamplingRecord rec;\\r\\n    vec3 Li = sampleLightSource( x, rnd(), rnd(), rec );\\r\\n    wo = rec.w;\\r\\n    lightPdfW = rec.pdf;\\r\\n    lightDist = rec.d;\\r\\n    lightPdfW *= lightPickingPdf;\\r\\n\\r\\n    float dotNWo = dot(wo, ns);\\r\\n\\r\\n    if ((dotNWo > 0.0) && (lightPdfW > EPSILON)) {\\r\\n        vec3 fr = mtlEval(mtl, ng, ns, wi, wo);\\r\\n        if(dot(fr,fr)>0.0) {\\r\\n            Ray shadowRay = Ray(x, wo);\\r\\n            if (isLightVisible( shadowRay )) {\\r\\n                vec3 contribution = (Li * fr * dotNWo) / lightPdfW;\\r\\n\\r\\n                if (useMIS && !(mtl.type_==1)) {\\r\\n                    float brdfPdfW = mtlPdf(mtl, ng, ns, wi, wo);\\r\\n                    contribution *= misWeight(lightPdfW, brdfPdfW);\\r\\n                }\\r\\n\\r\\n                Lo += contribution;\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n\\r\\n    return Lo;\\r\\n}\\r\\n\\r\\nvec3 Radiance( in Ray r, int strataCount, int strataIndex ) {\\r\\n    vec3 e = vec3(0.0), fr, directLight, pathWeight = vec3(1.0, 1.0, 1.0);\\r\\n    vec3 wo;\\r\\n    float woPdf;\\r\\n    float dotWoN;\\r\\n    bool hitResult;\\r\\n\\r\\n    //Calculate first intersections to determine first scattering event\\r\\n    Ray ray = r;\\r\\n    SurfaceHitInfo event;\\r\\n    SurfaceHitInfo nextEvent;\\r\\n    float dist;\\r\\n    if(!raySceneIntersection( ray, 0.0, false, event, dist )) {\\r\\n        return vec3(0.0);\\r\\n    } else {\\r\\n        //We have to add emmision component on first hit\\r\\n        if( event.mtl_id_ >= LIGHT_ID_BASE ) {\\r\\n            Light light = getLight(event.mtl_id_ - LIGHT_ID_BASE);\\r\\n            float cosAtLight = dot(event.normal_, -ray.direction);\\r\\n            if(cosAtLight > 0.0) {\\r\\n                e = getRadiance(event.uv_);\\r\\n            }\\r\\n        }\\r\\n    }\\r\\n    \\r\\n    vec3 direct = vec3(0.0), indirect = vec3(0.0);\\r\\n\\r\\n    for (int i = 0; i < MAX_DEPTH; i++) {\\r\\n        if(event.mtl_id_>=LIGHT_ID_BASE){\\r\\n        \\tbreak;\\r\\n    \\t}\\r\\n        \\r\\n        vec3 x = event.position_;\\r\\n        vec3 wi = -ray.direction;\\r\\n        if(dot(wi, event.normal_) < 0.0) {\\r\\n            event.normal_ *= -1.0;\\r\\n        }\\r\\n        \\r\\n        Material mtl = getMaterial(event.mtl_id_);\\r\\n    \\tvec3 ng = event.normal_, ns;\\r\\n        vec3 tangent = vec3(event.normal_.xzy);\\r\\n        tangent = orthogonalize(event.normal_, tangent);\\r\\n    \\r\\n        mat3 frame;\\r\\n        frame[0] = tangent;\\r\\n        frame[1] = cross( ng, tangent );\\r\\n        frame[2] = ng;\\r\\n        ns = event.normal_;//frame*ns;\\r\\n        \\r\\n        if (dot(wi,ns) < 0.0) { break; }\\r\\n \\r\\n        //Calculate direct light with 'Light sampling' and 'BSDF sampling' techniques\\r\\n        //In addition BSDF sampling does next event estimation and returns all necessary values which corresponds to next event\\r\\n       \\tdirectLight  = salmpleLight (x, ng, ns, wi, mtl, true);\\r\\n        directLight += sampleBSDF   (x, ng, ns, wi, mtl, true, wo, woPdf, fr, hitResult, nextEvent);\\r\\n       \\r\\n        if(pathWeight.x > 1.0 || pathWeight.y > 1.0 || pathWeight.z > 1.0)\\r\\n            break;\\r\\n        \\r\\n        if(i == 0) {\\r\\n            direct += directLight*pathWeight;\\r\\n        } else {\\r\\n        \\tindirect += directLight*pathWeight;\\r\\n        }\\r\\n\\r\\n        if (!hitResult || (dotWoN = dot(event.normal_, wo))<0.0) { break; }\\r\\n        if (woPdf == 0.0) { break; }\\r\\n        pathWeight *= fr*dotWoN / woPdf;\\r\\n\\r\\n        //Update values for next iteration\\r\\n        ray = Ray(event.position_, wo);\\r\\n        event = nextEvent;\\r\\n    }\\r\\n    \\r\\n    //Clamp only indirect\\r\\n    indirect = vec3(min(indirect, vec3(CLAMP_VALUE)));\\r\\n\\r\\n    return e + direct + indirect;\\r\\n}\\r\\n\\r\\n// void mainImage( out vec4 fragColor, in vec2 gl_FragColor )\\r\\nvoid main( void )\\r\\n{\\r\\n    //随机数种子. 使用时间+视口分辨率,视口坐标\\r\\n    // seed = uTime + uResolution.y * gl_FragCoord.x   + gl_FragCoord.y;// / uResolution.x     /uResolution.y\\r\\n\\tseed = mod(uSampleCounter,1000.0) * uRandomVector.x - uRandomVector.y + uResolution.y * gl_FragCoord.x / uResolution.x + uResolution.x * gl_FragCoord.y / uResolution.y;\\r\\n    \\r\\n    float fov = radians(40.0);\\r\\n    initCamera( vec3( 0.0, 0.0, 0.0 ),\\r\\n               vec3( 0.0, 0.0, 0.0 ),\\r\\n               vec3( 0.0, 1.0, 0.0 ),\\r\\n               fov,\\r\\n               9.2\\r\\n              );\\r\\n\\r\\n    initScene();\\r\\n\\r\\n    //积累的颜色\\r\\n    vec3 accumulatedColor = vec3( 0.0 );\\r\\n    //累积覆盖率 0-1\\r\\n    float oneOverSPP = 1.0/float(PIXEL_SAMPLES);\\r\\n    float strataSize = oneOverSPP;\\r\\n\\r\\n    //取样\\r\\n    for( int si=0; si<PIXEL_SAMPLES; ++si ){\\r\\n        vec2 sc = gl_FragCoord.xy + vec2(strataSize*(float(si) + rnd()), rnd());\\r\\n        accumulatedColor += Radiance(genRay(sc, rnd(), rnd()), PIXEL_SAMPLES, si);\\r\\n    }\\r\\n\\r\\n    //devide to sample count  等分采样计数\\r\\n    accumulatedColor = accumulatedColor*oneOverSPP;\\r\\n    \\r\\n    vec3 col_acc;\\r\\n    vec2 coord = floor(gl_FragCoord.xy * uResolution.xy); //取整\\r\\n    if(all(equal(coord.xy,vec2(0))))  //如果坐标为0\\r\\n    {\\r\\n\\r\\n        if( uMouse.z > 0.0 ) {\\r\\n            col_acc = vec3(uSampleCounter);\\r\\n        }\\r\\n        else {\\r\\n            col_acc = texture2D( tPreviousTexture, vec2(0.5, 0.5)/uResolution.xy ).xyz;\\r\\n        }\\r\\n    }\\r\\n    else \\r\\n    {\\r\\n        if(uSampleCounter == 1.0) \\r\\n        {\\r\\n            col_acc = accumulatedColor;\\r\\n        }\\r\\n        else\\r\\n        {\\r\\n            vec3 col_new = accumulatedColor;\\r\\n            //读取原先的颜色值.\\r\\n            col_acc = texture2D( tPreviousTexture, vUv ).xyz;\\r\\n            //mix 线性插值. 取x,y的线性混合,x*(1-a)+y*a\\r\\n            // col_acc = mix(col_acc, col_new, float(1.0)/float(1.0+uSampleCounter));\\r\\n            col_acc = col_acc + col_new;\\r\\n        }\\r\\n    }\\r\\n    gl_FragColor = vec4( col_acc, 1.0 );\\r\\n}\\r\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/glsl/mis.glsl\n// module id = 10\n// module chunks = 0"],"sourceRoot":""}